{
    "sourceFile": "sql/ethans_cafe (1).sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1772348724467,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1772352386244,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,8 +70,9 @@\n   low_stock_threshold numeric,\r\n   status character varying,\r\n   created_at timestamp without time zone,\r\n   updated_at timestamp without time zone,\r\n+  expiry_date date,\r\n   CONSTRAINT ingredients_pkey PRIMARY KEY (id),\r\n   CONSTRAINT ingredients_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.ingredient_categories(id),\r\n   CONSTRAINT ingredients_unit_id_fkey FOREIGN KEY (unit_id) REFERENCES public.units(id)\r\n );\r\n@@ -115,8 +116,21 @@\n   recipe integer NOT NULL,\r\n   CONSTRAINT menu_items_pkey PRIMARY KEY (id),\r\n   CONSTRAINT menu_items_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.menu_categories(id)\r\n );\r\n+CREATE TABLE public.notifications (\r\n+  id integer NOT NULL DEFAULT nextval('notifications_id_seq'::regclass),\r\n+  user_id integer,\r\n+  action_type character varying NOT NULL,\r\n+  target_table character varying NOT NULL,\r\n+  target_id integer,\r\n+  description text,\r\n+  reason text,\r\n+  is_read boolean DEFAULT false,\r\n+  created_at timestamp without time zone DEFAULT now(),\r\n+  CONSTRAINT notifications_pkey PRIMARY KEY (id),\r\n+  CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)\r\n+);\r\n CREATE TABLE public.recipes (\r\n   id integer NOT NULL DEFAULT nextval('recipes_id_seq'::regclass),\r\n   menu_item_id integer,\r\n   ingredient_id integer,\r\n@@ -163,10 +177,17 @@\n   staff_id integer,\r\n   total_items integer,\r\n   notes text,\r\n   created_at timestamp without time zone,\r\n+  status character varying DEFAULT 'completed'::character varying,\r\n+  adjusted_total numeric,\r\n+  adjusted_by integer,\r\n+  adjusted_at timestamp without time zone,\r\n+  adjustment_reason text,\r\n+  total_amount numeric,\r\n   CONSTRAINT sales_pkey PRIMARY KEY (id),\r\n-  CONSTRAINT sales_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.users(id)\r\n+  CONSTRAINT sales_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.users(id),\r\n+  CONSTRAINT sales_adjusted_by_fkey FOREIGN KEY (adjusted_by) REFERENCES public.users(id)\r\n );\r\n CREATE TABLE public.system_settings (\r\n   key character varying NOT NULL,\r\n   value text,\r\n"
                }
            ],
            "date": 1772348724467,
            "name": "Commit-0",
            "content": "-- WARNING: This schema is for context only and is not meant to be run.\r\n-- Table order and constraints may not be valid for execution.\r\n\r\nCREATE TABLE public.account_lockout (\r\n  id bigint NOT NULL DEFAULT nextval('account_lockout_id_seq'::regclass),\r\n  user_id bigint NOT NULL UNIQUE,\r\n  lockout_at timestamp with time zone DEFAULT now(),\r\n  CONSTRAINT account_lockout_pkey PRIMARY KEY (id)\r\n);\r\nCREATE TABLE public.account_requests (\r\n  id integer NOT NULL DEFAULT nextval('account_requests_id_seq'::regclass),\r\n  full_name character varying NOT NULL,\r\n  username character varying NOT NULL,\r\n  password_hash character varying NOT NULL,\r\n  requested_role_id integer,\r\n  status character varying,\r\n  requested_at timestamp without time zone,\r\n  reviewed_by integer,\r\n  reviewed_at timestamp without time zone,\r\n  notes text,\r\n  ip_address text,\r\n  email text,\r\n  CONSTRAINT account_requests_pkey PRIMARY KEY (id),\r\n  CONSTRAINT account_requests_requested_role_id_fkey FOREIGN KEY (requested_role_id) REFERENCES public.roles(id),\r\n  CONSTRAINT account_requests_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(id)\r\n);\r\nCREATE TABLE public.activity_logs (\r\n  id integer NOT NULL DEFAULT nextval('activity_logs_id_seq'::regclass),\r\n  user_id integer,\r\n  role_label character varying,\r\n  action character varying,\r\n  reference character varying,\r\n  status character varying,\r\n  ip_address character varying,\r\n  created_at timestamp without time zone,\r\n  CONSTRAINT activity_logs_pkey PRIMARY KEY (id),\r\n  CONSTRAINT activity_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)\r\n);\r\nCREATE TABLE public.backup_settings (\r\n  id integer NOT NULL DEFAULT 1,\r\n  schedule text DEFAULT 'Weekly'::text,\r\n  retention_count integer DEFAULT 10,\r\n  include_media boolean DEFAULT true,\r\n  updated_at timestamp without time zone,\r\n  CONSTRAINT backup_settings_pkey PRIMARY KEY (id)\r\n);\r\nCREATE TABLE public.backups (\r\n  id integer NOT NULL DEFAULT nextval('backups_id_seq'::regclass),\r\n  filename character varying NOT NULL,\r\n  file_path character varying NOT NULL,\r\n  file_size character varying,\r\n  backup_type text DEFAULT 'Manual'::text,\r\n  includes_media boolean DEFAULT false,\r\n  created_by integer,\r\n  created_at timestamp without time zone DEFAULT now(),\r\n  CONSTRAINT backups_pkey PRIMARY KEY (id),\r\n  CONSTRAINT fk_created_by FOREIGN KEY (created_by) REFERENCES public.users(id)\r\n);\r\nCREATE TABLE public.ingredient_categories (\r\n  id integer NOT NULL DEFAULT nextval('ingredient_categories_id_seq'::regclass),\r\n  name character varying NOT NULL,\r\n  CONSTRAINT ingredient_categories_pkey PRIMARY KEY (id)\r\n);\r\nCREATE TABLE public.ingredients (\r\n  id integer NOT NULL DEFAULT nextval('ingredients_id_seq'::regclass),\r\n  name character varying NOT NULL,\r\n  category_id integer,\r\n  unit_id integer,\r\n  current_quantity numeric,\r\n  low_stock_threshold numeric,\r\n  status character varying,\r\n  created_at timestamp without time zone,\r\n  updated_at timestamp without time zone,\r\n  CONSTRAINT ingredients_pkey PRIMARY KEY (id),\r\n  CONSTRAINT ingredients_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.ingredient_categories(id),\r\n  CONSTRAINT ingredients_unit_id_fkey FOREIGN KEY (unit_id) REFERENCES public.units(id)\r\n);\r\nCREATE TABLE public.inventory_transactions (\r\n  id integer NOT NULL DEFAULT nextval('inventory_transactions_id_seq'::regclass),\r\n  ingredient_id integer,\r\n  change_qty numeric,\r\n  transaction_type character varying,\r\n  reason character varying,\r\n  performed_by integer,\r\n  prev_qty numeric,\r\n  new_qty numeric,\r\n  timestamp timestamp without time zone,\r\n  CONSTRAINT inventory_transactions_pkey PRIMARY KEY (id),\r\n  CONSTRAINT inventory_transactions_ingredient_id_fkey FOREIGN KEY (ingredient_id) REFERENCES public.ingredients(id),\r\n  CONSTRAINT inventory_transactions_performed_by_fkey FOREIGN KEY (performed_by) REFERENCES public.users(id)\r\n);\r\nCREATE TABLE public.login_attempts (\r\n  id bigint NOT NULL DEFAULT nextval('login_attempts_id_seq'::regclass),\r\n  username character varying NOT NULL UNIQUE,\r\n  attempt_count integer DEFAULT 1,\r\n  last_attempt_at timestamp with time zone DEFAULT now(),\r\n  CONSTRAINT login_attempts_pkey PRIMARY KEY (id)\r\n);\r\nCREATE TABLE public.menu_categories (\r\n  id integer NOT NULL DEFAULT nextval('menu_categories_id_seq'::regclass),\r\n  name character varying NOT NULL,\r\n  description character varying,\r\n  CONSTRAINT menu_categories_pkey PRIMARY KEY (id)\r\n);\r\nCREATE TABLE public.menu_items (\r\n  id integer NOT NULL DEFAULT nextval('menu_items_id_seq'::regclass),\r\n  name character varying NOT NULL,\r\n  category_id integer,\r\n  description character varying,\r\n  price_reference numeric,\r\n  status character varying,\r\n  image_path character varying,\r\n  created_at timestamp without time zone,\r\n  updated_at timestamp without time zone,\r\n  recipe integer NOT NULL,\r\n  CONSTRAINT menu_items_pkey PRIMARY KEY (id),\r\n  CONSTRAINT menu_items_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.menu_categories(id)\r\n);\r\nCREATE TABLE public.recipes (\r\n  id integer NOT NULL DEFAULT nextval('recipes_id_seq'::regclass),\r\n  menu_item_id integer,\r\n  ingredient_id integer,\r\n  qty_per_sale numeric,\r\n  unit_id integer,\r\n  CONSTRAINT recipes_pkey PRIMARY KEY (id),\r\n  CONSTRAINT recipes_ingredient_id_fkey FOREIGN KEY (ingredient_id) REFERENCES public.ingredients(id),\r\n  CONSTRAINT recipes_unit_id_fkey FOREIGN KEY (unit_id) REFERENCES public.units(id),\r\n  CONSTRAINT recipes_menu_item_id_fkey FOREIGN KEY (menu_item_id) REFERENCES public.menu_items(id)\r\n);\r\nCREATE TABLE public.requests_tbl (\r\n  id integer NOT NULL DEFAULT nextval('requests_tbl_id_seq'::regclass),\r\n  type character varying,\r\n  requester_id integer,\r\n  target_id integer,\r\n  payload text,\r\n  status character varying,\r\n  created_at timestamp without time zone,\r\n  handled_by integer,\r\n  handled_at timestamp without time zone,\r\n  CONSTRAINT requests_tbl_pkey PRIMARY KEY (id),\r\n  CONSTRAINT requests_tbl_requester_id_fkey FOREIGN KEY (requester_id) REFERENCES public.users(id),\r\n  CONSTRAINT requests_tbl_handled_by_fkey FOREIGN KEY (handled_by) REFERENCES public.users(id)\r\n);\r\nCREATE TABLE public.roles (\r\n  id integer NOT NULL DEFAULT nextval('roles_id_seq'::regclass),\r\n  name character varying NOT NULL,\r\n  permissions text,\r\n  CONSTRAINT roles_pkey PRIMARY KEY (id)\r\n);\r\nCREATE TABLE public.sale_items (\r\n  id integer NOT NULL DEFAULT nextval('sale_items_id_seq'::regclass),\r\n  sale_id integer,\r\n  menu_item_id integer,\r\n  quantity integer,\r\n  CONSTRAINT sale_items_pkey PRIMARY KEY (id),\r\n  CONSTRAINT sale_items_sale_id_fkey FOREIGN KEY (sale_id) REFERENCES public.sales(id),\r\n  CONSTRAINT sale_items_menu_item_id_fkey FOREIGN KEY (menu_item_id) REFERENCES public.menu_items(id)\r\n);\r\nCREATE TABLE public.sales (\r\n  id integer NOT NULL DEFAULT nextval('sales_id_seq'::regclass),\r\n  receipt_no character varying,\r\n  sale_datetime timestamp without time zone,\r\n  staff_id integer,\r\n  total_items integer,\r\n  notes text,\r\n  created_at timestamp without time zone,\r\n  CONSTRAINT sales_pkey PRIMARY KEY (id),\r\n  CONSTRAINT sales_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.users(id)\r\n);\r\nCREATE TABLE public.system_settings (\r\n  key character varying NOT NULL,\r\n  value text,\r\n  updated_at timestamp without time zone,\r\n  CONSTRAINT system_settings_pkey PRIMARY KEY (key)\r\n);\r\nCREATE TABLE public.temp_accounts (\r\n  id integer NOT NULL DEFAULT nextval('temp_accounts_id_seq'::regclass),\r\n  role_id integer NOT NULL,\r\n  username character varying NOT NULL UNIQUE,\r\n  password_hash character varying NOT NULL,\r\n  ip_address character varying,\r\n  reason text,\r\n  created_by integer,\r\n  created_at timestamp with time zone DEFAULT now(),\r\n  expires_at timestamp with time zone,\r\n  status character varying DEFAULT 'active'::character varying,\r\n  CONSTRAINT temp_accounts_pkey PRIMARY KEY (id)\r\n);\r\nCREATE TABLE public.units (\r\n  id integer NOT NULL DEFAULT nextval('units_id_seq'::regclass),\r\n  name character varying NOT NULL,\r\n  CONSTRAINT units_pkey PRIMARY KEY (id)\r\n);\r\nCREATE TABLE public.user_sessions (\r\n  id integer NOT NULL DEFAULT nextval('user_sessions_id_seq'::regclass),\r\n  user_id integer NOT NULL,\r\n  session_token character varying NOT NULL UNIQUE,\r\n  ip_address character varying,\r\n  user_agent character varying,\r\n  created_at timestamp without time zone NOT NULL DEFAULT now(),\r\n  expires_at timestamp without time zone NOT NULL,\r\n  last_activity timestamp without time zone DEFAULT now(),\r\n  is_active boolean DEFAULT true,\r\n  CONSTRAINT user_sessions_pkey PRIMARY KEY (id),\r\n  CONSTRAINT user_sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)\r\n);\r\nCREATE TABLE public.users (\r\n  id integer NOT NULL DEFAULT nextval('users_id_seq'::regclass),\r\n  full_name character varying NOT NULL,\r\n  username character varying NOT NULL UNIQUE,\r\n  password_hash character varying NOT NULL,\r\n  role_id integer,\r\n  status character varying,\r\n  last_login timestamp without time zone,\r\n  created_at timestamp without time zone,\r\n  updated_at timestamp without time zone,\r\n  deleted_at timestamp without time zone,\r\n  email text,\r\n  ip_addresss text,\r\n  CONSTRAINT users_pkey PRIMARY KEY (id),\r\n  CONSTRAINT users_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id)\r\n);"
        }
    ]
}