{
    "sourceFile": "codes/admin-feature.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 37,
            "patches": [
                {
                    "date": 1771517405708,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1771517482242,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,1 +1,24 @@\n-import { unitsDB } from \"./middle.js\";\n\\ No newline at end of file\n+import { unitsDB } from \"./middle.js\";\r\n+\r\n+\r\n+async function loadUnits() {\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n+    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`; \r\n+\r\n+    const units = await unitsDB.show();\r\n+\r\n+    if (!units || units.length === 0) {\r\n+        unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n+        return;\r\n+    }\r\n+\r\n+    units.forEach(unit => {\r\n+        const opt = document.createElement(\"option\");\r\n+        opt.value = unit.id;             // Value = unit ID\r\n+        opt.textContent = unit.short_name || unit.name; // Visible text\r\n+        unitSelect.appendChild(opt);\r\n+    });\r\n+}\r\n+\r\n+// Load units on modal open\r\n+document.getElementById(\"addIngredientModal\").addEventListener(\"shown.bs.modal\", loadUnits);\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771517704224,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,12 +13,12 @@\n     }\r\n \r\n     units.forEach(unit => {\r\n         const opt = document.createElement(\"option\");\r\n-        opt.value = unit.id;             // Value = unit ID\r\n-        opt.textContent = unit.short_name || unit.name; // Visible text\r\n+        opt.value = unit.id;\r\n+        opt.textContent = unit.short_name || unit.name;\r\n         unitSelect.appendChild(opt);\r\n     });\r\n }\r\n \r\n\\ No newline at end of file\n-// Load units on modal open\r\n-document.getElementById(\"addIngredientModal\").addEventListener(\"shown.bs.modal\", loadUnits);\n+// Load units as soon as the page is ready\r\n+document.addEventListener(\"DOMContentLoaded\", loadUnits);\r\n"
                },
                {
                    "date": 1771517749416,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,24 +1,50 @@\n import { unitsDB } from \"./middle.js\";\r\n \r\n \r\n async function loadUnits() {\r\n+    console.log(\"üîÑ loadUnits() called\");\r\n+\r\n     const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`; \r\n \r\n-    const units = await unitsDB.show();\r\n-\r\n-    if (!units || units.length === 0) {\r\n-        unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n+    if (!unitSelect) {\r\n+        console.error(\"‚ùå ingredientUnit element NOT FOUND\");\r\n         return;\r\n     }\r\n \r\n-    units.forEach(unit => {\r\n-        const opt = document.createElement(\"option\");\r\n-        opt.value = unit.id;\r\n-        opt.textContent = unit.short_name || unit.name;\r\n-        unitSelect.appendChild(opt);\r\n-    });\r\n\\ No newline at end of file\n+    console.log(\"‚úî ingredientUnit element FOUND\");\r\n+\r\n+    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n+\r\n+    try {\r\n+        console.log(\"üì° Fetching units from unitsDB.show()...\");\r\n+        const units = await unitsDB.show();\r\n+        console.log(\"üì• Units received:\", units);\r\n+\r\n+        if (!units || units.length === 0) {\r\n+            console.warn(\"‚ö† No units found\");\r\n+            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n+            return;\r\n+        }\r\n+\r\n+        console.log(`‚úî ${units.length} units found. Rendering...`);\r\n+\r\n+        units.forEach(unit => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = unit.id;\r\n+            opt.textContent = unit.short_name || unit.name;\r\n+            unitSelect.appendChild(opt);\r\n+        });\r\n+\r\n+        console.log(\"üéâ Units successfully loaded!\");\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"üî• ERROR loading units:\", error);\r\n+    }\r\n }\r\n \r\n-// Load units as soon as the page is ready\r\n-document.addEventListener(\"DOMContentLoaded\", loadUnits);\n+// Run on page load\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+    console.log(\"üåê DOMContentLoaded fired\");\r\n+    loadUnits();\r\n+});\r\n+\r\n"
                },
                {
                    "date": 1771518353538,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -47,4 +47,43 @@\n     console.log(\"üåê DOMContentLoaded fired\");\r\n     loadUnits();\r\n });\r\n \r\n+\r\n+async function loadCategories() {\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+\r\n+    if (!categorySelect) {\r\n+        console.error(\"‚ùå ingredientCategory element not found\");\r\n+        return;\r\n+    }\r\n+\r\n+    // Reset select\r\n+    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n+\r\n+    try {\r\n+        console.log(\"üì° Fetching categories from menuCategoriesDB...\");\r\n+        const categories = await menuCategoriesDB.show();\r\n+        console.log(\"üì• Categories received:\", categories);\r\n+\r\n+        if (!categories || categories.length === 0) {\r\n+            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n+            return;\r\n+        }\r\n+\r\n+        categories.forEach(cat => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = cat.id;       // Send ID to backend when selected\r\n+            opt.textContent = cat.name; // Display name\r\n+            categorySelect.appendChild(opt);\r\n+        });\r\n+\r\n+        console.log(\"üéâ Categories loaded successfully!\");\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"üî• ERROR loading categories:\", error);\r\n+        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n+    }\r\n+}\r\n+\r\n+// Run on page load\r\n+document.addEventListener(\"DOMContentLoaded\", loadCategories);\r\n"
                },
                {
                    "date": 1771518365338,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import { unitsDB } from \"./middle.js\";\r\n+import { unitsDB, men } from \"./middle.js\";\r\n \r\n \r\n async function loadUnits() {\r\n     console.log(\"üîÑ loadUnits() called\");\r\n"
                },
                {
                    "date": 1771519180325,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import { unitsDB, men } from \"./middle.js\";\r\n+import { unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n \r\n \r\n async function loadUnits() {\r\n     console.log(\"üîÑ loadUnits() called\");\r\n"
                },
                {
                    "date": 1771519195407,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,9 +48,9 @@\n     loadUnits();\r\n });\r\n \r\n \r\n-async function loadCategories() {\r\n+async function loadIngredientCategories() {\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n \r\n     if (!categorySelect) {\r\n         console.error(\"‚ùå ingredientCategory element not found\");\r\n@@ -60,10 +60,10 @@\n     // Reset select\r\n     categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n \r\n     try {\r\n-        console.log(\"üì° Fetching categories from menuCategoriesDB...\");\r\n-        const categories = await menuCategoriesDB.show();\r\n+        console.log(\"üì° Fetching categories from ingredientCategoriesDB...\");\r\n+        const categories = await ingredientCategoriesDB.show();\r\n         console.log(\"üì• Categories received:\", categories);\r\n \r\n         if (!categories || categories.length === 0) {\r\n             categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n@@ -71,19 +71,19 @@\n         }\r\n \r\n         categories.forEach(cat => {\r\n             const opt = document.createElement(\"option\");\r\n-            opt.value = cat.id;       // Send ID to backend when selected\r\n+            opt.value = cat.id;    // Save ID to ingredients table\r\n             opt.textContent = cat.name; // Display name\r\n             categorySelect.appendChild(opt);\r\n         });\r\n \r\n-        console.log(\"üéâ Categories loaded successfully!\");\r\n+        console.log(\"üéâ Ingredient categories loaded successfully!\");\r\n \r\n     } catch (error) {\r\n-        console.error(\"üî• ERROR loading categories:\", error);\r\n+        console.error(\"üî• ERROR loading ingredient categories:\", error);\r\n         categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n     }\r\n }\r\n \r\n-// Run on page load\r\n-document.addEventListener(\"DOMContentLoaded\", loadCategories);\r\n+// Load on page ready\r\n+document.addEventListener(\"DOMContentLoaded\", loadIngredientCategories);\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771519276695,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import { unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n+import {ingredientsDB unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n \r\n \r\n async function loadUnits() {\r\n     console.log(\"üîÑ loadUnits() called\");\r\n"
                },
                {
                    "date": 1771519305735,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import {ingredientsDB unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n+import {ingredientsDB, unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n \r\n \r\n async function loadUnits() {\r\n     console.log(\"üîÑ loadUnits() called\");\r\n@@ -84,6 +84,67 @@\n         categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n     }\r\n }\r\n \r\n+import { ingredientsDB, ingredientCategoriesDB, unitsDB } from \"./db.js\";\r\n+\r\n+document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n+    const name = document.getElementById(\"ingredientName\").value.trim();\r\n+    const categoryName = document.getElementById(\"ingredientCategory\").value.trim();\r\n+    const unitName = document.getElementById(\"ingredientUnit\").value.trim();\r\n+    const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n+\r\n+    if (!name || !categoryName || !unitName) {\r\n+        alert(\"Please fill out all required fields.\");\r\n+        return;\r\n+    }\r\n+\r\n+    try {\r\n+        // 1Ô∏è‚É£ Get category ID from ingredientCategoriesDB\r\n+        const categoryRows = await ingredientCategoriesDB.show({ name: categoryName });\r\n+        if (!categoryRows || categoryRows.length === 0) {\r\n+            alert(`Category \"${categoryName}\" not found in database.`);\r\n+            return;\r\n+        }\r\n+        const category_id = categoryRows[0].id;\r\n+\r\n+        // 2Ô∏è‚É£ Get unit ID from unitsDB\r\n+        const unitRows = await unitsDB.show({ short_name: unitName });\r\n+        if (!unitRows || unitRows.length === 0) {\r\n+            alert(`Unit \"${unitName}\" not found in database.`);\r\n+            return;\r\n+        }\r\n+        const unit_id = unitRows[0].id;\r\n+\r\n+        // 3Ô∏è‚É£ Insert ingredient into ingredientsDB\r\n+        const response = await ingredientsDB.add({\r\n+            name,\r\n+            category_id,\r\n+            unit_id,\r\n+            low_stock_threshold: threshold,\r\n+            current_quantity: 0,\r\n+            status: \"active\"\r\n+        });\r\n+\r\n+        if (response.error) {\r\n+            alert(\"Failed to save ingredient: \" + response.error);\r\n+            return;\r\n+        }\r\n+\r\n+        alert(\"Ingredient added successfully!\");\r\n+        // Optional: Reset form\r\n+        document.getElementById(\"addIngredientForm\").reset();\r\n+\r\n+        // Optional: Close modal\r\n+        const modalEl = document.getElementById(\"addIngredientModal\");\r\n+        const modal = bootstrap.Modal.getInstance(modalEl);\r\n+        modal.hide();\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error inserting ingredient:\", err);\r\n+        alert(\"An error occurred. Check console for details.\");\r\n+    }\r\n+});\r\n+\r\n+\r\n // Load on page ready\r\n document.addEventListener(\"DOMContentLoaded\", loadIngredientCategories);\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771519359539,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -84,9 +84,8 @@\n         categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n     }\r\n }\r\n \r\n-import { ingredientsDB, ingredientCategoriesDB, unitsDB } from \"./db.js\";\r\n \r\n document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n     const name = document.getElementById(\"ingredientName\").value.trim();\r\n     const categoryName = document.getElementById(\"ingredientCategory\").value.trim();\r\n"
                },
                {
                    "date": 1771519711221,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,39 +87,40 @@\n \r\n \r\n document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n     const name = document.getElementById(\"ingredientName\").value.trim();\r\n-    const categoryName = document.getElementById(\"ingredientCategory\").value.trim();\r\n-    const unitName = document.getElementById(\"ingredientUnit\").value.trim();\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n     const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n \r\n-    if (!name || !categoryName || !unitName) {\r\n+    const categoryId = categorySelect.value; // This should already be ID\r\n+    const unitId = unitSelect.value;         // This should already be ID\r\n+\r\n+    if (!name || !categoryId || !unitId) {\r\n         alert(\"Please fill out all required fields.\");\r\n         return;\r\n     }\r\n \r\n     try {\r\n-        // 1Ô∏è‚É£ Get category ID from ingredientCategoriesDB\r\n-        const categoryRows = await ingredientCategoriesDB.show({ name: categoryName });\r\n+        // Optional: Validate category exists\r\n+        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n         if (!categoryRows || categoryRows.length === 0) {\r\n-            alert(`Category \"${categoryName}\" not found in database.`);\r\n+            alert(\"Selected category not found in database.\");\r\n             return;\r\n         }\r\n-        const category_id = categoryRows[0].id;\r\n \r\n-        // 2Ô∏è‚É£ Get unit ID from unitsDB\r\n-        const unitRows = await unitsDB.show({ short_name: unitName });\r\n+        // Optional: Validate unit exists\r\n+        const unitRows = await unitsDB.show({ id: unitId });\r\n         if (!unitRows || unitRows.length === 0) {\r\n-            alert(`Unit \"${unitName}\" not found in database.`);\r\n+            alert(\"Selected unit not found in database.\");\r\n             return;\r\n         }\r\n-        const unit_id = unitRows[0].id;\r\n \r\n-        // 3Ô∏è‚É£ Insert ingredient into ingredientsDB\r\n+        // Insert into ingredientsDB\r\n         const response = await ingredientsDB.add({\r\n             name,\r\n-            category_id,\r\n-            unit_id,\r\n+            category_id: parseInt(categoryId),\r\n+            unit_id: parseInt(unitId),\r\n             low_stock_threshold: threshold,\r\n             current_quantity: 0,\r\n             status: \"active\"\r\n         });\r\n@@ -129,12 +130,11 @@\n             return;\r\n         }\r\n \r\n         alert(\"Ingredient added successfully!\");\r\n-        // Optional: Reset form\r\n         document.getElementById(\"addIngredientForm\").reset();\r\n \r\n-        // Optional: Close modal\r\n+        // Close modal\r\n         const modalEl = document.getElementById(\"addIngredientModal\");\r\n         const modal = bootstrap.Modal.getInstance(modalEl);\r\n         modal.hide();\r\n \r\n"
                },
                {
                    "date": 1771520217247,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,38 +85,42 @@\n     }\r\n }\r\n \r\n \r\n+import { ingredientsDB, ingredientCategoriesDB, unitsDB } from \"./db.js\";\r\n+\r\n+// Save ingredient when clicking the button\r\n document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n     const name = document.getElementById(\"ingredientName\").value.trim();\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n     const unitSelect = document.getElementById(\"ingredientUnit\");\r\n     const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n \r\n-    const categoryId = categorySelect.value; // This should already be ID\r\n-    const unitId = unitSelect.value;         // This should already be ID\r\n+    const categoryId = categorySelect.value; // ID from select\r\n+    const unitId = unitSelect.value;         // ID from select\r\n \r\n+    // Validation\r\n     if (!name || !categoryId || !unitId) {\r\n         alert(\"Please fill out all required fields.\");\r\n         return;\r\n     }\r\n \r\n     try {\r\n-        // Optional: Validate category exists\r\n+        // Validate category exists\r\n         const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n         if (!categoryRows || categoryRows.length === 0) {\r\n             alert(\"Selected category not found in database.\");\r\n             return;\r\n         }\r\n \r\n-        // Optional: Validate unit exists\r\n+        // Validate unit exists\r\n         const unitRows = await unitsDB.show({ id: unitId });\r\n         if (!unitRows || unitRows.length === 0) {\r\n             alert(\"Selected unit not found in database.\");\r\n             return;\r\n         }\r\n \r\n-        // Insert into ingredientsDB\r\n+        // Insert ingredient into ingredientsDB\r\n         const response = await ingredientsDB.add({\r\n             name,\r\n             category_id: parseInt(categoryId),\r\n             unit_id: parseInt(unitId),\r\n@@ -129,21 +133,92 @@\n             alert(\"Failed to save ingredient: \" + response.error);\r\n             return;\r\n         }\r\n \r\n-        alert(\"Ingredient added successfully!\");\r\n+        // Reset form\r\n         document.getElementById(\"addIngredientForm\").reset();\r\n \r\n         // Close modal\r\n         const modalEl = document.getElementById(\"addIngredientModal\");\r\n         const modal = bootstrap.Modal.getInstance(modalEl);\r\n-        modal.hide();\r\n+        if (modal) modal.hide();\r\n \r\n+        // Optional: reload masterlist\r\n+        if (typeof loadIngredientsMasterlist === \"function\") {\r\n+            loadIngredientsMasterlist();\r\n+        }\r\n+\r\n+        console.log(`Ingredient \"${name}\" added successfully!`);\r\n+\r\n\\ No newline at end of file\n     } catch (err) {\r\n         console.error(\"Error inserting ingredient:\", err);\r\n         alert(\"An error occurred. Check console for details.\");\r\n     }\r\n });\r\n \r\n+// Load categories dynamically on page ready\r\n+document.addEventListener(\"DOMContentLoaded\", async () => {\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+    if (!categorySelect) return;\r\n \r\n-// Load on page ready\r\n-document.addEventListener(\"DOMContentLoaded\", loadIngredientCategories);\n+    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n+\r\n+    try {\r\n+        const categories = await ingredientCategoriesDB.show();\r\n+        if (!categories || categories.length === 0) {\r\n+            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n+            return;\r\n+        }\r\n+\r\n+        categories.forEach(cat => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = cat.id;      // ID for DB\r\n+            opt.textContent = cat.name; // Display name\r\n+            categorySelect.appendChild(opt);\r\n+        });\r\n+\r\n+        console.log(\"Ingredient categories loaded successfully!\");\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading categories:\", err);\r\n+        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n+    }\r\n+});\r\n+\r\n+// Optional: load units dynamically (similar pattern)\r\n+document.addEventListener(\"DOMContentLoaded\", async () => {\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n+    const thresholdSpan = document.getElementById(\"thresholdUnit\");\r\n+\r\n+    if (!unitSelect) return;\r\n+\r\n+    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n+    thresholdSpan.textContent = \"\";\r\n+\r\n+    try {\r\n+        const units = await unitsDB.show();\r\n+        if (!units || units.length === 0) {\r\n+            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n+            return;\r\n+        }\r\n+\r\n+        units.forEach(unit => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = unit.id;             // ID for DB\r\n+            opt.textContent = unit.short_name || unit.name;\r\n+            opt.dataset.short = unit.short_name || unit.name; // for threshold span\r\n+            unitSelect.appendChild(opt);\r\n+        });\r\n+\r\n+        console.log(\"Units loaded successfully!\");\r\n+\r\n+        // Update threshold span on unit change\r\n+        unitSelect.addEventListener(\"change\", () => {\r\n+            const selected = unitSelect.selectedOptions[0];\r\n+            thresholdSpan.textContent = selected?.dataset.short || \"\";\r\n+        });\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading units:\", err);\r\n+        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n+    }\r\n+});\r\n"
                },
                {
                    "date": 1771520226342,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,10 +85,8 @@\n     }\r\n }\r\n \r\n \r\n-import { ingredientsDB, ingredientCategoriesDB, unitsDB } from \"./db.js\";\r\n-\r\n // Save ingredient when clicking the button\r\n document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n     const name = document.getElementById(\"ingredientName\").value.trim();\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n@@ -220,5 +218,5 @@\n     } catch (err) {\r\n         console.error(\"Error loading units:\", err);\r\n         unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n     }\r\n-});\n\\ No newline at end of file\n+});\r\n"
                },
                {
                    "date": 1771520752539,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,9 +48,9 @@\n     loadUnits();\r\n });\r\n \r\n \r\n-async function loadIngredientCategories() {\r\n+ function loadIngredientCategories() {\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n \r\n     if (!categorySelect) {\r\n         console.error(\"‚ùå ingredientCategory element not found\");\r\n"
                },
                {
                    "date": 1771520759364,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,9 +48,9 @@\n     loadUnits();\r\n });\r\n \r\n \r\n- function loadIngredientCategories() {\r\n+async function loadIngredientCategories() {\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n \r\n     if (!categorySelect) {\r\n         console.error(\"‚ùå ingredientCategory element not found\");\r\n"
                },
                {
                    "date": 1771520948154,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -140,11 +140,11 @@\n         const modal = bootstrap.Modal.getInstance(modalEl);\r\n         if (modal) modal.hide();\r\n \r\n         // Optional: reload masterlist\r\n-        if (typeof loadIngredientsMasterlist === \"function\") {\r\n-            loadIngredientsMasterlist();\r\n-        }\r\n+        // if (typeof loadIngredientsMasterlist === \"function\") {\r\n+        //     loadIngredientsMasterlist();\r\n+        // }\r\n \r\n         console.log(`Ingredient \"${name}\" added successfully!`);\r\n \r\n     } catch (err) {\r\n"
                },
                {
                    "date": 1771520960921,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -140,11 +140,11 @@\n         const modal = bootstrap.Modal.getInstance(modalEl);\r\n         if (modal) modal.hide();\r\n \r\n         // Optional: reload masterlist\r\n-        // if (typeof loadIngredientsMasterlist === \"function\") {\r\n-        //     loadIngredientsMasterlist();\r\n-        // }\r\n+        if (typeof loadIngredientsMasterlist === \"function\") {\r\n+            loadIngredientsMasterlist();\r\n+        }\r\n \r\n         console.log(`Ingredient \"${name}\" added successfully!`);\r\n \r\n     } catch (err) {\r\n"
                },
                {
                    "date": 1771520974038,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,222 @@\n+import {ingredientsDB, unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n+\r\n+\r\n+async function loadUnits() {\r\n+    console.log(\"üîÑ loadUnits() called\");\r\n+\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n+\r\n+    if (!unitSelect) {\r\n+        console.error(\"‚ùå ingredientUnit element NOT FOUND\");\r\n+        return;\r\n+    }\r\n+\r\n+    console.log(\"‚úî ingredientUnit element FOUND\");\r\n+\r\n+    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n+\r\n+    try {\r\n+        console.log(\"üì° Fetching units from unitsDB.show()...\");\r\n+        const units = await unitsDB.show();\r\n+        console.log(\"üì• Units received:\", units);\r\n+\r\n+        if (!units || units.length === 0) {\r\n+            console.warn(\"‚ö† No units found\");\r\n+            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n+            return;\r\n+        }\r\n+\r\n+        console.log(`‚úî ${units.length} units found. Rendering...`);\r\n+\r\n+        units.forEach(unit => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = unit.id;\r\n+            opt.textContent = unit.short_name || unit.name;\r\n+            unitSelect.appendChild(opt);\r\n+        });\r\n+\r\n+        console.log(\"üéâ Units successfully loaded!\");\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"üî• ERROR loading units:\", error);\r\n+    }\r\n+}\r\n+\r\n+// Run on page load\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+    console.log(\"üåê DOMContentLoaded fired\");\r\n+    loadUnits();\r\n+});\r\n+\r\n+\r\n+async function loadIngredientCategories() {\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+\r\n+    if (!categorySelect) {\r\n+        console.error(\"‚ùå ingredientCategory element not found\");\r\n+        return;\r\n+    }\r\n+\r\n+    // Reset select\r\n+    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n+\r\n+    try {\r\n+        console.log(\"üì° Fetching categories from ingredientCategoriesDB...\");\r\n+        const categories = await ingredientCategoriesDB.show();\r\n+        console.log(\"üì• Categories received:\", categories);\r\n+\r\n+        if (!categories || categories.length === 0) {\r\n+            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n+            return;\r\n+        }\r\n+\r\n+        categories.forEach(cat => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = cat.id;    // Save ID to ingredients table\r\n+            opt.textContent = cat.name; // Display name\r\n+            categorySelect.appendChild(opt);\r\n+        });\r\n+\r\n+        console.log(\"üéâ Ingredient categories loaded successfully!\");\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"üî• ERROR loading ingredient categories:\", error);\r\n+        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n+    }\r\n+}\r\n+\r\n+\r\n+// Save ingredient when clicking the button\r\n+document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n+    const name = document.getElementById(\"ingredientName\").value.trim();\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n+    const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n+\r\n+    const categoryId = categorySelect.value; // ID from select\r\n+    const unitId = unitSelect.value;         // ID from select\r\n+\r\n+    // Validation\r\n+    if (!name || !categoryId || !unitId) {\r\n+        alert(\"Please fill out all required fields.\");\r\n+        return;\r\n+    }\r\n+\r\n+    try {\r\n+        // Validate category exists\r\n+        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n+        if (!categoryRows || categoryRows.length === 0) {\r\n+            alert(\"Selected category not found in database.\");\r\n+            return;\r\n+        }\r\n+\r\n+        // Validate unit exists\r\n+        const unitRows = await unitsDB.show({ id: unitId });\r\n+        if (!unitRows || unitRows.length === 0) {\r\n+            alert(\"Selected unit not found in database.\");\r\n+            return;\r\n+        }\r\n+\r\n+        // Insert ingredient into ingredientsDB\r\n+        const response = await ingredientsDB.add({\r\n+            name,\r\n+            category_id: parseInt(categoryId),\r\n+            unit_id: parseInt(unitId),\r\n+            low_stock_threshold: threshold,\r\n+            current_quantity: 0,\r\n+            status: \"active\"\r\n+        });\r\n+\r\n+        if (response.error) {\r\n+            alert(\"Failed to save ingredient: \" + response.error);\r\n+            return;\r\n+        }\r\n+\r\n+        // Reset form\r\n+        document.getElementById(\"addIngredientForm\").reset();\r\n+\r\n+        // Close modal\r\n+        const modalEl = document.getElementById(\"addIngredientModal\");\r\n+        const modal = bootstrap.Modal.getInstance(modalEl);\r\n+        if (modal) modal.hide();\r\n+\r\n+        // Optional: reload masterlist\r\n+        if (typeof loadIngredientsMasterlist === \"function\") {\r\n+            loadIngredientsMasterlist();\r\n+        }\r\n+\r\n+        console.log(`Ingredient \"${name}\" added successfully!`);\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error inserting ingredient:\", err);\r\n+        alert(\"An error occurred. Check console for details.\");\r\n+    }\r\n+});\r\n+\r\n+// Load categories dynamically on page ready\r\n+// document.addEventListener(\"DOMContentLoaded\", async () => {\r\n+//     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+//     if (!categorySelect) return;\r\n+\r\n+//     categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n+\r\n+//     try {\r\n+//         const categories = await ingredientCategoriesDB.show();\r\n+//         if (!categories || categories.length === 0) {\r\n+//             categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n+//             return;\r\n+//         }\r\n+\r\n+//         categories.forEach(cat => {\r\n+//             const opt = document.createElement(\"option\");\r\n+//             opt.value = cat.id;      // ID for DB\r\n+//             opt.textContent = cat.name; // Display name\r\n+//             categorySelect.appendChild(opt);\r\n+//         });\r\n+\r\n+//         console.log(\"Ingredient categories loaded successfully!\");\r\n+\r\n+//     } catch (err) {\r\n+//         console.error(\"Error loading categories:\", err);\r\n+//         categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n+//     }\r\n+// });\r\n+\r\n+// Optional: load units dynamically (similar pattern)\r\n+document.addEventListener(\"DOMContentLoaded\", async () => {\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n+    const thresholdSpan = document.getElementById(\"thresholdUnit\");\r\n+\r\n+    if (!unitSelect) return;\r\n+\r\n+    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n+    thresholdSpan.textContent = \"\";\r\n+\r\n+    try {\r\n+        const units = await unitsDB.show();\r\n+        if (!units || units.length === 0) {\r\n+            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n+            return;\r\n+        }\r\n+\r\n+        units.forEach(unit => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = unit.id;             // ID for DB\r\n+            opt.textContent = unit.short_name || unit.name;\r\n+            opt.dataset.short = unit.short_name || unit.name; // for threshold span\r\n+            unitSelect.appendChild(opt);\r\n+        });\r\n+\r\n+        console.log(\"Units loaded successfully!\");\r\n+\r\n+        // Update threshold span on unit change\r\n+        unitSelect.addEventListener(\"change\", () => {\r\n+            const selected = unitSelect.selectedOptions[0];\r\n+            thresholdSpan.textContent = selected?.dataset.short || \"\";\r\n+        });\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading units:\", err);\r\n+        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n+    }\r\n+});\r\n"
                },
                {
                    "date": 1771520989133,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -153,232 +153,10 @@\n     }\r\n });\r\n \r\n // Load categories dynamically on page ready\r\n-// document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-//     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-//     if (!categorySelect) return;\r\n-\r\n-//     categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n-\r\n-//     try {\r\n-//         const categories = await ingredientCategoriesDB.show();\r\n-//         if (!categories || categories.length === 0) {\r\n-//             categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n-//             return;\r\n-//         }\r\n-\r\n-//         categories.forEach(cat => {\r\n-//             const opt = document.createElement(\"option\");\r\n-//             opt.value = cat.id;      // ID for DB\r\n-//             opt.textContent = cat.name; // Display name\r\n-//             categorySelect.appendChild(opt);\r\n-//         });\r\n-\r\n-//         console.log(\"Ingredient categories loaded successfully!\");\r\n-\r\n-//     } catch (err) {\r\n-//         console.error(\"Error loading categories:\", err);\r\n-//         categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n-//     }\r\n-// });\r\n-\r\n-// Optional: load units dynamically (similar pattern)\r\n document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-    const thresholdSpan = document.getElementById(\"thresholdUnit\");\r\n-\r\n-    if (!unitSelect) return;\r\n-\r\n-    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n-    thresholdSpan.textContent = \"\";\r\n-\r\n-    try {\r\n-        const units = await unitsDB.show();\r\n-        if (!units || units.length === 0) {\r\n-            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n-            return;\r\n-        }\r\n-\r\n-        units.forEach(unit => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = unit.id;             // ID for DB\r\n-            opt.textContent = unit.short_name || unit.name;\r\n-            opt.dataset.short = unit.short_name || unit.name; // for threshold span\r\n-            unitSelect.appendChild(opt);\r\n-        });\r\n-\r\n-        console.log(\"Units loaded successfully!\");\r\n-\r\n-        // Update threshold span on unit change\r\n-        unitSelect.addEventListener(\"change\", () => {\r\n-            const selected = unitSelect.selectedOptions[0];\r\n-            thresholdSpan.textContent = selected?.dataset.short || \"\";\r\n-        });\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading units:\", err);\r\n-        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n-    }\r\n-});\r\n-import {ingredientsDB, unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n-\r\n-\r\n-async function loadUnits() {\r\n-    console.log(\"üîÑ loadUnits() called\");\r\n-\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-\r\n-    if (!unitSelect) {\r\n-        console.error(\"‚ùå ingredientUnit element NOT FOUND\");\r\n-        return;\r\n-    }\r\n-\r\n-    console.log(\"‚úî ingredientUnit element FOUND\");\r\n-\r\n-    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n-\r\n-    try {\r\n-        console.log(\"üì° Fetching units from unitsDB.show()...\");\r\n-        const units = await unitsDB.show();\r\n-        console.log(\"üì• Units received:\", units);\r\n-\r\n-        if (!units || units.length === 0) {\r\n-            console.warn(\"‚ö† No units found\");\r\n-            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n-            return;\r\n-        }\r\n-\r\n-        console.log(`‚úî ${units.length} units found. Rendering...`);\r\n-\r\n-        units.forEach(unit => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = unit.id;\r\n-            opt.textContent = unit.short_name || unit.name;\r\n-            unitSelect.appendChild(opt);\r\n-        });\r\n-\r\n-        console.log(\"üéâ Units successfully loaded!\");\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"üî• ERROR loading units:\", error);\r\n-    }\r\n-}\r\n-\r\n-// Run on page load\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-    console.log(\"üåê DOMContentLoaded fired\");\r\n-    loadUnits();\r\n-});\r\n-\r\n-\r\n-async function loadIngredientCategories() {\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-\r\n-    if (!categorySelect) {\r\n-        console.error(\"‚ùå ingredientCategory element not found\");\r\n-        return;\r\n-    }\r\n-\r\n-    // Reset select\r\n-    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n-\r\n-    try {\r\n-        console.log(\"üì° Fetching categories from ingredientCategoriesDB...\");\r\n-        const categories = await ingredientCategoriesDB.show();\r\n-        console.log(\"üì• Categories received:\", categories);\r\n-\r\n-        if (!categories || categories.length === 0) {\r\n-            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n-            return;\r\n-        }\r\n-\r\n-        categories.forEach(cat => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = cat.id;    // Save ID to ingredients table\r\n-            opt.textContent = cat.name; // Display name\r\n-            categorySelect.appendChild(opt);\r\n-        });\r\n-\r\n-        console.log(\"üéâ Ingredient categories loaded successfully!\");\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"üî• ERROR loading ingredient categories:\", error);\r\n-        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n-    }\r\n-}\r\n-\r\n-\r\n-// Save ingredient when clicking the button\r\n-document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n-    const name = document.getElementById(\"ingredientName\").value.trim();\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-    const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n-\r\n-    const categoryId = categorySelect.value; // ID from select\r\n-    const unitId = unitSelect.value;         // ID from select\r\n-\r\n-    // Validation\r\n-    if (!name || !categoryId || !unitId) {\r\n-        alert(\"Please fill out all required fields.\");\r\n-        return;\r\n-    }\r\n-\r\n-    try {\r\n-        // Validate category exists\r\n-        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n-        if (!categoryRows || categoryRows.length === 0) {\r\n-            alert(\"Selected category not found in database.\");\r\n-            return;\r\n-        }\r\n-\r\n-        // Validate unit exists\r\n-        const unitRows = await unitsDB.show({ id: unitId });\r\n-        if (!unitRows || unitRows.length === 0) {\r\n-            alert(\"Selected unit not found in database.\");\r\n-            return;\r\n-        }\r\n-\r\n-        // Insert ingredient into ingredientsDB\r\n-        const response = await ingredientsDB.add({\r\n-            name,\r\n-            category_id: parseInt(categoryId),\r\n-            unit_id: parseInt(unitId),\r\n-            low_stock_threshold: threshold,\r\n-            current_quantity: 0,\r\n-            status: \"active\"\r\n-        });\r\n-\r\n-        if (response.error) {\r\n-            alert(\"Failed to save ingredient: \" + response.error);\r\n-            return;\r\n-        }\r\n-\r\n-        // Reset form\r\n-        document.getElementById(\"addIngredientForm\").reset();\r\n-\r\n-        // Close modal\r\n-        const modalEl = document.getElementById(\"addIngredientModal\");\r\n-        const modal = bootstrap.Modal.getInstance(modalEl);\r\n-        if (modal) modal.hide();\r\n-\r\n-        // Optional: reload masterlist\r\n-        if (typeof loadIngredientsMasterlist === \"function\") {\r\n-            loadIngredientsMasterlist();\r\n-        }\r\n-\r\n-        console.log(`Ingredient \"${name}\" added successfully!`);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error inserting ingredient:\", err);\r\n-        alert(\"An error occurred. Check console for details.\");\r\n-    }\r\n-});\r\n-\r\n-// Load categories dynamically on page ready\r\n-document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n     if (!categorySelect) return;\r\n \r\n     categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n \r\n"
                },
                {
                    "date": 1771521218986,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,8 +152,79 @@\n         alert(\"An error occurred. Check console for details.\");\r\n     }\r\n });\r\n \r\n+async function showAddIngredientModal(editingIngredient = null) {\r\n+    const modalElem = document.getElementById('addIngredientModal');\r\n+    if (!modalElem) return;\r\n+\r\n+    // Update modal title\r\n+    const modalTitle = modalElem.querySelector('.modal-title');\r\n+    modalTitle.innerHTML = editingIngredient\r\n+        ? '<i class=\"fas fa-edit me-2\"></i>Edit Ingredient'\r\n+        : '<i class=\"fas fa-plus-circle me-2\"></i>Add Ingredient';\r\n+\r\n+    const nameInput = document.getElementById('ingredientName');\r\n+    const categorySelect = document.getElementById('ingredientCategory');\r\n+    const unitSelect = document.getElementById('ingredientUnit');\r\n+    const thresholdInput = document.getElementById('lowStockThreshold');\r\n+    const thresholdSpan = document.getElementById('thresholdUnit');\r\n+\r\n+    // Reset form first\r\n+    document.getElementById('addIngredientForm').reset();\r\n+    thresholdSpan.textContent = '';\r\n+\r\n+    // Load categories dynamically\r\n+    try {\r\n+        const categories = await ingredientCategoriesDB.show();\r\n+        categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n+        categories.forEach(cat => {\r\n+            const opt = document.createElement('option');\r\n+            opt.value = cat.id;\r\n+            opt.textContent = cat.name;\r\n+            categorySelect.appendChild(opt);\r\n+        });\r\n+    } catch (err) {\r\n+        console.error(\"Failed to load categories:\", err);\r\n+    }\r\n+\r\n+    // Load units dynamically\r\n+    try {\r\n+        const units = await unitsDB.show();\r\n+        unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n+        units.forEach(unit => {\r\n+            const opt = document.createElement('option');\r\n+            opt.value = unit.id;\r\n+            opt.textContent = unit.short_name || unit.name;\r\n+            opt.dataset.short = unit.short_name || unit.name; // For threshold display\r\n+            unitSelect.appendChild(opt);\r\n+        });\r\n+    } catch (err) {\r\n+        console.error(\"Failed to load units:\", err);\r\n+    }\r\n+\r\n+    // Pre-fill if editing\r\n+    if (editingIngredient) {\r\n+        nameInput.value = editingIngredient.name;\r\n+        categorySelect.value = editingIngredient.category_id;\r\n+        unitSelect.value = editingIngredient.unit_id;\r\n+        thresholdInput.value = editingIngredient.low_stock_threshold;\r\n+        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n+    }\r\n+\r\n+    // Remove previous listener to avoid duplicates\r\n+    const newUnitSelect = unitSelect.cloneNode(true);\r\n+    unitSelect.parentNode.replaceChild(newUnitSelect, unitSelect);\r\n+    newUnitSelect.addEventListener('change', () => {\r\n+        thresholdSpan.textContent = newUnitSelect.selectedOptions[0]?.dataset.short || '';\r\n+    });\r\n+\r\n+    // Show modal\r\n+    const modal = new bootstrap.Modal(modalElem);\r\n+    modal.show();\r\n+}\r\n+\r\n+\r\n // Load categories dynamically on page ready\r\n document.addEventListener(\"DOMContentLoaded\", async () => {\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n     if (!categorySelect) return;\r\n"
                },
                {
                    "date": 1771521461951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,79 +152,10 @@\n         alert(\"An error occurred. Check console for details.\");\r\n     }\r\n });\r\n \r\n-async function showAddIngredientModal(editingIngredient = null) {\r\n-    const modalElem = document.getElementById('addIngredientModal');\r\n-    if (!modalElem) return;\r\n \r\n-    // Update modal title\r\n-    const modalTitle = modalElem.querySelector('.modal-title');\r\n-    modalTitle.innerHTML = editingIngredient\r\n-        ? '<i class=\"fas fa-edit me-2\"></i>Edit Ingredient'\r\n-        : '<i class=\"fas fa-plus-circle me-2\"></i>Add Ingredient';\r\n \r\n-    const nameInput = document.getElementById('ingredientName');\r\n-    const categorySelect = document.getElementById('ingredientCategory');\r\n-    const unitSelect = document.getElementById('ingredientUnit');\r\n-    const thresholdInput = document.getElementById('lowStockThreshold');\r\n-    const thresholdSpan = document.getElementById('thresholdUnit');\r\n-\r\n-    // Reset form first\r\n-    document.getElementById('addIngredientForm').reset();\r\n-    thresholdSpan.textContent = '';\r\n-\r\n-    // Load categories dynamically\r\n-    try {\r\n-        const categories = await ingredientCategoriesDB.show();\r\n-        categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n-        categories.forEach(cat => {\r\n-            const opt = document.createElement('option');\r\n-            opt.value = cat.id;\r\n-            opt.textContent = cat.name;\r\n-            categorySelect.appendChild(opt);\r\n-        });\r\n-    } catch (err) {\r\n-        console.error(\"Failed to load categories:\", err);\r\n-    }\r\n-\r\n-    // Load units dynamically\r\n-    try {\r\n-        const units = await unitsDB.show();\r\n-        unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n-        units.forEach(unit => {\r\n-            const opt = document.createElement('option');\r\n-            opt.value = unit.id;\r\n-            opt.textContent = unit.short_name || unit.name;\r\n-            opt.dataset.short = unit.short_name || unit.name; // For threshold display\r\n-            unitSelect.appendChild(opt);\r\n-        });\r\n-    } catch (err) {\r\n-        console.error(\"Failed to load units:\", err);\r\n-    }\r\n-\r\n-    // Pre-fill if editing\r\n-    if (editingIngredient) {\r\n-        nameInput.value = editingIngredient.name;\r\n-        categorySelect.value = editingIngredient.category_id;\r\n-        unitSelect.value = editingIngredient.unit_id;\r\n-        thresholdInput.value = editingIngredient.low_stock_threshold;\r\n-        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n-    }\r\n-\r\n-    // Remove previous listener to avoid duplicates\r\n-    const newUnitSelect = unitSelect.cloneNode(true);\r\n-    unitSelect.parentNode.replaceChild(newUnitSelect, unitSelect);\r\n-    newUnitSelect.addEventListener('change', () => {\r\n-        thresholdSpan.textContent = newUnitSelect.selectedOptions[0]?.dataset.short || '';\r\n-    });\r\n-\r\n-    // Show modal\r\n-    const modal = new bootstrap.Modal(modalElem);\r\n-    modal.show();\r\n-}\r\n-\r\n-\r\n // Load categories dynamically on page ready\r\n document.addEventListener(\"DOMContentLoaded\", async () => {\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n     if (!categorySelect) return;\r\n"
                },
                {
                    "date": 1771521521060,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,10 +152,79 @@\n         alert(\"An error occurred. Check console for details.\");\r\n     }\r\n });\r\n \r\n+async function showAddIngredientModal(editingIngredient = null) {\r\n+    const modalElem = document.getElementById('addIngredientModal');\r\n+    if (!modalElem) return;\r\n \r\n+    // Update modal title\r\n+    const modalTitle = modalElem.querySelector('.modal-title');\r\n+    modalTitle.innerHTML = editingIngredient\r\n+        ? '<i class=\"fas fa-edit me-2\"></i>Edit Ingredient'\r\n+        : '<i class=\"fas fa-plus-circle me-2\"></i>Add Ingredient';\r\n \r\n+    const nameInput = document.getElementById('ingredientName');\r\n+    const categorySelect = document.getElementById('ingredientCategory');\r\n+    const unitSelect = document.getElementById('ingredientUnit');\r\n+    const thresholdInput = document.getElementById('lowStockThreshold');\r\n+    const thresholdSpan = document.getElementById('thresholdUnit');\r\n+\r\n+    // Reset form first\r\n+    document.getElementById('addIngredientForm').reset();\r\n+    thresholdSpan.textContent = '';\r\n+\r\n+    // Load categories dynamically\r\n+    try {\r\n+        const categories = await ingredientCategoriesDB.show();\r\n+        categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n+        categories.forEach(cat => {\r\n+            const opt = document.createElement('option');\r\n+            opt.value = cat.id;\r\n+            opt.textContent = cat.name;\r\n+            categorySelect.appendChild(opt);\r\n+        });\r\n+    } catch (err) {\r\n+        console.error(\"Failed to load categories:\", err);\r\n+    }\r\n+\r\n+    // Load units dynamically\r\n+    try {\r\n+        const units = await unitsDB.show();\r\n+        unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n+        units.forEach(unit => {\r\n+            const opt = document.createElement('option');\r\n+            opt.value = unit.id;\r\n+            opt.textContent = unit.short_name || unit.name;\r\n+            opt.dataset.short = unit.short_name || unit.name; // For threshold display\r\n+            unitSelect.appendChild(opt);\r\n+        });\r\n+    } catch (err) {\r\n+        console.error(\"Failed to load units:\", err);\r\n+    }\r\n+\r\n+    // Pre-fill if editing\r\n+    if (editingIngredient) {\r\n+        nameInput.value = editingIngredient.name;\r\n+        categorySelect.value = editingIngredient.category_id;\r\n+        unitSelect.value = editingIngredient.unit_id;\r\n+        thresholdInput.value = editingIngredient.low_stock_threshold;\r\n+        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n+    }\r\n+\r\n+    // Remove previous listener to avoid duplicates\r\n+    const newUnitSelect = unitSelect.cloneNode(true);\r\n+    unitSelect.parentNode.replaceChild(newUnitSelect, unitSelect);\r\n+    newUnitSelect.addEventListener('change', () => {\r\n+        thresholdSpan.textContent = newUnitSelect.selectedOptions[0]?.dataset.short || '';\r\n+    });\r\n+\r\n+    // Show modal\r\n+    const modal = new bootstrap.Modal(modalElem);\r\n+    modal.show();\r\n+}\r\n+\r\n+\r\n // Load categories dynamically on page ready\r\n document.addEventListener(\"DOMContentLoaded\", async () => {\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n     if (!categorySelect) return;\r\n"
                },
                {
                    "date": 1771521622711,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,92 +85,25 @@\n     }\r\n }\r\n \r\n \r\n-// Save ingredient when clicking the button\r\n-document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n-    const name = document.getElementById(\"ingredientName\").value.trim();\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-    const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n+let editingIngredient = null; // Track ingredient being edited\r\n \r\n-    const categoryId = categorySelect.value; // ID from select\r\n-    const unitId = unitSelect.value;         // ID from select\r\n+// Open the Add/Edit Ingredient modal\r\n+async function showAddIngredientModal(ingredient = null) {\r\n+    editingIngredient = ingredient;\r\n \r\n-    // Validation\r\n-    if (!name || !categoryId || !unitId) {\r\n-        alert(\"Please fill out all required fields.\");\r\n-        return;\r\n-    }\r\n-\r\n-    try {\r\n-        // Validate category exists\r\n-        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n-        if (!categoryRows || categoryRows.length === 0) {\r\n-            alert(\"Selected category not found in database.\");\r\n-            return;\r\n-        }\r\n-\r\n-        // Validate unit exists\r\n-        const unitRows = await unitsDB.show({ id: unitId });\r\n-        if (!unitRows || unitRows.length === 0) {\r\n-            alert(\"Selected unit not found in database.\");\r\n-            return;\r\n-        }\r\n-\r\n-        // Insert ingredient into ingredientsDB\r\n-        const response = await ingredientsDB.add({\r\n-            name,\r\n-            category_id: parseInt(categoryId),\r\n-            unit_id: parseInt(unitId),\r\n-            low_stock_threshold: threshold,\r\n-            current_quantity: 0,\r\n-            status: \"active\"\r\n-        });\r\n-\r\n-        if (response.error) {\r\n-            alert(\"Failed to save ingredient: \" + response.error);\r\n-            return;\r\n-        }\r\n-\r\n-        // Reset form\r\n-        document.getElementById(\"addIngredientForm\").reset();\r\n-\r\n-        // Close modal\r\n-        const modalEl = document.getElementById(\"addIngredientModal\");\r\n-        const modal = bootstrap.Modal.getInstance(modalEl);\r\n-        if (modal) modal.hide();\r\n-\r\n-        // Optional: reload masterlist\r\n-        if (typeof loadIngredientsMasterlist === \"function\") {\r\n-            loadIngredientsMasterlist();\r\n-        }\r\n-\r\n-        console.log(`Ingredient \"${name}\" added successfully!`);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error inserting ingredient:\", err);\r\n-        alert(\"An error occurred. Check console for details.\");\r\n-    }\r\n-});\r\n-\r\n-async function showAddIngredientModal(editingIngredient = null) {\r\n     const modalElem = document.getElementById('addIngredientModal');\r\n     if (!modalElem) return;\r\n \r\n-    // Update modal title\r\n     const modalTitle = modalElem.querySelector('.modal-title');\r\n-    modalTitle.innerHTML = editingIngredient\r\n-        ? '<i class=\"fas fa-edit me-2\"></i>Edit Ingredient'\r\n-        : '<i class=\"fas fa-plus-circle me-2\"></i>Add Ingredient';\r\n-\r\n     const nameInput = document.getElementById('ingredientName');\r\n     const categorySelect = document.getElementById('ingredientCategory');\r\n     const unitSelect = document.getElementById('ingredientUnit');\r\n     const thresholdInput = document.getElementById('lowStockThreshold');\r\n     const thresholdSpan = document.getElementById('thresholdUnit');\r\n \r\n-    // Reset form first\r\n+    // Reset form and threshold span\r\n     document.getElementById('addIngredientForm').reset();\r\n     thresholdSpan.textContent = '';\r\n \r\n     // Load categories dynamically\r\n@@ -184,8 +117,9 @@\n             categorySelect.appendChild(opt);\r\n         });\r\n     } catch (err) {\r\n         console.error(\"Failed to load categories:\", err);\r\n+        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n     }\r\n \r\n     // Load units dynamically\r\n     try {\r\n@@ -194,100 +128,98 @@\n         units.forEach(unit => {\r\n             const opt = document.createElement('option');\r\n             opt.value = unit.id;\r\n             opt.textContent = unit.short_name || unit.name;\r\n-            opt.dataset.short = unit.short_name || unit.name; // For threshold display\r\n+            opt.dataset.short = unit.short_name || unit.name; // for threshold\r\n             unitSelect.appendChild(opt);\r\n         });\r\n     } catch (err) {\r\n         console.error(\"Failed to load units:\", err);\r\n+        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n     }\r\n \r\n     // Pre-fill if editing\r\n     if (editingIngredient) {\r\n+        modalTitle.innerHTML = '<i class=\"fas fa-edit me-2\"></i>Edit Ingredient';\r\n         nameInput.value = editingIngredient.name;\r\n         categorySelect.value = editingIngredient.category_id;\r\n         unitSelect.value = editingIngredient.unit_id;\r\n         thresholdInput.value = editingIngredient.low_stock_threshold;\r\n         thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n+    } else {\r\n+        modalTitle.innerHTML = '<i class=\"fas fa-plus-circle me-2\"></i>Add Ingredient';\r\n     }\r\n \r\n-    // Remove previous listener to avoid duplicates\r\n-    const newUnitSelect = unitSelect.cloneNode(true);\r\n-    unitSelect.parentNode.replaceChild(newUnitSelect, unitSelect);\r\n-    newUnitSelect.addEventListener('change', () => {\r\n-        thresholdSpan.textContent = newUnitSelect.selectedOptions[0]?.dataset.short || '';\r\n+    // Update threshold span when unit changes\r\n+    unitSelect.addEventListener('change', () => {\r\n+        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n     });\r\n \r\n     // Show modal\r\n     const modal = new bootstrap.Modal(modalElem);\r\n     modal.show();\r\n }\r\n \r\n+// Save ingredient (add or edit)\r\n+async function saveIngredient() {\r\n+    const name = document.getElementById(\"ingredientName\").value.trim();\r\n+    const categoryId = document.getElementById(\"ingredientCategory\").value;\r\n+    const unitId = document.getElementById(\"ingredientUnit\").value;\r\n+    const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n \r\n-// Load categories dynamically on page ready\r\n-document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-    if (!categorySelect) return;\r\n+    if (!name || !categoryId || !unitId) {\r\n+        alert(\"Please fill out all required fields.\");\r\n+        return;\r\n+    }\r\n \r\n-    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n+    try {\r\n+        // Optional validation\r\n+        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n+        if (!categoryRows.length) throw new Error(\"Category not found\");\r\n+        const unitRows = await unitsDB.show({ id: unitId });\r\n+        if (!unitRows.length) throw new Error(\"Unit not found\");\r\n \r\n-    try {\r\n-        const categories = await ingredientCategoriesDB.show();\r\n-        if (!categories || categories.length === 0) {\r\n-            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n-            return;\r\n+        let response;\r\n+        if (editingIngredient) {\r\n+            // Edit existing ingredient\r\n+            response = await ingredientsDB.edit({\r\n+                id: editingIngredient.id,\r\n+                name,\r\n+                category_id: parseInt(categoryId),\r\n+                unit_id: parseInt(unitId),\r\n+                low_stock_threshold: threshold\r\n+            });\r\n+        } else {\r\n+            // Add new ingredient\r\n+            response = await ingredientsDB.add({\r\n+                name,\r\n+                category_id: parseInt(categoryId),\r\n+                unit_id: parseInt(unitId),\r\n+                low_stock_threshold: threshold,\r\n+                current_quantity: 0,\r\n+                status: \"active\"\r\n+            });\r\n         }\r\n \r\n-        categories.forEach(cat => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = cat.id;      // ID for DB\r\n-            opt.textContent = cat.name; // Display name\r\n-            categorySelect.appendChild(opt);\r\n-        });\r\n+        if (response.error) throw new Error(response.error);\r\n \r\n-        console.log(\"Ingredient categories loaded successfully!\");\r\n+        // Reset and close modal\r\n+        document.getElementById(\"addIngredientForm\").reset();\r\n+        const modalEl = document.getElementById(\"addIngredientModal\");\r\n+        const modal = bootstrap.Modal.getInstance(modalEl);\r\n+        if (modal) modal.hide();\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading categories:\", err);\r\n-        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n-    }\r\n-});\r\n+        editingIngredient = null;\r\n \r\n-// Optional: load units dynamically (similar pattern)\r\n-document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-    const thresholdSpan = document.getElementById(\"thresholdUnit\");\r\n+        // Refresh masterlist if function exists\r\n+        if (typeof loadIngredientsMasterlist === \"function\") loadIngredientsMasterlist();\r\n \r\n-    if (!unitSelect) return;\r\n+        console.log(`Ingredient \"${name}\" ${editingIngredient ? \"updated\" : \"added\"} successfully!`);\r\n \r\n-    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n-    thresholdSpan.textContent = \"\";\r\n-\r\n-    try {\r\n-        const units = await unitsDB.show();\r\n-        if (!units || units.length === 0) {\r\n-            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n-            return;\r\n-        }\r\n-\r\n-        units.forEach(unit => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = unit.id;             // ID for DB\r\n-            opt.textContent = unit.short_name || unit.name;\r\n-            opt.dataset.short = unit.short_name || unit.name; // for threshold span\r\n-            unitSelect.appendChild(opt);\r\n-        });\r\n-\r\n-        console.log(\"Units loaded successfully!\");\r\n-\r\n-        // Update threshold span on unit change\r\n-        unitSelect.addEventListener(\"change\", () => {\r\n-            const selected = unitSelect.selectedOptions[0];\r\n-            thresholdSpan.textContent = selected?.dataset.short || \"\";\r\n-        });\r\n-\r\n     } catch (err) {\r\n-        console.error(\"Error loading units:\", err);\r\n-        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n+        console.error(err);\r\n+        alert(\"Error saving ingredient: \" + err.message);\r\n     }\r\n-});\r\n+}\r\n+\r\n+// Bind save button once\r\n+document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", saveIngredient);\r\n"
                },
                {
                    "date": 1771521649139,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n     }\r\n }\r\n \r\n \r\n-let editingIngredient = null; // Track ingredient being edited\r\n+// let editingIngredient = null; // Track ingredient being edited\r\n \r\n // Open the Add/Edit Ingredient modal\r\n async function showAddIngredientModal(ingredient = null) {\r\n     editingIngredient = ingredient;\r\n"
                },
                {
                    "date": 1771521765578,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,95 +1,60 @@\n-import {ingredientsDB, unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n+import { ingredientsDB, unitsDB, ingredientCategoriesDB } from \"./middle.js\";\r\n \r\n+let editingIngredient = null; // Track ingredient being edited\r\n \r\n-async function loadUnits() {\r\n-    console.log(\"üîÑ loadUnits() called\");\r\n-\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-\r\n-    if (!unitSelect) {\r\n-        console.error(\"‚ùå ingredientUnit element NOT FOUND\");\r\n-        return;\r\n-    }\r\n-\r\n-    console.log(\"‚úî ingredientUnit element FOUND\");\r\n-\r\n+// Load units dynamically\r\n+async function loadUnits(unitSelect) {\r\n+    if (!unitSelect) return;\r\n     unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n \r\n     try {\r\n-        console.log(\"üì° Fetching units from unitsDB.show()...\");\r\n         const units = await unitsDB.show();\r\n-        console.log(\"üì• Units received:\", units);\r\n-\r\n         if (!units || units.length === 0) {\r\n-            console.warn(\"‚ö† No units found\");\r\n             unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n             return;\r\n         }\r\n \r\n-        console.log(`‚úî ${units.length} units found. Rendering...`);\r\n-\r\n         units.forEach(unit => {\r\n             const opt = document.createElement(\"option\");\r\n             opt.value = unit.id;\r\n             opt.textContent = unit.short_name || unit.name;\r\n+            opt.dataset.short = unit.short_name || unit.name; // for threshold\r\n             unitSelect.appendChild(opt);\r\n         });\r\n \r\n-        console.log(\"üéâ Units successfully loaded!\");\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"üî• ERROR loading units:\", error);\r\n+    } catch (err) {\r\n+        console.error(\"Failed to load units:\", err);\r\n+        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n     }\r\n }\r\n \r\n-// Run on page load\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-    console.log(\"üåê DOMContentLoaded fired\");\r\n-    loadUnits();\r\n-});\r\n-\r\n-\r\n-async function loadIngredientCategories() {\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-\r\n-    if (!categorySelect) {\r\n-        console.error(\"‚ùå ingredientCategory element not found\");\r\n-        return;\r\n-    }\r\n-\r\n-    // Reset select\r\n+// Load categories dynamically\r\n+async function loadCategories(categorySelect) {\r\n+    if (!categorySelect) return;\r\n     categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n \r\n     try {\r\n-        console.log(\"üì° Fetching categories from ingredientCategoriesDB...\");\r\n         const categories = await ingredientCategoriesDB.show();\r\n-        console.log(\"üì• Categories received:\", categories);\r\n-\r\n         if (!categories || categories.length === 0) {\r\n             categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n             return;\r\n         }\r\n \r\n         categories.forEach(cat => {\r\n             const opt = document.createElement(\"option\");\r\n-            opt.value = cat.id;    // Save ID to ingredients table\r\n-            opt.textContent = cat.name; // Display name\r\n+            opt.value = cat.id; // DB ID\r\n+            opt.textContent = cat.name;\r\n             categorySelect.appendChild(opt);\r\n         });\r\n \r\n-        console.log(\"üéâ Ingredient categories loaded successfully!\");\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"üî• ERROR loading ingredient categories:\", error);\r\n+    } catch (err) {\r\n+        console.error(\"Failed to load categories:\", err);\r\n         categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n     }\r\n }\r\n \r\n-\r\n-// let editingIngredient = null; // Track ingredient being edited\r\n-\r\n-// Open the Add/Edit Ingredient modal\r\n+// Show Add/Edit Ingredient modal\r\n async function showAddIngredientModal(ingredient = null) {\r\n     editingIngredient = ingredient;\r\n \r\n     const modalElem = document.getElementById('addIngredientModal');\r\n@@ -101,43 +66,15 @@\n     const unitSelect = document.getElementById('ingredientUnit');\r\n     const thresholdInput = document.getElementById('lowStockThreshold');\r\n     const thresholdSpan = document.getElementById('thresholdUnit');\r\n \r\n-    // Reset form and threshold span\r\n+    // Reset form & threshold\r\n     document.getElementById('addIngredientForm').reset();\r\n     thresholdSpan.textContent = '';\r\n \r\n-    // Load categories dynamically\r\n-    try {\r\n-        const categories = await ingredientCategoriesDB.show();\r\n-        categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n-        categories.forEach(cat => {\r\n-            const opt = document.createElement('option');\r\n-            opt.value = cat.id;\r\n-            opt.textContent = cat.name;\r\n-            categorySelect.appendChild(opt);\r\n-        });\r\n-    } catch (err) {\r\n-        console.error(\"Failed to load categories:\", err);\r\n-        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n-    }\r\n+    // Load categories and units dynamically\r\n+    await Promise.all([loadCategories(categorySelect), loadUnits(unitSelect)]);\r\n \r\n-    // Load units dynamically\r\n-    try {\r\n-        const units = await unitsDB.show();\r\n-        unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n-        units.forEach(unit => {\r\n-            const opt = document.createElement('option');\r\n-            opt.value = unit.id;\r\n-            opt.textContent = unit.short_name || unit.name;\r\n-            opt.dataset.short = unit.short_name || unit.name; // for threshold\r\n-            unitSelect.appendChild(opt);\r\n-        });\r\n-    } catch (err) {\r\n-        console.error(\"Failed to load units:\", err);\r\n-        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n-    }\r\n-\r\n     // Pre-fill if editing\r\n     if (editingIngredient) {\r\n         modalTitle.innerHTML = '<i class=\"fas fa-edit me-2\"></i>Edit Ingredient';\r\n         nameInput.value = editingIngredient.name;\r\n@@ -148,16 +85,15 @@\n     } else {\r\n         modalTitle.innerHTML = '<i class=\"fas fa-plus-circle me-2\"></i>Add Ingredient';\r\n     }\r\n \r\n-    // Update threshold span when unit changes\r\n+    // Update threshold unit on change\r\n     unitSelect.addEventListener('change', () => {\r\n         thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n     });\r\n \r\n     // Show modal\r\n-    const modal = new bootstrap.Modal(modalElem);\r\n-    modal.show();\r\n+    new bootstrap.Modal(modalElem).show();\r\n }\r\n \r\n // Save ingredient (add or edit)\r\n async function saveIngredient() {\r\n@@ -171,26 +107,29 @@\n         return;\r\n     }\r\n \r\n     try {\r\n-        // Optional validation\r\n-        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n+        // Validate existence in DB\r\n+        const [categoryRows, unitRows] = await Promise.all([\r\n+            ingredientCategoriesDB.show({ id: categoryId }),\r\n+            unitsDB.show({ id: unitId })\r\n+        ]);\r\n+\r\n         if (!categoryRows.length) throw new Error(\"Category not found\");\r\n-        const unitRows = await unitsDB.show({ id: unitId });\r\n         if (!unitRows.length) throw new Error(\"Unit not found\");\r\n \r\n         let response;\r\n         if (editingIngredient) {\r\n-            // Edit existing ingredient\r\n+            // Edit existing\r\n             response = await ingredientsDB.edit({\r\n                 id: editingIngredient.id,\r\n                 name,\r\n                 category_id: parseInt(categoryId),\r\n                 unit_id: parseInt(unitId),\r\n                 low_stock_threshold: threshold\r\n             });\r\n         } else {\r\n-            // Add new ingredient\r\n+            // Add new\r\n             response = await ingredientsDB.add({\r\n                 name,\r\n                 category_id: parseInt(categoryId),\r\n                 unit_id: parseInt(unitId),\r\n@@ -201,17 +140,17 @@\n         }\r\n \r\n         if (response.error) throw new Error(response.error);\r\n \r\n-        // Reset and close modal\r\n+        // Reset & close modal\r\n         document.getElementById(\"addIngredientForm\").reset();\r\n         const modalEl = document.getElementById(\"addIngredientModal\");\r\n         const modal = bootstrap.Modal.getInstance(modalEl);\r\n         if (modal) modal.hide();\r\n \r\n         editingIngredient = null;\r\n \r\n-        // Refresh masterlist if function exists\r\n+        // Refresh masterlist if exists\r\n         if (typeof loadIngredientsMasterlist === \"function\") loadIngredientsMasterlist();\r\n \r\n         console.log(`Ingredient \"${name}\" ${editingIngredient ? \"updated\" : \"added\"} successfully!`);\r\n \r\n@@ -222,4 +161,10 @@\n }\r\n \r\n // Bind save button once\r\n document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", saveIngredient);\r\n+\r\n+// Optional: load categories and units on page load (for faster modal opening)\r\n+document.addEventListener(\"DOMContentLoaded\", async () => {\r\n+    await loadCategories(document.getElementById(\"ingredientCategory\"));\r\n+    await loadUnits(document.getElementById(\"ingredientUnit\"));\r\n+});\r\n"
                },
                {
                    "date": 1771521842250,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -53,9 +53,9 @@\n     }\r\n }\r\n \r\n // Show Add/Edit Ingredient modal\r\n-async function showAddIngredientModal(ingredient = null) {\r\n+function showAddIngredientModal(ingredient = null) {\r\n     editingIngredient = ingredient;\r\n \r\n     const modalElem = document.getElementById('addIngredientModal');\r\n     if (!modalElem) return;\r\n"
                },
                {
                    "date": 1771521857856,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -53,9 +53,9 @@\n     }\r\n }\r\n \r\n // Show Add/Edit Ingredient modal\r\n-function showAddIngredientModal(ingredient = null) {\r\n+async \\\\\\function showAddIngredientModal(ingredient = null) {\r\n     editingIngredient = ingredient;\r\n \r\n     const modalElem = document.getElementById('addIngredientModal');\r\n     if (!modalElem) return;\r\n"
                },
                {
                    "date": 1771521897262,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,170 +1,223 @@\n-import { ingredientsDB, unitsDB, ingredientCategoriesDB } from \"./middle.js\";\r\n+import {ingredientsDB, unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n \r\n-let editingIngredient = null; // Track ingredient being edited\r\n \r\n-// Load units dynamically\r\n-async function loadUnits(unitSelect) {\r\n-    if (!unitSelect) return;\r\n+async function loadUnits() {\r\n+    console.log(\"üîÑ loadUnits() called\");\r\n+\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n+\r\n+    if (!unitSelect) {\r\n+        console.error(\"‚ùå ingredientUnit element NOT FOUND\");\r\n+        return;\r\n+    }\r\n+\r\n+    console.log(\"‚úî ingredientUnit element FOUND\");\r\n+\r\n     unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n \r\n     try {\r\n+        console.log(\"üì° Fetching units from unitsDB.show()...\");\r\n         const units = await unitsDB.show();\r\n+        console.log(\"üì• Units received:\", units);\r\n+\r\n         if (!units || units.length === 0) {\r\n+            console.warn(\"‚ö† No units found\");\r\n             unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n             return;\r\n         }\r\n \r\n+        console.log(`‚úî ${units.length} units found. Rendering...`);\r\n+\r\n         units.forEach(unit => {\r\n             const opt = document.createElement(\"option\");\r\n             opt.value = unit.id;\r\n             opt.textContent = unit.short_name || unit.name;\r\n-            opt.dataset.short = unit.short_name || unit.name; // for threshold\r\n             unitSelect.appendChild(opt);\r\n         });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Failed to load units:\", err);\r\n-        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n+        console.log(\"üéâ Units successfully loaded!\");\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"üî• ERROR loading units:\", error);\r\n     }\r\n }\r\n \r\n-// Load categories dynamically\r\n-async function loadCategories(categorySelect) {\r\n-    if (!categorySelect) return;\r\n+// Run on page load\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+    console.log(\"üåê DOMContentLoaded fired\");\r\n+    loadUnits();\r\n+});\r\n+\r\n+\r\n+async function loadIngredientCategories() {\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+\r\n+    if (!categorySelect) {\r\n+        console.error(\"‚ùå ingredientCategory element not found\");\r\n+        return;\r\n+    }\r\n+\r\n+    // Reset select\r\n     categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n \r\n     try {\r\n+        console.log(\"üì° Fetching categories from ingredientCategoriesDB...\");\r\n         const categories = await ingredientCategoriesDB.show();\r\n+        console.log(\"üì• Categories received:\", categories);\r\n+\r\n         if (!categories || categories.length === 0) {\r\n             categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n             return;\r\n         }\r\n \r\n         categories.forEach(cat => {\r\n             const opt = document.createElement(\"option\");\r\n-            opt.value = cat.id; // DB ID\r\n-            opt.textContent = cat.name;\r\n+            opt.value = cat.id;    // Save ID to ingredients table\r\n+            opt.textContent = cat.name; // Display name\r\n             categorySelect.appendChild(opt);\r\n         });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Failed to load categories:\", err);\r\n+        console.log(\"üéâ Ingredient categories loaded successfully!\");\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"üî• ERROR loading ingredient categories:\", error);\r\n         categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n     }\r\n }\r\n \r\n-// Show Add/Edit Ingredient modal\r\n-async \\\\\\function showAddIngredientModal(ingredient = null) {\r\n-    editingIngredient = ingredient;\r\n \r\n-    const modalElem = document.getElementById('addIngredientModal');\r\n-    if (!modalElem) return;\r\n-\r\n-    const modalTitle = modalElem.querySelector('.modal-title');\r\n-    const nameInput = document.getElementById('ingredientName');\r\n-    const categorySelect = document.getElementById('ingredientCategory');\r\n-    const unitSelect = document.getElementById('ingredientUnit');\r\n-    const thresholdInput = document.getElementById('lowStockThreshold');\r\n-    const thresholdSpan = document.getElementById('thresholdUnit');\r\n-\r\n-    // Reset form & threshold\r\n-    document.getElementById('addIngredientForm').reset();\r\n-    thresholdSpan.textContent = '';\r\n-\r\n-    // Load categories and units dynamically\r\n-    await Promise.all([loadCategories(categorySelect), loadUnits(unitSelect)]);\r\n-\r\n-    // Pre-fill if editing\r\n-    if (editingIngredient) {\r\n-        modalTitle.innerHTML = '<i class=\"fas fa-edit me-2\"></i>Edit Ingredient';\r\n-        nameInput.value = editingIngredient.name;\r\n-        categorySelect.value = editingIngredient.category_id;\r\n-        unitSelect.value = editingIngredient.unit_id;\r\n-        thresholdInput.value = editingIngredient.low_stock_threshold;\r\n-        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n-    } else {\r\n-        modalTitle.innerHTML = '<i class=\"fas fa-plus-circle me-2\"></i>Add Ingredient';\r\n-    }\r\n-\r\n-    // Update threshold unit on change\r\n-    unitSelect.addEventListener('change', () => {\r\n-        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n-    });\r\n-\r\n-    // Show modal\r\n-    new bootstrap.Modal(modalElem).show();\r\n-}\r\n-\r\n-// Save ingredient (add or edit)\r\n-async function saveIngredient() {\r\n+// Save ingredient when clicking the button\r\n+document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n     const name = document.getElementById(\"ingredientName\").value.trim();\r\n-    const categoryId = document.getElementById(\"ingredientCategory\").value;\r\n-    const unitId = document.getElementById(\"ingredientUnit\").value;\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n     const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n \r\n+    const categoryId = categorySelect.value; // ID from select\r\n+    const unitId = unitSelect.value;         // ID from select\r\n+\r\n+    // Validation\r\n     if (!name || !categoryId || !unitId) {\r\n         alert(\"Please fill out all required fields.\");\r\n         return;\r\n     }\r\n \r\n     try {\r\n-        // Validate existence in DB\r\n-        const [categoryRows, unitRows] = await Promise.all([\r\n-            ingredientCategoriesDB.show({ id: categoryId }),\r\n-            unitsDB.show({ id: unitId })\r\n-        ]);\r\n+        // Validate category exists\r\n+        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n+        if (!categoryRows || categoryRows.length === 0) {\r\n+            alert(\"Selected category not found in database.\");\r\n+            return;\r\n+        }\r\n \r\n-        if (!categoryRows.length) throw new Error(\"Category not found\");\r\n-        if (!unitRows.length) throw new Error(\"Unit not found\");\r\n+        // Validate unit exists\r\n+        const unitRows = await unitsDB.show({ id: unitId });\r\n+        if (!unitRows || unitRows.length === 0) {\r\n+            alert(\"Selected unit not found in database.\");\r\n+            return;\r\n+        }\r\n \r\n-        let response;\r\n-        if (editingIngredient) {\r\n-            // Edit existing\r\n-            response = await ingredientsDB.edit({\r\n-                id: editingIngredient.id,\r\n-                name,\r\n-                category_id: parseInt(categoryId),\r\n-                unit_id: parseInt(unitId),\r\n-                low_stock_threshold: threshold\r\n-            });\r\n-        } else {\r\n-            // Add new\r\n-            response = await ingredientsDB.add({\r\n-                name,\r\n-                category_id: parseInt(categoryId),\r\n-                unit_id: parseInt(unitId),\r\n-                low_stock_threshold: threshold,\r\n-                current_quantity: 0,\r\n-                status: \"active\"\r\n-            });\r\n+        // Insert ingredient into ingredientsDB\r\n+        const response = await ingredientsDB.add({\r\n+            name,\r\n+            category_id: parseInt(categoryId),\r\n+            unit_id: parseInt(unitId),\r\n+            low_stock_threshold: threshold,\r\n+            current_quantity: 0,\r\n+            status: \"active\"\r\n+        });\r\n+\r\n+        if (response.error) {\r\n+            alert(\"Failed to save ingredient: \" + response.error);\r\n+            return;\r\n         }\r\n \r\n-        if (response.error) throw new Error(response.error);\r\n+        // Reset form\r\n+        document.getElementById(\"addIngredientForm\").reset();\r\n \r\n-        // Reset & close modal\r\n-        document.getElementById(\"addIngredientForm\").reset();\r\n+        // Close modal\r\n         const modalEl = document.getElementById(\"addIngredientModal\");\r\n         const modal = bootstrap.Modal.getInstance(modalEl);\r\n         if (modal) modal.hide();\r\n \r\n-        editingIngredient = null;\r\n+        // Optional: reload masterlist\r\n+        if (typeof loadIngredientsMasterlist === \"function\") {\r\n+            loadIngredientsMasterlist();\r\n+        }\r\n \r\n-        // Refresh masterlist if exists\r\n-        if (typeof loadIngredientsMasterlist === \"function\") loadIngredientsMasterlist();\r\n+        console.log(`Ingredient \"${name}\" added successfully!`);\r\n \r\n-        console.log(`Ingredient \"${name}\" ${editingIngredient ? \"updated\" : \"added\"} successfully!`);\r\n-\r\n     } catch (err) {\r\n-        console.error(err);\r\n-        alert(\"Error saving ingredient: \" + err.message);\r\n+        console.error(\"Error inserting ingredient:\", err);\r\n+        alert(\"An error occurred. Check console for details.\");\r\n     }\r\n-}\r\n+});\r\n \r\n-// Bind save button once\r\n-document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", saveIngredient);\r\n \r\n-// Optional: load categories and units on page load (for faster modal opening)\r\n+// Load categories dynamically on page ready\r\n document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-    await loadCategories(document.getElementById(\"ingredientCategory\"));\r\n-    await loadUnits(document.getElementById(\"ingredientUnit\"));\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+    if (!categorySelect) return;\r\n+\r\n+    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n+\r\n+    try {\r\n+        const categories = await ingredientCategoriesDB.show();\r\n+        if (!categories || categories.length === 0) {\r\n+            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n+            return;\r\n+        }\r\n+\r\n+        categories.forEach(cat => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = cat.id;      // ID for DB\r\n+            opt.textContent = cat.name; // Display name\r\n+            categorySelect.appendChild(opt);\r\n+        });\r\n+\r\n+        console.log(\"Ingredient categories loaded successfully!\");\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading categories:\", err);\r\n+        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n+    }\r\n });\r\n+\r\n+// Optional: load units dynamically (similar pattern)\r\n+document.addEventListener(\"DOMContentLoaded\", async () => {\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n+    const thresholdSpan = document.getElementById(\"thresholdUnit\");\r\n+\r\n+    if (!unitSelect) return;\r\n+\r\n+    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n+    thresholdSpan.textContent = \"\";\r\n+\r\n+    try {\r\n+        const units = await unitsDB.show();\r\n+        if (!units || units.length === 0) {\r\n+            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n+            return;\r\n+        }\r\n+\r\n+        units.forEach(unit => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = unit.id;             // ID for DB\r\n+            opt.textContent = unit.short_name || unit.name;\r\n+            opt.dataset.short = unit.short_name || unit.name; // for threshold span\r\n+            unitSelect.appendChild(opt);\r\n+        });\r\n+\r\n+        console.log(\"Units loaded successfully!\");\r\n+\r\n+        // Update threshold span on unit change\r\n+        unitSelect.addEventListener(\"change\", () => {\r\n+            const selected = unitSelect.selectedOptions[0];\r\n+            thresholdSpan.textContent = selected?.dataset.short || \"\";\r\n+        });\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading units:\", err);\r\n+        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n+    }\r\n+});\r\n"
                },
                {
                    "date": 1771522136976,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,139 +85,223 @@\n     }\r\n }\r\n \r\n \r\n-// Save ingredient when clicking the button\r\n-document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n-    const name = document.getElementById(\"ingredientName\").value.trim();\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-    const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n+import { ingredientsDB, unitsDB, ingredientCategoriesDB } from \"./middle.js\";\r\n \r\n-    const categoryId = categorySelect.value; // ID from select\r\n-    const unitId = unitSelect.value;         // ID from select\r\n+let editingIngredient = null; // Track ingredient being edited globally\r\n \r\n-    // Validation\r\n-    if (!name || !categoryId || !unitId) {\r\n-        alert(\"Please fill out all required fields.\");\r\n-        return;\r\n+// Initialize masterlist\r\n+export function initializeIngredientsMasterlist() {\r\n+    const addIngredientBtn = document.getElementById('addIngredientBtn');\r\n+    if (addIngredientBtn) {\r\n+        addIngredientBtn.addEventListener('click', () => showAddIngredientModal());\r\n     }\r\n \r\n+    const setThresholdsBtn = document.getElementById('setThresholdsBtn');\r\n+    if (setThresholdsBtn) {\r\n+        setThresholdsBtn.addEventListener('click', showSetThresholdsModal);\r\n+    }\r\n+\r\n+    const searchInput = document.getElementById('masterIngredientSearch');\r\n+    if (searchInput) searchInput.addEventListener('input', loadIngredientsMasterlist);\r\n+\r\n+    const categoryFilter = document.getElementById('masterCategoryFilter');\r\n+    if (categoryFilter) categoryFilter.addEventListener('change', loadIngredientsMasterlist);\r\n+\r\n+    loadIngredientsMasterlist();\r\n+}\r\n+\r\n+// Load ingredients masterlist from DB\r\n+export async function loadIngredientsMasterlist() {\r\n+    const tableElement = document.getElementById('ingredientsMasterTable');\r\n+    if (!tableElement) return;\r\n+\r\n+    const tbody = tableElement.querySelector('tbody');\r\n+    const masterLowStockCount = document.getElementById('masterLowStockCount');\r\n+    const masterTotalIngredients = document.getElementById('masterTotalIngredients');\r\n+\r\n+    const searchQuery = (document.getElementById('masterIngredientSearch')?.value || '').toLowerCase().trim();\r\n+    const categoryFilter = document.getElementById('masterCategoryFilter')?.value || '';\r\n+\r\n     try {\r\n-        // Validate category exists\r\n-        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n-        if (!categoryRows || categoryRows.length === 0) {\r\n-            alert(\"Selected category not found in database.\");\r\n-            return;\r\n-        }\r\n+        let ingredients = await ingredientsDB.show(); // Fetch all ingredients\r\n+        if (!ingredients) ingredients = [];\r\n \r\n-        // Validate unit exists\r\n-        const unitRows = await unitsDB.show({ id: unitId });\r\n-        if (!unitRows || unitRows.length === 0) {\r\n-            alert(\"Selected unit not found in database.\");\r\n-            return;\r\n-        }\r\n+        // Filter\r\n+        if (categoryFilter) ingredients = ingredients.filter(i => i.category_id == categoryFilter);\r\n+        if (searchQuery) ingredients = ingredients.filter(i =>\r\n+            i.name.toLowerCase().includes(searchQuery) ||\r\n+            i.id.toString().includes(searchQuery)\r\n+        );\r\n \r\n-        // Insert ingredient into ingredientsDB\r\n-        const response = await ingredientsDB.add({\r\n-            name,\r\n-            category_id: parseInt(categoryId),\r\n-            unit_id: parseInt(unitId),\r\n-            low_stock_threshold: threshold,\r\n-            current_quantity: 0,\r\n-            status: \"active\"\r\n-        });\r\n+        // Count low stock (on all items)\r\n+        const allIngredients = await ingredientsDB.show();\r\n+        const lowStockCount = allIngredients.filter(i => i.current_quantity <= i.low_stock_threshold).length;\r\n \r\n-        if (response.error) {\r\n-            alert(\"Failed to save ingredient: \" + response.error);\r\n+        if (masterLowStockCount) masterLowStockCount.textContent = lowStockCount;\r\n+        if (masterTotalIngredients) masterTotalIngredients.textContent = allIngredients.length;\r\n+\r\n+        tbody.innerHTML = '';\r\n+        if (ingredients.length === 0) {\r\n+            tbody.innerHTML = '<tr><td colspan=\"9\" class=\"text-center text-muted py-4\">No ingredients found.</td></tr>';\r\n             return;\r\n         }\r\n \r\n-        // Reset form\r\n-        document.getElementById(\"addIngredientForm\").reset();\r\n+        // Optional: fetch recipes if used\r\n+        const recipes = typeof getRecipes === \"function\" ? getRecipes() : [];\r\n \r\n-        // Close modal\r\n-        const modalEl = document.getElementById(\"addIngredientModal\");\r\n-        const modal = bootstrap.Modal.getInstance(modalEl);\r\n-        if (modal) modal.hide();\r\n+        ingredients.forEach(ing => {\r\n+            const isLow = ing.current_quantity <= ing.low_stock_threshold;\r\n+            const usedInCount = recipes.filter(r =>\r\n+                r.ingredients.some(ri => ri.name === ing.name)\r\n+            ).length;\r\n \r\n-        // Optional: reload masterlist\r\n-        if (typeof loadIngredientsMasterlist === \"function\") {\r\n-            loadIngredientsMasterlist();\r\n-        }\r\n+            const row = tbody.insertRow();\r\n+            row.classList.add('animate__animated', 'animate__fadeIn');\r\n+            row.innerHTML = `\r\n+                <td>${ing.id}</td>\r\n+                <td><strong>${ing.name}</strong></td>\r\n+                <td><span class=\"badge bg-secondary\">${ing.category_name || ing.category_id}</span></td>\r\n+                <td>${ing.unit_name || ing.unit_id}</td>\r\n+                <td class=\"${isLow ? 'text-danger fw-bold' : ''}\">${ing.current_quantity} ${ing.unit_name || ing.unit_id}</td>\r\n+                <td>${ing.low_stock_threshold} ${ing.unit_name || ing.unit_id}</td>\r\n+                <td><span class=\"badge ${!isLow ? 'bg-success' : 'bg-warning'}\">${!isLow ? 'Normal' : 'Low Stock'}</span></td>\r\n+                <td><span class=\"badge bg-info\">${usedInCount} menu items</span></td>\r\n+                <td>\r\n+                    <div class=\"table-actions\">\r\n+                        <button class=\"btn btn-sm btn-outline-primary\" onclick=\"editIngredient(${ing.id})\" title=\"Edit\">\r\n+                            <i class=\"fas fa-edit\"></i>\r\n+                        </button>\r\n+                        <button class=\"btn btn-sm btn-outline-danger\" onclick=\"deleteIngredient(${ing.id})\" title=\"Delete\">\r\n+                            <i class=\"fas fa-trash\"></i>\r\n+                        </button>\r\n+                    </div>\r\n+                </td>\r\n+            `;\r\n+        });\r\n \r\n-        console.log(`Ingredient \"${name}\" added successfully!`);\r\n-\r\n     } catch (err) {\r\n-        console.error(\"Error inserting ingredient:\", err);\r\n-        alert(\"An error occurred. Check console for details.\");\r\n+        console.error(\"Error loading ingredients:\", err);\r\n+        tbody.innerHTML = '<tr><td colspan=\"9\" class=\"text-center text-danger py-4\">Failed to load ingredients.</td></tr>';\r\n     }\r\n-});\r\n+}\r\n \r\n+// Show Add/Edit Ingredient modal\r\n+export async function showAddIngredientModal(ingredient = null) {\r\n+    editingIngredient = ingredient;\r\n \r\n-// Load categories dynamically on page ready\r\n-document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-    if (!categorySelect) return;\r\n+    const modalElem = document.getElementById('addIngredientModal');\r\n+    if (!modalElem) return;\r\n \r\n-    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n+    const modalTitle = modalElem.querySelector('.modal-title');\r\n+    const nameInput = document.getElementById('ingredientName');\r\n+    const categorySelect = document.getElementById('ingredientCategory');\r\n+    const unitSelect = document.getElementById('ingredientUnit');\r\n+    const thresholdInput = document.getElementById('lowStockThreshold');\r\n+    const thresholdSpan = document.getElementById('thresholdUnit');\r\n \r\n-    try {\r\n-        const categories = await ingredientCategoriesDB.show();\r\n-        if (!categories || categories.length === 0) {\r\n-            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n-            return;\r\n-        }\r\n+    document.getElementById('addIngredientForm').reset();\r\n+    thresholdSpan.textContent = '';\r\n \r\n-        categories.forEach(cat => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = cat.id;      // ID for DB\r\n-            opt.textContent = cat.name; // Display name\r\n-            categorySelect.appendChild(opt);\r\n-        });\r\n+    // Load categories & units dynamically\r\n+    await Promise.all([\r\n+        loadCategories(categorySelect),\r\n+        loadUnits(unitSelect)\r\n+    ]);\r\n \r\n-        console.log(\"Ingredient categories loaded successfully!\");\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading categories:\", err);\r\n-        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n+    if (editingIngredient) {\r\n+        modalTitle.innerHTML = '<i class=\"fas fa-edit me-2\"></i>Edit Ingredient';\r\n+        nameInput.value = editingIngredient.name;\r\n+        categorySelect.value = editingIngredient.category_id;\r\n+        unitSelect.value = editingIngredient.unit_id;\r\n+        thresholdInput.value = editingIngredient.low_stock_threshold;\r\n+        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n+    } else {\r\n+        modalTitle.innerHTML = '<i class=\"fas fa-plus-circle me-2\"></i>Add Ingredient';\r\n     }\r\n-});\r\n \r\n-// Optional: load units dynamically (similar pattern)\r\n-document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-    const thresholdSpan = document.getElementById(\"thresholdUnit\");\r\n+    unitSelect.addEventListener('change', () => {\r\n+        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n+    });\r\n \r\n-    if (!unitSelect) return;\r\n+    new bootstrap.Modal(modalElem).show();\r\n+}\r\n \r\n-    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n-    thresholdSpan.textContent = \"\";\r\n+// Edit ingredient by id\r\n+export async function editIngredient(id) {\r\n+    try {\r\n+        const rows = await ingredientsDB.show({ id });\r\n+        if (!rows.length) return alert(\"Ingredient not found\");\r\n+        showAddIngredientModal(rows[0]);\r\n+    } catch (err) {\r\n+        console.error(\"Failed to edit ingredient:\", err);\r\n+    }\r\n+}\r\n \r\n+// Delete ingredient by id\r\n+export async function deleteIngredient(id) {\r\n     try {\r\n-        const units = await unitsDB.show();\r\n-        if (!units || units.length === 0) {\r\n-            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n-            return;\r\n-        }\r\n+        const rows = await ingredientsDB.show({ id });\r\n+        if (!rows.length) return;\r\n+        const ing = rows[0];\r\n \r\n-        units.forEach(unit => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = unit.id;             // ID for DB\r\n-            opt.textContent = unit.short_name || unit.name;\r\n-            opt.dataset.short = unit.short_name || unit.name; // for threshold span\r\n-            unitSelect.appendChild(opt);\r\n+        showConfirm(`Are you sure you want to delete \"${ing.name}\"? This will also remove it from any assigned recipes.`, async () => {\r\n+            const response = await ingredientsDB.delete(id);\r\n+            if (response.error) throw new Error(response.error);\r\n+\r\n+            showModalNotification(`\"${ing.name}\" has been deleted`, 'success', 'Ingredient Deleted');\r\n+            if (typeof loadIngredientsMasterlist === \"function\") loadIngredientsMasterlist();\r\n         });\r\n+    } catch (err) {\r\n+        console.error(\"Failed to delete ingredient:\", err);\r\n+        alert(\"Error deleting ingredient: \" + err.message);\r\n+    }\r\n+}\r\n \r\n-        console.log(\"Units loaded successfully!\");\r\n+// Show Set Thresholds modal\r\n+export function showSetThresholdsModal() {\r\n+    Swal.fire({\r\n+        title: 'Global Stock Thresholds',\r\n+        html: `\r\n+            <div class=\"text-start\">\r\n+                <p class=\"small text-muted mb-3\">Update warning thresholds for all categories.</p>\r\n+                <div class=\"mb-3\">\r\n+                    <label class=\"form-label\">Meat & Poultry (kg)</label>\r\n+                    <input type=\"number\" id=\"swal-meat\" class=\"swal2-input mt-0\" value=\"5\">\r\n+                </div>\r\n+                <div class=\"mb-3\">\r\n+                    <label class=\"form-label\">Vegetables (kg)</label>\r\n+                    <input type=\"number\" id=\"swal-veg\" class=\"swal2-input mt-0\" value=\"3\">\r\n+                </div>\r\n+                <p class=\"small text-danger\">Note: This will reset all individual thresholds in these categories.</p>\r\n+            </div>\r\n+        `,\r\n+        showCancelButton: true,\r\n+        confirmButtonText: 'Update All',\r\n+        confirmButtonColor: '#dc3545',\r\n+        preConfirm: () => ({\r\n+            meat: parseFloat(document.getElementById('swal-meat').value),\r\n+            veg: parseFloat(document.getElementById('swal-veg').value)\r\n+        })\r\n+    }).then(async (result) => {\r\n+        if (!result.isConfirmed) return;\r\n \r\n-        // Update threshold span on unit change\r\n-        unitSelect.addEventListener(\"change\", () => {\r\n-            const selected = unitSelect.selectedOptions[0];\r\n-            thresholdSpan.textContent = selected?.dataset.short || \"\";\r\n-        });\r\n+        try {\r\n+            const ingredients = await ingredientsDB.show();\r\n+            const updated = ingredients.map(ing => {\r\n+                if (ing.category_name === 'Meat') ing.low_stock_threshold = result.value.meat;\r\n+                if (ing.category_name === 'Vegetables') ing.low_stock_threshold = result.value.veg;\r\n+                return ing;\r\n+            });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading units:\", err);\r\n-        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n-    }\r\n-});\r\n+            // Save updates\r\n+            for (const ing of updated) await ingredientsDB.edit(ing);\r\n+\r\n+            showModalNotification('Thresholds updated successfully', 'success', 'Bulk Update');\r\n+            if (typeof loadIngredientsMasterlist === \"function\") loadIngredientsMasterlist();\r\n+        } catch (err) {\r\n+            console.error(err);\r\n+            alert(\"Error updating thresholds: \" + err.message);\r\n+        }\r\n+    });\r\n+}\r\n"
                },
                {
                    "date": 1771522157011,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,8 @@\n     }\r\n }\r\n \r\n \r\n-import { ingredientsDB, unitsDB, ingredientCategoriesDB } from \"./middle.js\";\r\n \r\n let editingIngredient = null; // Track ingredient being edited globally\r\n \r\n // Initialize masterlist\r\n"
                },
                {
                    "date": 1771522501813,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -256,8 +256,15 @@\n         alert(\"Error deleting ingredient: \" + err.message);\r\n     }\r\n }\r\n \r\n+// admin-feature.js\r\n+window.initializeIngredientsMasterlist = function() {\r\n+    console.log(\"Masterlist initialized!\");\r\n+    // ...rest of your code\r\n+}\r\n+\r\n+\r\n // Show Set Thresholds modal\r\n export function showSetThresholdsModal() {\r\n     Swal.fire({\r\n         title: 'Global Stock Thresholds',\r\n"
                },
                {
                    "date": 1771522562598,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -257,14 +257,9 @@\n     }\r\n }\r\n \r\n // admin-feature.js\r\n-window.initializeIngredientsMasterlist = function() {\r\n-    console.log(\"Masterlist initialized!\");\r\n-    // ...rest of your code\r\n-}\r\n \r\n-\r\n // Show Set Thresholds modal\r\n export function showSetThresholdsModal() {\r\n     Swal.fire({\r\n         title: 'Global Stock Thresholds',\r\n"
                },
                {
                    "date": 1771522580112,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,8 +86,9 @@\n }\r\n \r\n \r\n \r\n+\r\n let editingIngredient = null; // Track ingredient being edited globally\r\n \r\n // Initialize masterlist\r\n export function initializeIngredientsMasterlist() {\r\n@@ -256,10 +257,8 @@\n         alert(\"Error deleting ingredient: \" + err.message);\r\n     }\r\n }\r\n \r\n-// admin-feature.js\r\n-\r\n // Show Set Thresholds modal\r\n export function showSetThresholdsModal() {\r\n     Swal.fire({\r\n         title: 'Global Stock Thresholds',\r\n"
                },
                {
                    "date": 1771522585698,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,223 +85,138 @@\n     }\r\n }\r\n \r\n \r\n+// Save ingredient when clicking the button\r\n+document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n+    const name = document.getElementById(\"ingredientName\").value.trim();\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n+    const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n \r\n+    const categoryId = categorySelect.value; // ID from select\r\n+    const unitId = unitSelect.value;         // ID from select\r\n \r\n-let editingIngredient = null; // Track ingredient being edited globally\r\n-\r\n-// Initialize masterlist\r\n-export function initializeIngredientsMasterlist() {\r\n-    const addIngredientBtn = document.getElementById('addIngredientBtn');\r\n-    if (addIngredientBtn) {\r\n-        addIngredientBtn.addEventListener('click', () => showAddIngredientModal());\r\n+    // Validation\r\n+    if (!name || !categoryId || !unitId) {\r\n+        alert(\"Please fill out all required fields.\");\r\n+        return;\r\n     }\r\n \r\n-    const setThresholdsBtn = document.getElementById('setThresholdsBtn');\r\n-    if (setThresholdsBtn) {\r\n-        setThresholdsBtn.addEventListener('click', showSetThresholdsModal);\r\n-    }\r\n-\r\n-    const searchInput = document.getElementById('masterIngredientSearch');\r\n-    if (searchInput) searchInput.addEventListener('input', loadIngredientsMasterlist);\r\n-\r\n-    const categoryFilter = document.getElementById('masterCategoryFilter');\r\n-    if (categoryFilter) categoryFilter.addEventListener('change', loadIngredientsMasterlist);\r\n-\r\n-    loadIngredientsMasterlist();\r\n-}\r\n-\r\n-// Load ingredients masterlist from DB\r\n-export async function loadIngredientsMasterlist() {\r\n-    const tableElement = document.getElementById('ingredientsMasterTable');\r\n-    if (!tableElement) return;\r\n-\r\n-    const tbody = tableElement.querySelector('tbody');\r\n-    const masterLowStockCount = document.getElementById('masterLowStockCount');\r\n-    const masterTotalIngredients = document.getElementById('masterTotalIngredients');\r\n-\r\n-    const searchQuery = (document.getElementById('masterIngredientSearch')?.value || '').toLowerCase().trim();\r\n-    const categoryFilter = document.getElementById('masterCategoryFilter')?.value || '';\r\n-\r\n     try {\r\n-        let ingredients = await ingredientsDB.show(); // Fetch all ingredients\r\n-        if (!ingredients) ingredients = [];\r\n+        // Validate category exists\r\n+        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n+        if (!categoryRows || categoryRows.length === 0) {\r\n+            alert(\"Selected category not found in database.\");\r\n+            return;\r\n+        }\r\n \r\n-        // Filter\r\n-        if (categoryFilter) ingredients = ingredients.filter(i => i.category_id == categoryFilter);\r\n-        if (searchQuery) ingredients = ingredients.filter(i =>\r\n-            i.name.toLowerCase().includes(searchQuery) ||\r\n-            i.id.toString().includes(searchQuery)\r\n-        );\r\n+        // Validate unit exists\r\n+        const unitRows = await unitsDB.show({ id: unitId });\r\n+        if (!unitRows || unitRows.length === 0) {\r\n+            alert(\"Selected unit not found in database.\");\r\n+            return;\r\n+        }\r\n \r\n-        // Count low stock (on all items)\r\n-        const allIngredients = await ingredientsDB.show();\r\n-        const lowStockCount = allIngredients.filter(i => i.current_quantity <= i.low_stock_threshold).length;\r\n+        // Insert ingredient into ingredientsDB\r\n+        const response = await ingredientsDB.add({\r\n+            name,\r\n+            category_id: parseInt(categoryId),\r\n+            unit_id: parseInt(unitId),\r\n+            low_stock_threshold: threshold,\r\n+            current_quantity: 0,\r\n+            status: \"active\"\r\n+        });\r\n \r\n-        if (masterLowStockCount) masterLowStockCount.textContent = lowStockCount;\r\n-        if (masterTotalIngredients) masterTotalIngredients.textContent = allIngredients.length;\r\n-\r\n-        tbody.innerHTML = '';\r\n-        if (ingredients.length === 0) {\r\n-            tbody.innerHTML = '<tr><td colspan=\"9\" class=\"text-center text-muted py-4\">No ingredients found.</td></tr>';\r\n+        if (response.error) {\r\n+            alert(\"Failed to save ingredient: \" + response.error);\r\n             return;\r\n         }\r\n \r\n-        // Optional: fetch recipes if used\r\n-        const recipes = typeof getRecipes === \"function\" ? getRecipes() : [];\r\n+        // Reset form\r\n+        document.getElementById(\"addIngredientForm\").reset();\r\n \r\n-        ingredients.forEach(ing => {\r\n-            const isLow = ing.current_quantity <= ing.low_stock_threshold;\r\n-            const usedInCount = recipes.filter(r =>\r\n-                r.ingredients.some(ri => ri.name === ing.name)\r\n-            ).length;\r\n+        // Close modal\r\n+        const modalEl = document.getElementById(\"addIngredientModal\");\r\n+        const modal = bootstrap.Modal.getInstance(modalEl);\r\n+        if (modal) modal.hide();\r\n \r\n-            const row = tbody.insertRow();\r\n-            row.classList.add('animate__animated', 'animate__fadeIn');\r\n-            row.innerHTML = `\r\n-                <td>${ing.id}</td>\r\n-                <td><strong>${ing.name}</strong></td>\r\n-                <td><span class=\"badge bg-secondary\">${ing.category_name || ing.category_id}</span></td>\r\n-                <td>${ing.unit_name || ing.unit_id}</td>\r\n-                <td class=\"${isLow ? 'text-danger fw-bold' : ''}\">${ing.current_quantity} ${ing.unit_name || ing.unit_id}</td>\r\n-                <td>${ing.low_stock_threshold} ${ing.unit_name || ing.unit_id}</td>\r\n-                <td><span class=\"badge ${!isLow ? 'bg-success' : 'bg-warning'}\">${!isLow ? 'Normal' : 'Low Stock'}</span></td>\r\n-                <td><span class=\"badge bg-info\">${usedInCount} menu items</span></td>\r\n-                <td>\r\n-                    <div class=\"table-actions\">\r\n-                        <button class=\"btn btn-sm btn-outline-primary\" onclick=\"editIngredient(${ing.id})\" title=\"Edit\">\r\n-                            <i class=\"fas fa-edit\"></i>\r\n-                        </button>\r\n-                        <button class=\"btn btn-sm btn-outline-danger\" onclick=\"deleteIngredient(${ing.id})\" title=\"Delete\">\r\n-                            <i class=\"fas fa-trash\"></i>\r\n-                        </button>\r\n-                    </div>\r\n-                </td>\r\n-            `;\r\n-        });\r\n+        // Optional: reload masterlist\r\n+        if (typeof loadIngredientsMasterlist === \"function\") {\r\n+            loadIngredientsMasterlist();\r\n+        }\r\n \r\n+        console.log(`Ingredient \"${name}\" added successfully!`);\r\n+\r\n     } catch (err) {\r\n-        console.error(\"Error loading ingredients:\", err);\r\n-        tbody.innerHTML = '<tr><td colspan=\"9\" class=\"text-center text-danger py-4\">Failed to load ingredients.</td></tr>';\r\n+        console.error(\"Error inserting ingredient:\", err);\r\n+        alert(\"An error occurred. Check console for details.\");\r\n     }\r\n-}\r\n+});\r\n \r\n-// Show Add/Edit Ingredient modal\r\n-export async function showAddIngredientModal(ingredient = null) {\r\n-    editingIngredient = ingredient;\r\n+// Load categories dynamically on page ready\r\n+document.addEventListener(\"DOMContentLoaded\", async () => {\r\n+    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n+    if (!categorySelect) return;\r\n \r\n-    const modalElem = document.getElementById('addIngredientModal');\r\n-    if (!modalElem) return;\r\n+    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n \r\n-    const modalTitle = modalElem.querySelector('.modal-title');\r\n-    const nameInput = document.getElementById('ingredientName');\r\n-    const categorySelect = document.getElementById('ingredientCategory');\r\n-    const unitSelect = document.getElementById('ingredientUnit');\r\n-    const thresholdInput = document.getElementById('lowStockThreshold');\r\n-    const thresholdSpan = document.getElementById('thresholdUnit');\r\n+    try {\r\n+        const categories = await ingredientCategoriesDB.show();\r\n+        if (!categories || categories.length === 0) {\r\n+            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n+            return;\r\n+        }\r\n \r\n-    document.getElementById('addIngredientForm').reset();\r\n-    thresholdSpan.textContent = '';\r\n+        categories.forEach(cat => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = cat.id;      // ID for DB\r\n+            opt.textContent = cat.name; // Display name\r\n+            categorySelect.appendChild(opt);\r\n+        });\r\n \r\n-    // Load categories & units dynamically\r\n-    await Promise.all([\r\n-        loadCategories(categorySelect),\r\n-        loadUnits(unitSelect)\r\n-    ]);\r\n+        console.log(\"Ingredient categories loaded successfully!\");\r\n \r\n-    if (editingIngredient) {\r\n-        modalTitle.innerHTML = '<i class=\"fas fa-edit me-2\"></i>Edit Ingredient';\r\n-        nameInput.value = editingIngredient.name;\r\n-        categorySelect.value = editingIngredient.category_id;\r\n-        unitSelect.value = editingIngredient.unit_id;\r\n-        thresholdInput.value = editingIngredient.low_stock_threshold;\r\n-        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n-    } else {\r\n-        modalTitle.innerHTML = '<i class=\"fas fa-plus-circle me-2\"></i>Add Ingredient';\r\n+    } catch (err) {\r\n+        console.error(\"Error loading categories:\", err);\r\n+        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n     }\r\n+});\r\n \r\n-    unitSelect.addEventListener('change', () => {\r\n-        thresholdSpan.textContent = unitSelect.selectedOptions[0]?.dataset.short || '';\r\n-    });\r\n+// Optional: load units dynamically (similar pattern)\r\n+document.addEventListener(\"DOMContentLoaded\", async () => {\r\n+    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n+    const thresholdSpan = document.getElementById(\"thresholdUnit\");\r\n \r\n-    new bootstrap.Modal(modalElem).show();\r\n-}\r\n+    if (!unitSelect) return;\r\n \r\n-// Edit ingredient by id\r\n-export async function editIngredient(id) {\r\n-    try {\r\n-        const rows = await ingredientsDB.show({ id });\r\n-        if (!rows.length) return alert(\"Ingredient not found\");\r\n-        showAddIngredientModal(rows[0]);\r\n-    } catch (err) {\r\n-        console.error(\"Failed to edit ingredient:\", err);\r\n-    }\r\n-}\r\n+    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n+    thresholdSpan.textContent = \"\";\r\n \r\n-// Delete ingredient by id\r\n-export async function deleteIngredient(id) {\r\n     try {\r\n-        const rows = await ingredientsDB.show({ id });\r\n-        if (!rows.length) return;\r\n-        const ing = rows[0];\r\n+        const units = await unitsDB.show();\r\n+        if (!units || units.length === 0) {\r\n+            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n+            return;\r\n+        }\r\n \r\n-        showConfirm(`Are you sure you want to delete \"${ing.name}\"? This will also remove it from any assigned recipes.`, async () => {\r\n-            const response = await ingredientsDB.delete(id);\r\n-            if (response.error) throw new Error(response.error);\r\n+        units.forEach(unit => {\r\n+            const opt = document.createElement(\"option\");\r\n+            opt.value = unit.id;             // ID for DB\r\n+            opt.textContent = unit.short_name || unit.name;\r\n+            opt.dataset.short = unit.short_name || unit.name; // for threshold span\r\n+            unitSelect.appendChild(opt);\r\n+        });\r\n \r\n-            showModalNotification(`\"${ing.name}\" has been deleted`, 'success', 'Ingredient Deleted');\r\n-            if (typeof loadIngredientsMasterlist === \"function\") loadIngredientsMasterlist();\r\n+        console.log(\"Units loaded successfully!\");\r\n+\r\n+        // Update threshold span on unit change\r\n+        unitSelect.addEventListener(\"change\", () => {\r\n+            const selected = unitSelect.selectedOptions[0];\r\n+            thresholdSpan.textContent = selected?.dataset.short || \"\";\r\n         });\r\n+\r\n     } catch (err) {\r\n-        console.error(\"Failed to delete ingredient:\", err);\r\n-        alert(\"Error deleting ingredient: \" + err.message);\r\n+        console.error(\"Error loading units:\", err);\r\n+        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n     }\r\n-}\r\n-\r\n-// Show Set Thresholds modal\r\n-export function showSetThresholdsModal() {\r\n-    Swal.fire({\r\n-        title: 'Global Stock Thresholds',\r\n-        html: `\r\n-            <div class=\"text-start\">\r\n-                <p class=\"small text-muted mb-3\">Update warning thresholds for all categories.</p>\r\n-                <div class=\"mb-3\">\r\n-                    <label class=\"form-label\">Meat & Poultry (kg)</label>\r\n-                    <input type=\"number\" id=\"swal-meat\" class=\"swal2-input mt-0\" value=\"5\">\r\n-                </div>\r\n-                <div class=\"mb-3\">\r\n-                    <label class=\"form-label\">Vegetables (kg)</label>\r\n-                    <input type=\"number\" id=\"swal-veg\" class=\"swal2-input mt-0\" value=\"3\">\r\n-                </div>\r\n-                <p class=\"small text-danger\">Note: This will reset all individual thresholds in these categories.</p>\r\n-            </div>\r\n-        `,\r\n-        showCancelButton: true,\r\n-        confirmButtonText: 'Update All',\r\n-        confirmButtonColor: '#dc3545',\r\n-        preConfirm: () => ({\r\n-            meat: parseFloat(document.getElementById('swal-meat').value),\r\n-            veg: parseFloat(document.getElementById('swal-veg').value)\r\n-        })\r\n-    }).then(async (result) => {\r\n-        if (!result.isConfirmed) return;\r\n-\r\n-        try {\r\n-            const ingredients = await ingredientsDB.show();\r\n-            const updated = ingredients.map(ing => {\r\n-                if (ing.category_name === 'Meat') ing.low_stock_threshold = result.value.meat;\r\n-                if (ing.category_name === 'Vegetables') ing.low_stock_threshold = result.value.veg;\r\n-                return ing;\r\n-            });\r\n-\r\n-            // Save updates\r\n-            for (const ing of updated) await ingredientsDB.edit(ing);\r\n-\r\n-            showModalNotification('Thresholds updated successfully', 'success', 'Bulk Update');\r\n-            if (typeof loadIngredientsMasterlist === \"function\") loadIngredientsMasterlist();\r\n-        } catch (err) {\r\n-            console.error(err);\r\n-            alert(\"Error updating thresholds: \" + err.message);\r\n-        }\r\n-    });\r\n-}\r\n+});\r\n"
                },
                {
                    "date": 1771522596124,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,8 +85,9 @@\n     }\r\n }\r\n \r\n \r\n+\r\n // Save ingredient when clicking the button\r\n document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n     const name = document.getElementById(\"ingredientName\").value.trim();\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n"
                },
                {
                    "date": 1771522926118,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,93 +1,9 @@\n import {ingredientsDB, unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n \r\n \r\n-async function loadUnits() {\r\n-    console.log(\"üîÑ loadUnits() called\");\r\n \r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n \r\n-    if (!unitSelect) {\r\n-        console.error(\"‚ùå ingredientUnit element NOT FOUND\");\r\n-        return;\r\n-    }\r\n-\r\n-    console.log(\"‚úî ingredientUnit element FOUND\");\r\n-\r\n-    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n-\r\n-    try {\r\n-        console.log(\"üì° Fetching units from unitsDB.show()...\");\r\n-        const units = await unitsDB.show();\r\n-        console.log(\"üì• Units received:\", units);\r\n-\r\n-        if (!units || units.length === 0) {\r\n-            console.warn(\"‚ö† No units found\");\r\n-            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n-            return;\r\n-        }\r\n-\r\n-        console.log(`‚úî ${units.length} units found. Rendering...`);\r\n-\r\n-        units.forEach(unit => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = unit.id;\r\n-            opt.textContent = unit.short_name || unit.name;\r\n-            unitSelect.appendChild(opt);\r\n-        });\r\n-\r\n-        console.log(\"üéâ Units successfully loaded!\");\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"üî• ERROR loading units:\", error);\r\n-    }\r\n-}\r\n-\r\n-// Run on page load\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-    console.log(\"üåê DOMContentLoaded fired\");\r\n-    loadUnits();\r\n-});\r\n-\r\n-\r\n-async function loadIngredientCategories() {\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-\r\n-    if (!categorySelect) {\r\n-        console.error(\"‚ùå ingredientCategory element not found\");\r\n-        return;\r\n-    }\r\n-\r\n-    // Reset select\r\n-    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n-\r\n-    try {\r\n-        console.log(\"üì° Fetching categories from ingredientCategoriesDB...\");\r\n-        const categories = await ingredientCategoriesDB.show();\r\n-        console.log(\"üì• Categories received:\", categories);\r\n-\r\n-        if (!categories || categories.length === 0) {\r\n-            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n-            return;\r\n-        }\r\n-\r\n-        categories.forEach(cat => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = cat.id;    // Save ID to ingredients table\r\n-            opt.textContent = cat.name; // Display name\r\n-            categorySelect.appendChild(opt);\r\n-        });\r\n-\r\n-        console.log(\"üéâ Ingredient categories loaded successfully!\");\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"üî• ERROR loading ingredient categories:\", error);\r\n-        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n-    }\r\n-}\r\n-\r\n-\r\n-\r\n // Save ingredient when clicking the button\r\n document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n     const name = document.getElementById(\"ingredientName\").value.trim();\r\n     const categorySelect = document.getElementById(\"ingredientCategory\");\r\n"
                },
                {
                    "date": 1771524381198,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,139 +1,1 @@\n-import {ingredientsDB, unitsDB, ingredientCategoriesDB  } from \"./middle.js\";\r\n-\r\n-\r\n-\r\n-\r\n-// Save ingredient when clicking the button\r\n-document.getElementById(\"saveIngredientBtn\").addEventListener(\"click\", async () => {\r\n-    const name = document.getElementById(\"ingredientName\").value.trim();\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-    const threshold = parseFloat(document.getElementById(\"lowStockThreshold\").value) || 0;\r\n-\r\n-    const categoryId = categorySelect.value; // ID from select\r\n-    const unitId = unitSelect.value;         // ID from select\r\n-\r\n-    // Validation\r\n-    if (!name || !categoryId || !unitId) {\r\n-        alert(\"Please fill out all required fields.\");\r\n-        return;\r\n-    }\r\n-\r\n-    try {\r\n-        // Validate category exists\r\n-        const categoryRows = await ingredientCategoriesDB.show({ id: categoryId });\r\n-        if (!categoryRows || categoryRows.length === 0) {\r\n-            alert(\"Selected category not found in database.\");\r\n-            return;\r\n-        }\r\n-\r\n-        // Validate unit exists\r\n-        const unitRows = await unitsDB.show({ id: unitId });\r\n-        if (!unitRows || unitRows.length === 0) {\r\n-            alert(\"Selected unit not found in database.\");\r\n-            return;\r\n-        }\r\n-\r\n-        // Insert ingredient into ingredientsDB\r\n-        const response = await ingredientsDB.add({\r\n-            name,\r\n-            category_id: parseInt(categoryId),\r\n-            unit_id: parseInt(unitId),\r\n-            low_stock_threshold: threshold,\r\n-            current_quantity: 0,\r\n-            status: \"active\"\r\n-        });\r\n-\r\n-        if (response.error) {\r\n-            alert(\"Failed to save ingredient: \" + response.error);\r\n-            return;\r\n-        }\r\n-\r\n-        // Reset form\r\n-        document.getElementById(\"addIngredientForm\").reset();\r\n-\r\n-        // Close modal\r\n-        const modalEl = document.getElementById(\"addIngredientModal\");\r\n-        const modal = bootstrap.Modal.getInstance(modalEl);\r\n-        if (modal) modal.hide();\r\n-\r\n-        // Optional: reload masterlist\r\n-        if (typeof loadIngredientsMasterlist === \"function\") {\r\n-            loadIngredientsMasterlist();\r\n-        }\r\n-\r\n-        console.log(`Ingredient \"${name}\" added successfully!`);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error inserting ingredient:\", err);\r\n-        alert(\"An error occurred. Check console for details.\");\r\n-    }\r\n-});\r\n-\r\n-// Load categories dynamically on page ready\r\n-document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-    const categorySelect = document.getElementById(\"ingredientCategory\");\r\n-    if (!categorySelect) return;\r\n-\r\n-    categorySelect.innerHTML = `<option value=\"\">Select Category</option>`;\r\n-\r\n-    try {\r\n-        const categories = await ingredientCategoriesDB.show();\r\n-        if (!categories || categories.length === 0) {\r\n-            categorySelect.innerHTML = `<option value=\"\">No categories found</option>`;\r\n-            return;\r\n-        }\r\n-\r\n-        categories.forEach(cat => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = cat.id;      // ID for DB\r\n-            opt.textContent = cat.name; // Display name\r\n-            categorySelect.appendChild(opt);\r\n-        });\r\n-\r\n-        console.log(\"Ingredient categories loaded successfully!\");\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading categories:\", err);\r\n-        categorySelect.innerHTML = `<option value=\"\">Error loading categories</option>`;\r\n-    }\r\n-});\r\n-\r\n-// Optional: load units dynamically (similar pattern)\r\n-document.addEventListener(\"DOMContentLoaded\", async () => {\r\n-    const unitSelect = document.getElementById(\"ingredientUnit\");\r\n-    const thresholdSpan = document.getElementById(\"thresholdUnit\");\r\n-\r\n-    if (!unitSelect) return;\r\n-\r\n-    unitSelect.innerHTML = `<option value=\"\">Select Unit</option>`;\r\n-    thresholdSpan.textContent = \"\";\r\n-\r\n-    try {\r\n-        const units = await unitsDB.show();\r\n-        if (!units || units.length === 0) {\r\n-            unitSelect.innerHTML = `<option value=\"\">No units found</option>`;\r\n-            return;\r\n-        }\r\n-\r\n-        units.forEach(unit => {\r\n-            const opt = document.createElement(\"option\");\r\n-            opt.value = unit.id;             // ID for DB\r\n-            opt.textContent = unit.short_name || unit.name;\r\n-            opt.dataset.short = unit.short_name || unit.name; // for threshold span\r\n-            unitSelect.appendChild(opt);\r\n-        });\r\n-\r\n-        console.log(\"Units loaded successfully!\");\r\n-\r\n-        // Update threshold span on unit change\r\n-        unitSelect.addEventListener(\"change\", () => {\r\n-            const selected = unitSelect.selectedOptions[0];\r\n-            thresholdSpan.textContent = selected?.dataset.short || \"\";\r\n-        });\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading units:\", err);\r\n-        unitSelect.innerHTML = `<option value=\"\">Error loading units</option>`;\r\n-    }\r\n-});\r\n+\\\n\\ No newline at end of file\n"
                }
            ],
            "date": 1771517405708,
            "name": "Commit-0",
            "content": "import { unitsDB } from \"./middle.js\";"
        }
    ]
}