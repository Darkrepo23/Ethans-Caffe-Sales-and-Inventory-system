{
    "sourceFile": "codes/auth.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 47,
            "patches": [
                {
                    "date": 1771489379042,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1771489447885,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,16 @@\n // Authentication JavaScript\r\n import { usersDB, rolesDB } from './middle.js';\r\n+\r\n+\r\n+await usersDB.add({\r\n+    full_name: \"Admin User\",\r\n+    username: \"admin\",\r\n+    password_hash: \"123\", // Will be hashed by backend\r\n+    role_id: 1,           // Assuming 1 is the admin role_id\r\n+    status: \"active\",\r\n+    created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n+});\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771489480936,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,16 +1,16 @@\n // Authentication JavaScript\r\n import { usersDB, rolesDB } from './middle.js';\r\n \r\n \r\n-await usersDB.add({\r\n-    full_name: \"Admin User\",\r\n-    username: \"admin\",\r\n-    password_hash: \"123\", // Will be hashed by backend\r\n-    role_id: 1,           // Assuming 1 is the admin role_id\r\n-    status: \"active\",\r\n-    created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n-});\r\n+// await usersDB.add({\r\n+//     full_name: \"Admin User\",\r\n+//     username: \"admin\",\r\n+//     password_hash: \"123\", // Will be hashed by backend\r\n+//     role_id: 1,           // Assuming 1 is the admin role_id\r\n+//     status: \"active\",\r\n+//     created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n+// });\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771489565788,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,16 +1,16 @@\n // Authentication JavaScript\r\n import { usersDB, rolesDB } from './middle.js';\r\n \r\n \r\n-// await usersDB.add({\r\n-//     full_name: \"Admin User\",\r\n-//     username: \"admin\",\r\n-//     password_hash: \"123\", // Will be hashed by backend\r\n-//     role_id: 1,           // Assuming 1 is the admin role_id\r\n-//     status: \"active\",\r\n-//     created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n-// });\r\n+// <?php\r\n+$origin = $_SERVER['HTTP_ORIGIN'] ?? '';\r\n+if ($origin === 'http://127.0.0.1:5500' || $origin === 'http://localhost:5500') {\r\n+    header(\"Access-Control-Allow-Origin: $origin\");\r\n+}\r\n+header(\"Access-Control-Allow-Credentials: true\");\r\n+header(\"Access-Control-Allow-Methods: POST, GET, PUT, DELETE, OPTIONS\");\r\n+header(\"Access-Control-Allow-Headers: Content-Type\");\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771489703729,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,16 +1,16 @@\n // Authentication JavaScript\r\n import { usersDB, rolesDB } from './middle.js';\r\n \r\n \r\n-// <?php\r\n-$origin = $_SERVER['HTTP_ORIGIN'] ?? '';\r\n-if ($origin === 'http://127.0.0.1:5500' || $origin === 'http://localhost:5500') {\r\n-    header(\"Access-Control-Allow-Origin: $origin\");\r\n-}\r\n-header(\"Access-Control-Allow-Credentials: true\");\r\n-header(\"Access-Control-Allow-Methods: POST, GET, PUT, DELETE, OPTIONS\");\r\n-header(\"Access-Control-Allow-Headers: Content-Type\");\r\n+// await usersDB.add({\r\n+//     full_name: \"Admin User\",\r\n+//     username: \"admin\",\r\n+//     password_hash: \"123\", // Will be hashed by backend\r\n+//     role_id: 1,           // Assuming 1 is the admin role_id\r\n+//     status: \"active\",\r\n+//     created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n+// });\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771490105172,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,16 +1,16 @@\n // Authentication JavaScript\r\n import { usersDB, rolesDB } from './middle.js';\r\n \r\n \r\n-// await usersDB.add({\r\n-//     full_name: \"Admin User\",\r\n-//     username: \"admin\",\r\n-//     password_hash: \"123\", // Will be hashed by backend\r\n-//     role_id: 1,           // Assuming 1 is the admin role_id\r\n-//     status: \"active\",\r\n-//     created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n-// });\r\n+await usersDB.add({\r\n+    full_name: \"Admin User\",\r\n+    username: \"admin\",\r\n+    password_hash: \"123\", // Will be hashed by backend\r\n+    role_id: 1,           // Assuming 1 is the admin role_id\r\n+    status: \"active\",\r\n+    created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n+});\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771490220982,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,16 +1,16 @@\n // Authentication JavaScript\r\n import { usersDB, rolesDB } from './middle.js';\r\n \r\n \r\n-await usersDB.add({\r\n-    full_name: \"Admin User\",\r\n-    username: \"admin\",\r\n-    password_hash: \"123\", // Will be hashed by backend\r\n-    role_id: 1,           // Assuming 1 is the admin role_id\r\n-    status: \"active\",\r\n-    created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n-});\r\n+// await usersDB.add({\r\n+//     full_name: \"Admin User\",\r\n+//     username: \"admin\",\r\n+//     password_hash: \"123\", // Will be hashed by backend\r\n+//     role_id: 1,           // Assuming 1 is the admin role_id\r\n+//     status: \"active\",\r\n+//     created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n+// });\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771490330504,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,16 +1,16 @@\n // Authentication JavaScript\r\n import { usersDB, rolesDB } from './middle.js';\r\n \r\n \r\n-// await usersDB.add({\r\n-//     full_name: \"Admin User\",\r\n-//     username: \"admin\",\r\n-//     password_hash: \"123\", // Will be hashed by backend\r\n-//     role_id: 1,           // Assuming 1 is the admin role_id\r\n-//     status: \"active\",\r\n-//     created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n-// });\r\n+await usersDB.add({\r\n+    full_name: \"Admin User\",\r\n+    username: \"admin\",\r\n+    password_hash: \"123\", // Will be hashed by backend\r\n+    role_id: 1,           // Assuming 1 is the admin role_id\r\n+    status: \"active\",\r\n+    created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n+});\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771490653153,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,10 +4,9 @@\n \r\n await usersDB.add({\r\n     full_name: \"Admin User\",\r\n     username: \"admin\",\r\n-    password_hash: \"123\", // Will be hashed by backend\r\n-    role_id: 1,           // Assuming 1 is the admin role_id\r\n+    password_hash: \"123\", // Will be hashed by backend        // Assuming 1 is the admin role_id\r\n     status: \"active\",\r\n     created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n });\r\n // DOM Ready\r\n"
                },
                {
                    "date": 1771490690763,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,8 @@\n     full_name: \"Admin User\",\r\n     username: \"admin\",\r\n     password_hash: \"123\", // Will be hashed by backend        // Assuming 1 is the admin role_id\r\n     status: \"active\",\r\n-    created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n });\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n"
                },
                {
                    "date": 1771490726685,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,10 +4,12 @@\n \r\n await usersDB.add({\r\n     full_name: \"Admin User\",\r\n     username: \"admin\",\r\n-    password_hash: \"123\", // Will be hashed by backend        // Assuming 1 is the admin role_id\r\n+    password_hash: \"123\", // Will be hashed by backend\r\n+    role_id: 1,           // Assuming 1 is the admin role_id\r\n     status: \"active\",\r\n+    created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n });\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n"
                },
                {
                    "date": 1771490775413,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,16 +1,9 @@\n // Authentication JavaScript\r\n import { usersDB, rolesDB } from './middle.js';\r\n \r\n \r\n-await usersDB.add({\r\n-    full_name: \"Admin User\",\r\n-    username: \"admin\",\r\n-    password_hash: \"123\", // Will be hashed by backend\r\n-    role_id: 1,           // Assuming 1 is the admin role_id\r\n-    status: \"active\",\r\n-    created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n-});\r\n+\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771491994940,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -253,5 +253,23 @@\n                 requestError.classList.add('d-none');\r\n             }, 5000);\r\n         }\r\n     }\r\n-}\n\\ No newline at end of file\n+}\r\n+\r\n+// Add admin user with password '123' (password will be hashed by backend)\r\n+// usersDB.add({\r\n+//     full_name: \"Admin User\",\r\n+//     username: \"admin\",\r\n+//     password_hash: \"123\", // Backend will hash this\r\n+//     role_id: 1,            // Make sure this role exists\r\n+//     status: \"active\",\r\n+//     created_at: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\r\n+// }).then(result => {\r\n+//     if (result && result.error) {\r\n+//         console.error('Failed to add admin user:', result.error);\r\n+//         alert('Failed to add admin user: ' + result.error);\r\n+//     } else {\r\n+//         console.log('Admin user added:', result);\r\n+//         alert('Admin user added successfully!');\r\n+//     }\r\n+// });\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771495413767,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,102 +24,62 @@\n     }\r\n });\r\n \r\n // Handle login\r\n-function handleLogin() {\r\n-    const username = document.getElementById('username').value;\r\n-    const password = document.getElementById('password').value;\r\n-    const loginError = document.getElementById('loginError');\r\n+async function handleLogin() {\r\n+    const username = document.getElementById('username').value.trim();\r\n+    const password = document.getElementById('password').value.trim();\r\n+    const loginBtn = document.querySelector('#loginForm button[type=\"submit\"]');\r\n \r\n-    // Basic validation\r\n     if (!username || !password) {\r\n-        showLoginError('Please enter both username and password');\r\n+        showLoginError(\"Please enter both username and password\");\r\n         return;\r\n     }\r\n \r\n-    const trimmedUsername = username.trim();\r\n-    const trimmedPassword = password.trim();\r\n-\r\n-    // Show loading state\r\n-    const loginForm = document.getElementById('loginForm');\r\n-    if (!loginForm) return;\r\n-    const loginBtn = loginForm.querySelector('button[type=\"submit\"]');\r\n     const originalText = loginBtn.innerHTML;\r\n     loginBtn.innerHTML = '<span class=\"loading-spinner\"></span> Logging in...';\r\n     loginBtn.disabled = true;\r\n \r\n-    // Simulate API call with delay\r\n-    setTimeout(() => {\r\n-        // 1. Check dynamic users from localStorage\r\n-        let users = [];\r\n-        try {\r\n-            const stored = localStorage.getItem('users');\r\n-            if (stored) users = JSON.parse(stored);\r\n-        } catch (e) { }\r\n+    try {\r\n+        const res = await fetch(\"http://localhost/Ethans%20Cafe/codes/php/login.php\", {\r\n+            method: \"POST\",\r\n+            headers: { \"Content-Type\": \"application/json\" },\r\n+            body: JSON.stringify({ username, password })\r\n+        });\r\n \r\n-        const foundUser = users.find(u =>\r\n-            u.username.toLowerCase() === trimmedUsername.toLowerCase() &&\r\n-            u.password === trimmedPassword &&\r\n-            !u.isDeleted &&\r\n-            u.status === 'Active'\r\n-        );\r\n+        const data = await res.json();\r\n+        loginBtn.innerHTML = originalText;\r\n+        loginBtn.disabled = false;\r\n \r\n-        if (foundUser || (trimmedUsername === 'admin' && trimmedPassword === 'admin123')) {\r\n-            const role = foundUser ? foundUser.role.toLowerCase().replace(' ', '') : 'admin';\r\n-            const displayName = foundUser ? foundUser.name : 'Admin';\r\n+        if (!res.ok || data.error) {\r\n+            showLoginError(data.error || \"Login failed\");\r\n+            return;\r\n+        }\r\n \r\n-            loginBtn.innerHTML = originalText;\r\n-            loginBtn.disabled = false;\r\n-\r\n-            // Save auth flag\r\n-            localStorage.setItem('loggedInRole', role === 'seniorstaff' ? 'admin' : role);\r\n-            localStorage.setItem('loggedInUser', displayName);\r\n-\r\n-            if (window.Swal) {\r\n-                Swal.fire({\r\n-                    icon: 'success',\r\n-                    title: 'Login Successful',\r\n-                    text: `Welcome back, ${displayName}!`,\r\n-                    timer: 1500,\r\n-                    timerProgressBar: true,\r\n-                    showConfirmButton: false,\r\n-                    heightAuto: false\r\n-                }).then(() => {\r\n-                    if (role === 'admin' || role === 'seniorstaff' || role === 'owner') {\r\n-                        window.location.href = 'admin-dashboard.html';\r\n-                    } else {\r\n-                        window.location.href = 'staff-menu.html';\r\n-                    }\r\n-                });\r\n+        // Success\r\n+        Swal.fire({\r\n+            icon: \"success\",\r\n+            title: \"Login Successful\",\r\n+            text: `Welcome back, ${data.full_name}!`,\r\n+            timer: 1500,\r\n+            showConfirmButton: false\r\n+        }).then(() => {\r\n+            // Redirect by role\r\n+            if (data.role_id == 1) {\r\n+                window.location.href = \"admin-dashboard.html\";\r\n             } else {\r\n-                if (role === 'admin' || role === 'seniorstaff' || role === 'owner') {\r\n-                    window.location.href = 'admin-dashboard.html';\r\n-                } else {\r\n-                    window.location.href = 'staff-menu.html';\r\n-                }\r\n+                window.location.href = \"staff-menu.html\";\r\n             }\r\n-            return;\r\n-        }\r\n+        });\r\n \r\n-        // 2. Legacy hardcoded check for safety (optional but good for dev)\r\n-        if ((trimmedUsername === 'staff' && trimmedPassword === 'staff123') ||\r\n-            (trimmedUsername === 'cashier' && trimmedPassword === 'cashier123')) {\r\n-\r\n-            const role = trimmedUsername;\r\n-            loginBtn.innerHTML = originalText;\r\n-            loginBtn.disabled = false;\r\n-            localStorage.setItem('loggedInRole', role);\r\n-            window.location.href = 'staff-menu.html';\r\n-            return;\r\n-        }\r\n-\r\n-        // If credentials don't match\r\n-        showLoginError('Invalid username or password');\r\n+    } catch (err) {\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n-    }, 1500);\r\n+        showLoginError(\"Network error. Please try again.\");\r\n+    }\r\n }\r\n \r\n+\r\n function showLoginError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'error',\r\n"
                },
                {
                    "date": 1771495902155,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,23 +55,31 @@\n             return;\r\n         }\r\n \r\n         // Success\r\n-        Swal.fire({\r\n-            icon: \"success\",\r\n-            title: \"Login Successful\",\r\n-            text: `Welcome back, ${data.full_name}!`,\r\n-            timer: 1500,\r\n-            showConfirmButton: false\r\n-        }).then(() => {\r\n-            // Redirect by role\r\n-            if (data.role_id == 1) {\r\n-                window.location.href = \"admin-dashboard.html\";\r\n-            } else {\r\n-                window.location.href = \"staff-menu.html\";\r\n-            }\r\n-        });\r\n+Swal.fire({\r\n+    icon: \"success\",\r\n+    title: \"Login Successful\",\r\n+    text: `Welcome back, ${data.full_name}!`,\r\n+    timer: 1500,\r\n+    showConfirmButton: false\r\n+}).then(() => {\r\n+    // Fallback, but may not trigger\r\n+});\r\n \r\n+Swal.getPopup().addEventListener(\"mouseenter\", Swal.stopTimer);\r\n+Swal.getPopup().addEventListener(\"mouseleave\", Swal.resumeTimer);\r\n+\r\n+// Guaranteed redirect\r\n+setTimeout(() => {\r\n+    if (parseInt(data.role_id) === 1) {\r\n+        window.location.href = \"admin-dashboard.html\";\r\n+    } else {\r\n+        window.location.href = \"staff-menu.html\";\r\n+    }\r\n+}, 1600);\r\n+\r\n+\r\n     } catch (err) {\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n         showLoginError(\"Network error. Please try again.\");\r\n"
                },
                {
                    "date": 1771495984030,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,39 +55,35 @@\n             return;\r\n         }\r\n \r\n         // Success\r\n+        console.log(\"Raw server response:\", data);\r\n+\r\n Swal.fire({\r\n     icon: \"success\",\r\n     title: \"Login Successful\",\r\n     text: `Welcome back, ${data.full_name}!`,\r\n-    timer: 1500,\r\n-    showConfirmButton: false\r\n-}).then(() => {\r\n-    // Fallback, but may not trigger\r\n+    showConfirmButton: false,\r\n+    timer: 1200\r\n });\r\n \r\n-Swal.getPopup().addEventListener(\"mouseenter\", Swal.stopTimer);\r\n-Swal.getPopup().addEventListener(\"mouseleave\", Swal.resumeTimer);\r\n+setTimeout(() => {\r\n+    console.log(\"Redirect sequence started\");\r\n \r\n-// Guaranteed redirect\r\n-setTimeout(() => {\r\n-    if (parseInt(data.role_id) === 1) {\r\n+    const role = parseInt(data.role_id);\r\n+    console.log(\"Parsed role_id:\", role);\r\n+\r\n+    if (role === 1) {\r\n+        console.log(\"Redirecting to: admin-dashboard.html\");\r\n         window.location.href = \"admin-dashboard.html\";\r\n     } else {\r\n+        console.log(\"Redirecting to: staff-menu.html\");\r\n         window.location.href = \"staff-menu.html\";\r\n     }\r\n-}, 1600);\r\n+}, 1300);\r\n \r\n \r\n-    } catch (err) {\r\n-        loginBtn.innerHTML = originalText;\r\n-        loginBtn.disabled = false;\r\n-        showLoginError(\"Network error. Please try again.\");\r\n-    }\r\n-}\r\n \r\n-\r\n function showLoginError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'error',\r\n"
                },
                {
                    "date": 1771495989941,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,9 +55,9 @@\n             return;\r\n         }\r\n \r\n         // Success\r\n-        console.log(\"Raw server response:\", data);\r\n+console.log(\"Raw server response:\", data);\r\n \r\n Swal.fire({\r\n     icon: \"success\",\r\n     title: \"Login Successful\",\r\n@@ -82,8 +82,16 @@\n }, 1300);\r\n \r\n \r\n \r\n+    } catch (err) {\r\n+        loginBtn.innerHTML = originalText;\r\n+        loginBtn.disabled = false;\r\n+        showLoginError(\"Network error. Please try again.\");\r\n+    }\r\n+}\r\n+\r\n+\r\n function showLoginError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'error',\r\n"
                },
                {
                    "date": 1771496062607,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,32 +55,32 @@\n             return;\r\n         }\r\n \r\n         // Success\r\n-console.log(\"Raw server response:\", data);\r\n+        .log(\"Raw server response:\", data);\r\n \r\n-Swal.fire({\r\n-    icon: \"success\",\r\n-    title: \"Login Successful\",\r\n-    text: `Welcome back, ${data.full_name}!`,\r\n-    showConfirmButton: false,\r\n-    timer: 1200\r\n-});\r\n+        Swal.fire({\r\n+            icon: \"success\",\r\n+            title: \"Login Successful\",\r\n+            text: `Welcome back, ${data.full_name}!`,\r\n+            showConfirmButton: false,\r\n+            timer: 1200\r\n+        });\r\n \r\n-setTimeout(() => {\r\n-    console.log(\"Redirect sequence started\");\r\n+        setTimeout(() => {\r\n+            console.log(\"Redirect sequence started\");\r\n \r\n-    const role = parseInt(data.role_id);\r\n-    console.log(\"Parsed role_id:\", role);\r\n+            const role = parseInt(data.role_id);\r\n+            console.log(\"Parsed role_id:\", role);\r\n \r\n-    if (role === 1) {\r\n-        console.log(\"Redirecting to: admin-dashboard.html\");\r\n-        window.location.href = \"admin-dashboard.html\";\r\n-    } else {\r\n-        console.log(\"Redirecting to: staff-menu.html\");\r\n-        window.location.href = \"staff-menu.html\";\r\n-    }\r\n-}, 1300);\r\n+            if (role === 1) {\r\n+                console.log(\"Redirecting to: admin-dashboard.html\");\r\n+                window.location.href = \"admin-dashboard.html\";\r\n+            } else {\r\n+                console.log(\"Redirecting to: staff-menu.html\");\r\n+                window.location.href = \"staff-menu.html\";\r\n+            }\r\n+        }, 1300);\r\n \r\n \r\n \r\n     } catch (err) {\r\n"
                },
                {
                    "date": 1771496069719,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,9 +55,9 @@\n             return;\r\n         }\r\n \r\n         // Success\r\n-        .log(\"Raw server response:\", data);\r\n+      alert(\"Raw server response:\", data);\r\n \r\n         Swal.fire({\r\n             icon: \"success\",\r\n             title: \"Login Successful\",\r\n"
                },
                {
                    "date": 1771496087697,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,32 +55,32 @@\n             return;\r\n         }\r\n \r\n         // Success\r\n-      alert(\"Raw server response:\", data);\r\n+console.log(\"Raw server response:\", data);\r\n \r\n-        Swal.fire({\r\n-            icon: \"success\",\r\n-            title: \"Login Successful\",\r\n-            text: `Welcome back, ${data.full_name}!`,\r\n-            showConfirmButton: false,\r\n-            timer: 1200\r\n-        });\r\n+Swal.fire({\r\n+    icon: \"success\",\r\n+    title: \"Login Successful\",\r\n+    text: `Welcome back, ${data.full_name}!`,\r\n+    showConfirmButton: false,\r\n+    timer: 1200\r\n+});\r\n \r\n-        setTimeout(() => {\r\n-            console.log(\"Redirect sequence started\");\r\n+setTimeout(() => {\r\n+    console.log(\"Redirect sequence started\");\r\n \r\n-            const role = parseInt(data.role_id);\r\n-            console.log(\"Parsed role_id:\", role);\r\n+    const role = parseInt(data.role_id);\r\n+    console.log(\"Parsed role_id:\", role);\r\n \r\n-            if (role === 1) {\r\n-                console.log(\"Redirecting to: admin-dashboard.html\");\r\n-                window.location.href = \"admin-dashboard.html\";\r\n-            } else {\r\n-                console.log(\"Redirecting to: staff-menu.html\");\r\n-                window.location.href = \"staff-menu.html\";\r\n-            }\r\n-        }, 1300);\r\n+    if (role === 1) {\r\n+        console.log(\"Redirecting to: admin-dashboard.html\");\r\n+        window.location.href = \"admin-dashboard.html\";\r\n+    } else {\r\n+        console.log(\"Redirecting to: staff-menu.html\");\r\n+        window.location.href = \"staff-menu.html\";\r\n+    }\r\n+}, 1300);\r\n \r\n \r\n \r\n     } catch (err) {\r\n"
                },
                {
                    "date": 1771496162805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,32 +55,32 @@\n             return;\r\n         }\r\n \r\n         // Success\r\n-console.log(\"Raw server response:\", data);\r\n+        console.log(\"Raw server response:\", data);\r\n \r\n-Swal.fire({\r\n-    icon: \"success\",\r\n-    title: \"Login Successful\",\r\n-    text: `Welcome back, ${data.full_name}!`,\r\n-    showConfirmButton: false,\r\n-    timer: 1200\r\n-});\r\n+        Swal.fire({\r\n+            icon: \"success\",\r\n+            title: \"Login Successful\",\r\n+            text: `Welcome back, ${data.full_name}!`,\r\n+            showConfirmButton: false,\r\n+            timer: 1200\r\n+        });\r\n \r\n-setTimeout(() => {\r\n-    console.log(\"Redirect sequence started\");\r\n+        setTimeout(() => {\r\n+            console.log(\"Redirect sequence started\");\r\n \r\n-    const role = parseInt(data.role_id);\r\n-    console.log(\"Parsed role_id:\", role);\r\n+            const role = parseInt(data.role_id);\r\n+            console.log(\"Parsed role_id:\", role);\r\n \r\n-    if (role === 1) {\r\n-        console.log(\"Redirecting to: admin-dashboard.html\");\r\n-        window.location.href = \"admin-dashboard.html\";\r\n-    } else {\r\n-        console.log(\"Redirecting to: staff-menu.html\");\r\n-        window.location.href = \"staff-menu.html\";\r\n-    }\r\n-}, 1300);\r\n+            if (role === 1) {\r\n+                console.log(\"Redirecting to: admin-dashboard.html\");\r\n+                // window.location.href = \"admin-dashboard.html\";\r\n+            } else {\r\n+                console.log(\"Redirecting to: staff-menu.html\");\r\n+                window.location.href = \"staff-menu.html\";\r\n+            }\r\n+        }, 1300);\r\n \r\n \r\n \r\n     } catch (err) {\r\n"
                },
                {
                    "date": 1771496174972,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,9 +73,9 @@\n             console.log(\"Parsed role_id:\", role);\r\n \r\n             if (role === 1) {\r\n                 console.log(\"Redirecting to: admin-dashboard.html\");\r\n-                // window.location.href = \"admin-dashboard.html\";\r\n+                window.location.href = \"admin-dashboard.html\";\r\n             } else {\r\n                 console.log(\"Redirecting to: staff-menu.html\");\r\n                 window.location.href = \"staff-menu.html\";\r\n             }\r\n"
                },
                {
                    "date": 1771496183695,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,22 +65,22 @@\n             showConfirmButton: false,\r\n             timer: 1200\r\n         });\r\n \r\n-        setTimeout(() => {\r\n-            console.log(\"Redirect sequence started\");\r\n+        // setTimeout(() => {\r\n+        //     console.log(\"Redirect sequence started\");\r\n \r\n-            const role = parseInt(data.role_id);\r\n-            console.log(\"Parsed role_id:\", role);\r\n+        //     const role = parseInt(data.role_id);\r\n+        //     console.log(\"Parsed role_id:\", role);\r\n \r\n-            if (role === 1) {\r\n-                console.log(\"Redirecting to: admin-dashboard.html\");\r\n-                window.location.href = \"admin-dashboard.html\";\r\n-            } else {\r\n-                console.log(\"Redirecting to: staff-menu.html\");\r\n-                window.location.href = \"staff-menu.html\";\r\n-            }\r\n-        }, 1300);\r\n+        //     if (role === 1) {\r\n+        //         console.log(\"Redirecting to: admin-dashboard.html\");\r\n+        //         window.location.href = \"admin-dashboard.html\";\r\n+        //     } else {\r\n+        //         console.log(\"Redirecting to: staff-menu.html\");\r\n+        //         window.location.href = \"staff-menu.html\";\r\n+        //     }\r\n+        // }, 1300);\r\n \r\n \r\n \r\n     } catch (err) {\r\n"
                },
                {
                    "date": 1771496246749,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,25 +65,36 @@\n             showConfirmButton: false,\r\n             timer: 1200\r\n         });\r\n \r\n-        // setTimeout(() => {\r\n-        //     console.log(\"Redirect sequence started\");\r\n+console.log(\"Server response:\", data);\r\n \r\n-        //     const role = parseInt(data.role_id);\r\n-        //     console.log(\"Parsed role_id:\", role);\r\n+Swal.fire({\r\n+    icon: \"success\",\r\n+    title: \"Login Successful\",\r\n+    text: `Welcome back, ${data.full_name}!`,\r\n+    showConfirmButton: false,\r\n+    timer: 1200\r\n+});\r\n \r\n-        //     if (role === 1) {\r\n-        //         console.log(\"Redirecting to: admin-dashboard.html\");\r\n-        //         window.location.href = \"admin-dashboard.html\";\r\n-        //     } else {\r\n-        //         console.log(\"Redirecting to: staff-menu.html\");\r\n-        //         window.location.href = \"staff-menu.html\";\r\n-        //     }\r\n-        // }, 1300);\r\n+setTimeout(() => {\r\n+    console.log(\"Starting redirect...\");\r\n \r\n+    const role = parseInt(data.role_id); // make sure it's a number\r\n+    console.log(\"Parsed role_id:\", role);\r\n \r\n+    if (role === 1) {\r\n+        console.log(\"Redirecting to admin-dashboard.html\");\r\n+        window.location.href = \"admin-dashboard.html\";\r\n+    } else {\r\n+        console.log(\"Redirecting to staff-menu.html\");\r\n+        window.location.href = \"staff-menu.html\";\r\n+    }\r\n+}, 1300);\r\n \r\n+\r\n+\r\n+\r\n     } catch (err) {\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n         showLoginError(\"Network error. Please try again.\");\r\n"
                },
                {
                    "date": 1771496255324,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,18 +57,10 @@\n \r\n         // Success\r\n         console.log(\"Raw server response:\", data);\r\n \r\n-        Swal.fire({\r\n-            icon: \"success\",\r\n-            title: \"Login Successful\",\r\n-            text: `Welcome back, ${data.full_name}!`,\r\n-            showConfirmButton: false,\r\n-            timer: 1200\r\n-        });\r\n+       console.log(\"Server response:\", data);\r\n \r\n-console.log(\"Server response:\", data);\r\n-\r\n Swal.fire({\r\n     icon: \"success\",\r\n     title: \"Login Successful\",\r\n     text: `Welcome back, ${data.full_name}!`,\r\n"
                },
                {
                    "date": 1771496261975,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,34 +55,33 @@\n             return;\r\n         }\r\n \r\n         // Success\r\n-        console.log(\"Raw server response:\", data);\r\n \r\n-       console.log(\"Server response:\", data);\r\n+        console.log(\"Server response:\", data);\r\n \r\n-Swal.fire({\r\n-    icon: \"success\",\r\n-    title: \"Login Successful\",\r\n-    text: `Welcome back, ${data.full_name}!`,\r\n-    showConfirmButton: false,\r\n-    timer: 1200\r\n-});\r\n+        Swal.fire({\r\n+            icon: \"success\",\r\n+            title: \"Login Successful\",\r\n+            text: `Welcome back, ${data.full_name}!`,\r\n+            showConfirmButton: false,\r\n+            timer: 1200\r\n+        });\r\n \r\n-setTimeout(() => {\r\n-    console.log(\"Starting redirect...\");\r\n+        setTimeout(() => {\r\n+            console.log(\"Starting redirect...\");\r\n \r\n-    const role = parseInt(data.role_id); // make sure it's a number\r\n-    console.log(\"Parsed role_id:\", role);\r\n+            const role = parseInt(data.role_id); // make sure it's a number\r\n+            console.log(\"Parsed role_id:\", role);\r\n \r\n-    if (role === 1) {\r\n-        console.log(\"Redirecting to admin-dashboard.html\");\r\n-        window.location.href = \"admin-dashboard.html\";\r\n-    } else {\r\n-        console.log(\"Redirecting to staff-menu.html\");\r\n-        window.location.href = \"staff-menu.html\";\r\n-    }\r\n-}, 1300);\r\n+            if (role === 1) {\r\n+                console.log(\"Redirecting to admin-dashboard.html\");\r\n+                window.location.href = \"admin-dashboard.html\";\r\n+            } else {\r\n+                console.log(\"Redirecting to staff-menu.html\");\r\n+                window.location.href = \"staff-menu.html\";\r\n+            }\r\n+        }, 1300);\r\n \r\n \r\n \r\n \r\n"
                },
                {
                    "date": 1771496289646,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,22 +66,22 @@\n             showConfirmButton: false,\r\n             timer: 1200\r\n         });\r\n \r\n-        setTimeout(() => {\r\n-            console.log(\"Starting redirect...\");\r\n+        // setTimeout(() => {\r\n+        //     console.log(\"Starting redirect...\");\r\n \r\n-            const role = parseInt(data.role_id); // make sure it's a number\r\n-            console.log(\"Parsed role_id:\", role);\r\n+        //     const role = parseInt(data.role_id); // make sure it's a number\r\n+        //     console.log(\"Parsed role_id:\", role);\r\n \r\n-            if (role === 1) {\r\n-                console.log(\"Redirecting to admin-dashboard.html\");\r\n-                window.location.href = \"admin-dashboard.html\";\r\n-            } else {\r\n-                console.log(\"Redirecting to staff-menu.html\");\r\n-                window.location.href = \"staff-menu.html\";\r\n-            }\r\n-        }, 1300);\r\n+        //     if (role === 1) {\r\n+        //         console.log(\"Redirecting to admin-dashboard.html\");\r\n+        //         window.location.href = \"admin-dashboard.html\";\r\n+        //     } else {\r\n+        //         console.log(\"Redirecting to staff-menu.html\");\r\n+        //         window.location.href = \"staff-menu.html\";\r\n+        //     }\r\n+        // }, 1300);\r\n \r\n \r\n \r\n \r\n"
                },
                {
                    "date": 1771496389367,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,69 +31,71 @@\n     const loginBtn = document.querySelector('#loginForm button[type=\"submit\"]');\r\n \r\n     if (!username || !password) {\r\n         showLoginError(\"Please enter both username and password\");\r\n+        console.log(\"Login blocked: missing username or password\");\r\n         return;\r\n     }\r\n \r\n     const originalText = loginBtn.innerHTML;\r\n     loginBtn.innerHTML = '<span class=\"loading-spinner\"></span> Logging in...';\r\n     loginBtn.disabled = true;\r\n \r\n     try {\r\n+        console.log(\"Sending login request...\", { username, password: \"[HIDDEN]\" });\r\n+\r\n         const res = await fetch(\"http://localhost/Ethans%20Cafe/codes/php/login.php\", {\r\n             method: \"POST\",\r\n             headers: { \"Content-Type\": \"application/json\" },\r\n             body: JSON.stringify({ username, password })\r\n         });\r\n \r\n         const data = await res.json();\r\n+\r\n+        console.log(\"Server response:\", data);\r\n+\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n \r\n         if (!res.ok || data.error) {\r\n+            console.log(\"Login failed:\", data.error || \"Unknown error\");\r\n             showLoginError(data.error || \"Login failed\");\r\n             return;\r\n         }\r\n \r\n-        // Success\r\n-\r\n-        console.log(\"Server response:\", data);\r\n-\r\n+        console.log(\"Login successful! Preparing redirect...\");\r\n+        \r\n         Swal.fire({\r\n             icon: \"success\",\r\n             title: \"Login Successful\",\r\n             text: `Welcome back, ${data.full_name}!`,\r\n             showConfirmButton: false,\r\n-            timer: 1200\r\n+            timer: 1200,\r\n+            didClose: () => {\r\n+                // Redirect based on role\r\n+                const role = parseInt(data.role_id);\r\n+                console.log(\"Parsed role_id:\", role);\r\n+\r\n+                if (role === 1) {\r\n+                    console.log(\"Redirecting to admin-dashboard.html\");\r\n+                    window.location.href = \"admin-dashboard.html\";\r\n+                } else {\r\n+                    console.log(\"Redirecting to staff-menu.html\");\r\n+                    window.location.href = \"staff-menu.html\";\r\n+                }\r\n+            }\r\n         });\r\n \r\n-        // setTimeout(() => {\r\n-        //     console.log(\"Starting redirect...\");\r\n-\r\n-        //     const role = parseInt(data.role_id); // make sure it's a number\r\n-        //     console.log(\"Parsed role_id:\", role);\r\n-\r\n-        //     if (role === 1) {\r\n-        //         console.log(\"Redirecting to admin-dashboard.html\");\r\n-        //         window.location.href = \"admin-dashboard.html\";\r\n-        //     } else {\r\n-        //         console.log(\"Redirecting to staff-menu.html\");\r\n-        //         window.location.href = \"staff-menu.html\";\r\n-        //     }\r\n-        // }, 1300);\r\n-\r\n-\r\n-\r\n-\r\n     } catch (err) {\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n+        console.error(\"Network or JS error:\", err);\r\n         showLoginError(\"Network error. Please try again.\");\r\n     }\r\n }\r\n \r\n \r\n+\r\n function showLoginError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'error',\r\n"
                },
                {
                    "date": 1771496431051,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,8 @@\n-// Authentication JavaScript\r\n-import { usersDB, rolesDB } from './middle.js';\r\n \r\n \r\n \r\n+\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771496554826,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,28 +62,27 @@\n         }\r\n \r\n         console.log(\"Login successful! Preparing redirect...\");\r\n         \r\n-        Swal.fire({\r\n-            icon: \"success\",\r\n-            title: \"Login Successful\",\r\n-            text: `Welcome back, ${data.full_name}!`,\r\n-            showConfirmButton: false,\r\n-            timer: 1200,\r\n-            didClose: () => {\r\n-                // Redirect based on role\r\n-                const role = parseInt(data.role_id);\r\n-                console.log(\"Parsed role_id:\", role);\r\n+     Swal.fire({\r\n+    icon: \"success\",\r\n+    title: \"Login Successful\",\r\n+    text: `Welcome back, ${data.full_name}!`,\r\n+    showConfirmButton: false,\r\n+    timer: 1200,\r\n+    timerProgressBar: true\r\n+}).then(() => {\r\n+    const role = parseInt(data.role_id);\r\n+    console.log(\"Parsed role_id:\", role);\r\n \r\n-                if (role === 1) {\r\n-                    console.log(\"Redirecting to admin-dashboard.html\");\r\n-                    window.location.href = \"admin-dashboard.html\";\r\n-                } else {\r\n-                    console.log(\"Redirecting to staff-menu.html\");\r\n-                    window.location.href = \"staff-menu.html\";\r\n-                }\r\n-            }\r\n-        });\r\n+    if (role === 1) {\r\n+        console.log(\"Redirecting to admin-dashboard.html\");\r\n+        window.location.href = \"admin-dashboard.html\";\r\n+    } else {\r\n+        console.log(\"Redirecting to staff-menu.html\");\r\n+        window.location.href = \"staff-menu.html\";\r\n+    }\r\n+});\r\n \r\n     } catch (err) {\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n"
                },
                {
                    "date": 1771497168900,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,29 +61,35 @@\n             return;\r\n         }\r\n \r\n         console.log(\"Login successful! Preparing redirect...\");\r\n-        \r\n-     Swal.fire({\r\n-    icon: \"success\",\r\n-    title: \"Login Successful\",\r\n-    text: `Welcome back, ${data.full_name}!`,\r\n-    showConfirmButton: false,\r\n-    timer: 1200,\r\n-    timerProgressBar: true\r\n-}).then(() => {\r\n-    const role = parseInt(data.role_id);\r\n-    console.log(\"Parsed role_id:\", role);\r\n \r\n-    if (role === 1) {\r\n-        console.log(\"Redirecting to admin-dashboard.html\");\r\n-        window.location.href = \"admin-dashboard.html\";\r\n-    } else {\r\n-        console.log(\"Redirecting to staff-menu.html\");\r\n-        window.location.href = \"staff-menu.html\";\r\n-    }\r\n-});\r\n+        Swal.fire({\r\n+            icon: \"success\",\r\n+            title: \"Login Successful\",\r\n+            text: `Welcome back, ${data.full_name}!`,\r\n+            showConfirmButton: false,\r\n+            timer: 1200,\r\n+            timerProgressBar: true\r\n+        }).then(() => {\r\n+            const role = parseInt(data.role_id);\r\n+            console.log(\"Parsed role_id:\", role);\r\n \r\n+if (role === 1) {\r\n+    console.log(\"Role is admin, redirecting to admin-dashboard.html\");\r\n+    localStorage.setItem('loggedInRole', 'admin'); // save role\r\n+    window.location.href = \"admin-dashboard.html\";\r\n+} else if (role === 2) {\r\n+    console.log(\"Role is staff, redirecting to staff-menu.html\");\r\n+    localStorage.setItem('loggedInRole', 'staff'); // save role\r\n+    window.location.href = \"staff-menu.html\";\r\n+} else {\r\n+    console.log(\"Role is user, redirecting to staff-menu.html\");\r\n+    localStorage.setItem('loggedInRole', 'user'); // save role (or admin if you prefer)\r\n+    window.location.href = \"staff-menu.html\";\r\n+}\r\n+        });\r\n+\r\n     } catch (err) {\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n         console.error(\"Network or JS error:\", err);\r\n"
                },
                {
                    "date": 1771583845050,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,18 +24,33 @@\n });\r\n \r\n // Handle login\r\n async function handleLogin() {\r\n-    const username = document.getElementById('username').value.trim();\r\n-    const password = document.getElementById('password').value.trim();\r\n+    const usernameInput = document.getElementById('username');\r\n+    const passwordInput = document.getElementById('password');\r\n     const loginBtn = document.querySelector('#loginForm button[type=\"submit\"]');\r\n \r\n+    const username = usernameInput.value.trim();\r\n+    const password = passwordInput.value.trim();\r\n+\r\n+    // Basic client-side validation\r\n     if (!username || !password) {\r\n         showLoginError(\"Please enter both username and password\");\r\n-        console.log(\"Login blocked: missing username or password\");\r\n         return;\r\n     }\r\n \r\n+    // Enforce length limits client-side too\r\n+    if (username.length > 100 || password.length > 255) {\r\n+        showLoginError(\"Input is too long\");\r\n+        return;\r\n+    }\r\n+\r\n+    // Validate username format client-side\r\n+    if (!/^[a-zA-Z0-9_]+$/.test(username)) {\r\n+        showLoginError(\"Invalid username format\");\r\n+        return;\r\n+    }\r\n+\r\n     const originalText = loginBtn.innerHTML;\r\n     loginBtn.innerHTML = '<span class=\"loading-spinner\"></span> Logging in...';\r\n     loginBtn.disabled = true;\r\n \r\n@@ -49,20 +64,19 @@\n         });\r\n \r\n         const data = await res.json();\r\n \r\n-        console.log(\"Server response:\", data);\r\n-\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n \r\n         if (!res.ok || data.error) {\r\n-            console.log(\"Login failed:\", data.error || \"Unknown error\");\r\n             showLoginError(data.error || \"Login failed\");\r\n             return;\r\n         }\r\n \r\n-        console.log(\"Login successful! Preparing redirect...\");\r\n+        // Clear inputs after successful login\r\n+        usernameInput.value = '';\r\n+        passwordInput.value = '';\r\n \r\n         Swal.fire({\r\n             icon: \"success\",\r\n             title: \"Login Successful\",\r\n@@ -71,23 +85,20 @@\n             timer: 1200,\r\n             timerProgressBar: true\r\n         }).then(() => {\r\n             const role = parseInt(data.role_id);\r\n-            console.log(\"Parsed role_id:\", role);\r\n+            const roleName = (data.role_name || \"\").toLowerCase();\r\n \r\n-if (role === 1) {\r\n-    console.log(\"Role is admin, redirecting to admin-dashboard.html\");\r\n-    localStorage.setItem('loggedInRole', 'admin'); // save role\r\n-    window.location.href = \"admin-dashboard.html\";\r\n-} else if (role === 2) {\r\n-    console.log(\"Role is staff, redirecting to staff-menu.html\");\r\n-    localStorage.setItem('loggedInRole', 'staff'); // save role\r\n-    window.location.href = \"staff-menu.html\";\r\n-} else {\r\n-    console.log(\"Role is user, redirecting to staff-menu.html\");\r\n-    localStorage.setItem('loggedInRole', 'user'); // save role (or admin if you prefer)\r\n-    window.location.href = \"staff-menu.html\";\r\n-}\r\n+            if (role === 1 || roleName === \"admin\") {\r\n+                localStorage.setItem('loggedInRole', 'admin');\r\n+                window.location.href = \"admin-dashboard.html\";\r\n+            } else if (role === 2 || roleName === \"staff\") {\r\n+                localStorage.setItem('loggedInRole', 'staff');\r\n+                window.location.href = \"staff-menu.html\";\r\n+            } else {\r\n+                localStorage.setItem('loggedInRole', 'user');\r\n+                window.location.href = \"staff-menu.html\";\r\n+            }\r\n         });\r\n \r\n     } catch (err) {\r\n         loginBtn.innerHTML = originalText;\r\n@@ -97,9 +108,8 @@\n     }\r\n }\r\n \r\n \r\n-\r\n function showLoginError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'error',\r\n"
                },
                {
                    "date": 1771608712053,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -136,23 +136,25 @@\n }\r\n \r\n // Handle account request\r\n function handleAccountRequest() {\r\n-    const fullName = document.getElementById('fullName').value;\r\n-    const username = document.getElementById('requestUsername').value;\r\n-    const password = document.getElementById('requestPassword').value;\r\n-    const confirmPassword = document.getElementById('confirmPassword').value;\r\n+    const fullName = document.getElementById('fullName').value.trim();\r\n+    const username = document.getElementById('requestUsername').value.trim();\r\n+    const password = document.getElementById('requestPassword').value.trim();\r\n+    const confirmPassword = document.getElementById('confirmPassword').value.trim();\r\n     const requestedRole = document.getElementById('requestedRole').value;\r\n \r\n-    const requestError = document.getElementById('requestError');\r\n-    const requestSuccess = document.getElementById('requestSuccess');\r\n-\r\n     // Validation\r\n     if (!fullName || !username || !password || !confirmPassword) {\r\n         showRequestError('Please fill in all required fields');\r\n         return;\r\n     }\r\n \r\n+    if (!/^[a-zA-Z0-9_]+$/.test(username)) {\r\n+        showRequestError('Invalid username format. Only letters, numbers, and underscores allowed.');\r\n+        return;\r\n+    }\r\n+\r\n     if (password !== confirmPassword) {\r\n         showRequestError('Passwords do not match');\r\n         return;\r\n     }\r\n@@ -161,66 +163,69 @@\n         showRequestError('Password must be at least 6 characters');\r\n         return;\r\n     }\r\n \r\n-    // Check username uniqueness (simulated)\r\n-    const existingUsers = ['admin', 'staff', 'cashier', 'john', 'jane'];\r\n-    if (existingUsers.includes(username.toLowerCase())) {\r\n-        showRequestError('Username already exists. Please choose a different username.');\r\n-        return;\r\n-    }\r\n-\r\n-    // Show loading state\r\n     const requestAccountForm = document.getElementById('requestAccountForm');\r\n     if (!requestAccountForm) return;\r\n+\r\n     const submitBtn = requestAccountForm.querySelector('button[type=\"submit\"]');\r\n     const originalText = submitBtn.innerHTML;\r\n     submitBtn.innerHTML = '<span class=\"loading-spinner\"></span> Submitting...';\r\n     submitBtn.disabled = true;\r\n \r\n-    // Simulate API call\r\n-    setTimeout(() => {\r\n-        // Save request to local storage (simulated)\r\n-        const request = {\r\n-            id: Date.now(),\r\n-            fullName,\r\n-            username,\r\n-            password, // In real app, this would be hashed\r\n-            requestedRole,\r\n-            status: 'Pending',\r\n-            date: new Date().toLocaleDateString()\r\n-        };\r\n+    fetch(\"http://localhost/Ethans%20Cafe/codes/php/register.php\", {\r\n+        method: \"POST\",\r\n+        headers: { \"Content-Type\": \"application/json\" },\r\n+        body: JSON.stringify({\r\n+            full_name: fullName,\r\n+            username: username,\r\n+            password: password,\r\n+            requested_role_id: requestedRole\r\n+        })\r\n+    })\r\n+    .then(function(res) {\r\n+        return res.json().then(function(data) {\r\n+            return { status: res.status, data: data };\r\n+        });\r\n+    })\r\n+    .then(function(result) {\r\n+        submitBtn.innerHTML = originalText;\r\n+        submitBtn.disabled = false;\r\n \r\n-        // Get existing requests or initialize array\r\n-        let requests = JSON.parse(localStorage.getItem('accountRequests')) || [];\r\n-        requests.push(request);\r\n-        localStorage.setItem('accountRequests', JSON.stringify(requests));\r\n-\r\n-        // Fancy SweetAlert success card\r\n-        if (window.Swal) {\r\n-            Swal.fire({\r\n-                icon: 'success',\r\n-                title: 'Request Submitted!',\r\n-                text: 'Your account request is now pending approval. Please wait for an administrator to activate your account.',\r\n-                confirmButtonText: 'Great, thanks!',\r\n-                confirmButtonColor: '#800000',\r\n-                background: '#fff',\r\n-                heightAuto: false,\r\n-                customClass: {\r\n-                    popup: 'swal2-rounded'\r\n-                }\r\n-            });\r\n-        } else {\r\n-            alert('Your request has been submitted and is pending approval.');\r\n+        if (result.data.error) {\r\n+            showRequestError(result.data.error);\r\n+            return;\r\n         }\r\n \r\n-        // Reset form\r\n+        Swal.fire({\r\n+            icon: 'success',\r\n+            title: 'Request Submitted!',\r\n+            text: 'Your account request is now pending approval. Please wait for an administrator to activate your account.',\r\n+            confirmButtonText: 'Great, thanks!',\r\n+            confirmButtonColor: '#800000',\r\n+            background: '#fff',\r\n+            heightAuto: false\r\n+        });\r\n+\r\n         requestAccountForm.reset();\r\n+    })\r\n+    .catch(function(err) {\r\n+        console.error('Request failed:', err);\r\n         submitBtn.innerHTML = originalText;\r\n         submitBtn.disabled = false;\r\n-    }, 1000);\r\n+        showRequestError('Network error. Please try again.');\r\n+    });\r\n }\r\n \r\n+// Hook up form submit\r\n+const requestAccountForm = document.getElementById('requestAccountForm');\r\n+if (requestAccountForm) {\r\n+    requestAccountForm.addEventListener('submit', function(e) {\r\n+        e.preventDefault();\r\n+        handleAccountRequest();\r\n+    });\r\n+}\r\n+\r\n function showRequestError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'warning',\r\n"
                },
                {
                    "date": 1771609048681,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,5 @@\n \r\n-\r\n-\r\n-\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771609055646,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,4 @@\n-\r\n // DOM Ready\r\n document.addEventListener('DOMContentLoaded', function () {\r\n     // Login form submission\r\n     const loginForm = document.getElementById('loginForm');\r\n"
                },
                {
                    "date": 1771646633045,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,9 +167,9 @@\n     const originalText = submitBtn.innerHTML;\r\n     submitBtn.innerHTML = '<span class=\"loading-spinner\"></span> Submitting...';\r\n     submitBtn.disabled = true;\r\n \r\n-    fetch(\"http://localhost/Ethans%20Cafe/codes/php/register.php\", {\r\n+    fetch(\"http://localhost/Ethans%20Cafe/codes/php/account-re.php\", {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({\r\n             full_name: fullName,\r\n"
                },
                {
                    "date": 1771646640921,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,9 +167,9 @@\n     const originalText = submitBtn.innerHTML;\r\n     submitBtn.innerHTML = '<span class=\"loading-spinner\"></span> Submitting...';\r\n     submitBtn.disabled = true;\r\n \r\n-    fetch(\"http://localhost/Ethans%20Cafe/codes/php/account-re.php\", {\r\n+    fetch(\"http://localhost/Ethans%20Cafe/codes/php/account_request.php\", {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({\r\n             full_name: fullName,\r\n"
                },
                {
                    "date": 1771646761271,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -136,11 +136,10 @@\n     const fullName = document.getElementById('fullName').value.trim();\r\n     const username = document.getElementById('requestUsername').value.trim();\r\n     const password = document.getElementById('requestPassword').value.trim();\r\n     const confirmPassword = document.getElementById('confirmPassword').value.trim();\r\n-    const requestedRole = document.getElementById('requestedRole').value;\r\n+    const requestedRoleId = parseInt(document.getElementById('requestedRole').value);\r\n \r\n-    // Validation\r\n     if (!fullName || !username || !password || !confirmPassword) {\r\n         showRequestError('Please fill in all required fields');\r\n         return;\r\n     }\r\n@@ -159,24 +158,35 @@\n         showRequestError('Password must be at least 6 characters');\r\n         return;\r\n     }\r\n \r\n+    if (!requestedRoleId) {\r\n+        showRequestError('Please select a role');\r\n+        return;\r\n+    }\r\n+\r\n     const requestAccountForm = document.getElementById('requestAccountForm');\r\n     if (!requestAccountForm) return;\r\n \r\n     const submitBtn = requestAccountForm.querySelector('button[type=\"submit\"]');\r\n     const originalText = submitBtn.innerHTML;\r\n     submitBtn.innerHTML = '<span class=\"loading-spinner\"></span> Submitting...';\r\n     submitBtn.disabled = true;\r\n \r\n+    console.log('Sending:', {\r\n+        full_name: fullName,\r\n+        username: username,\r\n+        requested_role_id: requestedRoleId\r\n+    });\r\n+\r\n     fetch(\"http://localhost/Ethans%20Cafe/codes/php/account_request.php\", {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({\r\n             full_name: fullName,\r\n             username: username,\r\n             password: password,\r\n-            requested_role_id: requestedRole\r\n+            requested_role_id: requestedRoleId\r\n         })\r\n     })\r\n     .then(function(res) {\r\n         return res.json().then(function(data) {\r\n@@ -202,8 +212,9 @@\n             heightAuto: false\r\n         });\r\n \r\n         requestAccountForm.reset();\r\n+\r\n     })\r\n     .catch(function(err) {\r\n         console.error('Request failed:', err);\r\n         submitBtn.innerHTML = originalText;\r\n"
                },
                {
                    "date": 1771646842515,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -222,8 +222,9 @@\n         showRequestError('Network error. Please try again.');\r\n     });\r\n }\r\n \r\n+\r\n // Hook up form submit\r\n const requestAccountForm = document.getElementById('requestAccountForm');\r\n if (requestAccountForm) {\r\n     requestAccountForm.addEventListener('submit', function(e) {\r\n"
                },
                {
                    "date": 1771647052031,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -232,8 +232,11 @@\n         handleAccountRequest();\r\n     });\r\n }\r\n \r\n+\r\n+\r\n+\r\n function showRequestError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'warning',\r\n"
                },
                {
                    "date": 1771647365152,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -223,16 +223,16 @@\n     });\r\n }\r\n \r\n \r\n-// Hook up form submit\r\n-const requestAccountForm = document.getElementById('requestAccountForm');\r\n-if (requestAccountForm) {\r\n-    requestAccountForm.addEventListener('submit', function(e) {\r\n-        e.preventDefault();\r\n-        handleAccountRequest();\r\n-    });\r\n-}\r\n+// // Hook up form submit\r\n+// const requestAccountForm = document.getElementById('requestAccountForm');\r\n+// if (requestAccountForm) {\r\n+//     requestAccountForm.addEventListener('submit', function(e) {\r\n+//         e.preventDefault();\r\n+//         handleAccountRequest();\r\n+//     });\r\n+// }\r\n \r\n \r\n \r\n \r\n"
                },
                {
                    "date": 1771647401635,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -223,20 +223,21 @@\n     });\r\n }\r\n \r\n \r\n-// // Hook up form submit\r\n-// const requestAccountForm = document.getElementById('requestAccountForm');\r\n-// if (requestAccountForm) {\r\n-//     requestAccountForm.addEventListener('submit', function(e) {\r\n-//         e.preventDefault();\r\n-//         handleAccountRequest();\r\n-//     });\r\n-// }\r\n+const requestAccountForm = document.getElementById('requestAccountForm');\r\n+if (requestAccountForm) {\r\n+    // Remove old listeners by cloning\r\n+    const newForm = requestAccountForm.cloneNode(true);\r\n+    requestAccountForm.parentNode.replaceChild(newForm, requestAccountForm);\r\n+    newForm.addEventListener('submit', function(e) {\r\n+        e.preventDefault();\r\n+        handleAccountRequest();\r\n+    });\r\n+}\r\n \r\n \r\n \r\n-\r\n function showRequestError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'warning',\r\n"
                },
                {
                    "date": 1771647542383,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -130,16 +130,16 @@\n         }\r\n     }\r\n }\r\n \r\n-// Handle account request\r\n+/ Handle account request\r\n function handleAccountRequest() {\r\n     const fullName = document.getElementById('fullName').value.trim();\r\n     const username = document.getElementById('requestUsername').value.trim();\r\n     const password = document.getElementById('requestPassword').value.trim();\r\n     const confirmPassword = document.getElementById('confirmPassword').value.trim();\r\n     const requestedRoleId = parseInt(document.getElementById('requestedRole').value);\r\n-\r\n+/\r\n     if (!fullName || !username || !password || !confirmPassword) {\r\n         showRequestError('Please fill in all required fields');\r\n         return;\r\n     }\r\n"
                },
                {
                    "date": 1771647599795,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -130,16 +130,15 @@\n         }\r\n     }\r\n }\r\n \r\n-/ Handle account request\r\n function handleAccountRequest() {\r\n     const fullName = document.getElementById('fullName').value.trim();\r\n     const username = document.getElementById('requestUsername').value.trim();\r\n     const password = document.getElementById('requestPassword').value.trim();\r\n     const confirmPassword = document.getElementById('confirmPassword').value.trim();\r\n     const requestedRoleId = parseInt(document.getElementById('requestedRole').value);\r\n-/\r\n+\r\n     if (!fullName || !username || !password || !confirmPassword) {\r\n         showRequestError('Please fill in all required fields');\r\n         return;\r\n     }\r\n@@ -163,22 +162,15 @@\n         showRequestError('Please select a role');\r\n         return;\r\n     }\r\n \r\n-    const requestAccountForm = document.getElementById('requestAccountForm');\r\n-    if (!requestAccountForm) return;\r\n+    const submitBtn = document.querySelector('#requestAccountForm button[type=\"submit\"]');\r\n+    if (!submitBtn || submitBtn.disabled) return; // prevent double submit\r\n \r\n-    const submitBtn = requestAccountForm.querySelector('button[type=\"submit\"]');\r\n-    const originalText = submitBtn.innerHTML;\r\n+    const originalText = '<i class=\"fas fa-paper-plane me-2\"></i>Submit Request';\r\n     submitBtn.innerHTML = '<span class=\"loading-spinner\"></span> Submitting...';\r\n     submitBtn.disabled = true;\r\n \r\n-    console.log('Sending:', {\r\n-        full_name: fullName,\r\n-        username: username,\r\n-        requested_role_id: requestedRoleId\r\n-    });\r\n-\r\n     fetch(\"http://localhost/Ethans%20Cafe/codes/php/account_request.php\", {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({\r\n@@ -211,9 +203,10 @@\n             background: '#fff',\r\n             heightAuto: false\r\n         });\r\n \r\n-        requestAccountForm.reset();\r\n+        document.getElementById('requestAccountForm').reset();\r\n+        submitBtn.innerHTML = originalText;\r\n \r\n     })\r\n     .catch(function(err) {\r\n         console.error('Request failed:', err);\r\n@@ -222,22 +215,20 @@\n         showRequestError('Network error. Please try again.');\r\n     });\r\n }\r\n \r\n+// Attach submit listener once on DOMContentLoaded\r\n+document.addEventListener('DOMContentLoaded', function() {\r\n+    const requestAccountForm = document.getElementById('requestAccountForm');\r\n+    if (requestAccountForm) {\r\n+        requestAccountForm.addEventListener('submit', function(e) {\r\n+            e.preventDefault();\r\n+            handleAccountRequest();\r\n+        });\r\n+    }\r\n+});\r\n \r\n-const requestAccountForm = document.getElementById('requestAccountForm');\r\n-if (requestAccountForm) {\r\n-    // Remove old listeners by cloning\r\n-    const newForm = requestAccountForm.cloneNode(true);\r\n-    requestAccountForm.parentNode.replaceChild(newForm, requestAccountForm);\r\n-    newForm.addEventListener('submit', function(e) {\r\n-        e.preventDefault();\r\n-        handleAccountRequest();\r\n-    });\r\n-}\r\n \r\n-\r\n-\r\n function showRequestError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'warning',\r\n"
                },
                {
                    "date": 1771647799175,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -130,9 +130,13 @@\n         }\r\n     }\r\n }\r\n \r\n+let isSubmittingRequest = false;\r\n+\r\n function handleAccountRequest() {\r\n+    if (isSubmittingRequest) return; // block duplicate calls\r\n+\r\n     const fullName = document.getElementById('fullName').value.trim();\r\n     const username = document.getElementById('requestUsername').value.trim();\r\n     const password = document.getElementById('requestPassword').value.trim();\r\n     const confirmPassword = document.getElementById('confirmPassword').value.trim();\r\n@@ -163,14 +167,16 @@\n         return;\r\n     }\r\n \r\n     const submitBtn = document.querySelector('#requestAccountForm button[type=\"submit\"]');\r\n-    if (!submitBtn || submitBtn.disabled) return; // prevent double submit\r\n+    if (!submitBtn) return;\r\n \r\n-    const originalText = '<i class=\"fas fa-paper-plane me-2\"></i>Submit Request';\r\n+    isSubmittingRequest = true;\r\n+    submitBtn.disabled = true;\r\n     submitBtn.innerHTML = '<span class=\"loading-spinner\"></span> Submitting...';\r\n-    submitBtn.disabled = true;\r\n \r\n+    const originalText = '<i class=\"fas fa-paper-plane me-2\"></i>Submit Request';\r\n+\r\n     fetch(\"http://localhost/Ethans%20Cafe/codes/php/account_request.php\", {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({\r\n@@ -185,8 +191,9 @@\n             return { status: res.status, data: data };\r\n         });\r\n     })\r\n     .then(function(result) {\r\n+        isSubmittingRequest = false;\r\n         submitBtn.innerHTML = originalText;\r\n         submitBtn.disabled = false;\r\n \r\n         if (result.data.error) {\r\n@@ -204,31 +211,30 @@\n             heightAuto: false\r\n         });\r\n \r\n         document.getElementById('requestAccountForm').reset();\r\n-        submitBtn.innerHTML = originalText;\r\n \r\n     })\r\n     .catch(function(err) {\r\n         console.error('Request failed:', err);\r\n+        isSubmittingRequest = false;\r\n         submitBtn.innerHTML = originalText;\r\n         submitBtn.disabled = false;\r\n         showRequestError('Network error. Please try again.');\r\n     });\r\n }\r\n \r\n-// Attach submit listener once on DOMContentLoaded\r\n+// Attach ONCE  remove any onclick from the button in HTML too\r\n document.addEventListener('DOMContentLoaded', function() {\r\n-    const requestAccountForm = document.getElementById('requestAccountForm');\r\n-    if (requestAccountForm) {\r\n-        requestAccountForm.addEventListener('submit', function(e) {\r\n+    const form = document.getElementById('requestAccountForm');\r\n+    if (form) {\r\n+        form.addEventListener('submit', function(e) {\r\n             e.preventDefault();\r\n+            e.stopImmediatePropagation();\r\n             handleAccountRequest();\r\n         });\r\n     }\r\n });\r\n-\r\n-\r\n function showRequestError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'warning',\r\n"
                },
                {
                    "date": 1771647989573,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -222,19 +222,12 @@\n         showRequestError('Network error. Please try again.');\r\n     });\r\n }\r\n \r\n-// Attach ONCE  remove any onclick from the button in HTML too\r\n-document.addEventListener('DOMContentLoaded', function() {\r\n-    const form = document.getElementById('requestAccountForm');\r\n-    if (form) {\r\n-        form.addEventListener('submit', function(e) {\r\n-            e.preventDefault();\r\n-            e.stopImmediatePropagation();\r\n-            handleAccountRequest();\r\n-        });\r\n-    }\r\n-});\r\n+\r\n+\r\n+\r\n+\r\n function showRequestError(message) {\r\n     if (window.Swal) {\r\n         Swal.fire({\r\n             icon: 'warning',\r\n"
                },
                {
                    "date": 1771679295110,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -79,24 +79,33 @@\n             text: `Welcome back, ${data.full_name}!`,\r\n             showConfirmButton: false,\r\n             timer: 1200,\r\n             timerProgressBar: true\r\n-        }).then(() => {\r\n-            const role = parseInt(data.role_id);\r\n-            const roleName = (data.role_name || \"\").toLowerCase();\r\n+        })..then(() => {\r\n+    const role = parseInt(data.role_id);\r\n+    const roleName = (data.role_name || \"\").toLowerCase();\r\n \r\n-            if (role === 1 || roleName === \"admin\") {\r\n-                localStorage.setItem('loggedInRole', 'admin');\r\n-                window.location.href = \"admin-dashboard.html\";\r\n-            } else if (role === 2 || roleName === \"staff\") {\r\n-                localStorage.setItem('loggedInRole', 'staff');\r\n-                window.location.href = \"staff-menu.html\";\r\n-            } else {\r\n-                localStorage.setItem('loggedInRole', 'user');\r\n-                window.location.href = \"staff-menu.html\";\r\n-            }\r\n-        });\r\n+    // Save current user info\r\n+    localStorage.setItem('loggedInUserId', data.user_id);\r\n+    localStorage.setItem('loggedInUser', data.full_name);\r\n+    localStorage.setItem('currentUser', JSON.stringify({\r\n+        id: data.user_id,\r\n+        name: data.full_name,\r\n+        role: roleName\r\n+    }));\r\n \r\n+    if (role === 1 || roleName === \"admin\") {\r\n+        localStorage.setItem('loggedInRole', 'admin');\r\n+        window.location.href = \"admin-dashboard.html\";\r\n+    } else if (role === 2 || roleName === \"staff\") {\r\n+        localStorage.setItem('loggedInRole', 'staff');\r\n+        window.location.href = \"staff-menu.html\";\r\n+    } else {\r\n+        localStorage.setItem('loggedInRole', 'user');\r\n+        window.location.href = \"staff-menu.html\";\r\n+    }\r\n+});\r\n+\r\n     } catch (err) {\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n         console.error(\"Network or JS error:\", err);\r\n"
                },
                {
                    "date": 1771679301535,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -79,32 +79,32 @@\n             text: `Welcome back, ${data.full_name}!`,\r\n             showConfirmButton: false,\r\n             timer: 1200,\r\n             timerProgressBar: true\r\n-        })..then(() => {\r\n-    const role = parseInt(data.role_id);\r\n-    const roleName = (data.role_name || \"\").toLowerCase();\r\n+        }).then(() => {\r\n+            const role = parseInt(data.role_id);\r\n+            const roleName = (data.role_name || \"\").toLowerCase();\r\n \r\n-    // Save current user info\r\n-    localStorage.setItem('loggedInUserId', data.user_id);\r\n-    localStorage.setItem('loggedInUser', data.full_name);\r\n-    localStorage.setItem('currentUser', JSON.stringify({\r\n-        id: data.user_id,\r\n-        name: data.full_name,\r\n-        role: roleName\r\n-    }));\r\n+            // Save current user info\r\n+            localStorage.setItem('loggedInUserId', data.user_id);\r\n+            localStorage.setItem('loggedInUser', data.full_name);\r\n+            localStorage.setItem('currentUser', JSON.stringify({\r\n+                id: data.user_id,\r\n+                name: data.full_name,\r\n+                role: roleName\r\n+            }));\r\n \r\n-    if (role === 1 || roleName === \"admin\") {\r\n-        localStorage.setItem('loggedInRole', 'admin');\r\n-        window.location.href = \"admin-dashboard.html\";\r\n-    } else if (role === 2 || roleName === \"staff\") {\r\n-        localStorage.setItem('loggedInRole', 'staff');\r\n-        window.location.href = \"staff-menu.html\";\r\n-    } else {\r\n-        localStorage.setItem('loggedInRole', 'user');\r\n-        window.location.href = \"staff-menu.html\";\r\n-    }\r\n-});\r\n+            if (role === 1 || roleName === \"admin\") {\r\n+                localStorage.setItem('loggedInRole', 'admin');\r\n+                window.location.href = \"admin-dashboard.html\";\r\n+            } else if (role === 2 || roleName === \"staff\") {\r\n+                localStorage.setItem('loggedInRole', 'staff');\r\n+                window.location.href = \"staff-menu.html\";\r\n+            } else {\r\n+                localStorage.setItem('loggedInRole', 'user');\r\n+                window.location.href = \"staff-menu.html\";\r\n+            }\r\n+        });\r\n \r\n     } catch (err) {\r\n         loginBtn.innerHTML = originalText;\r\n         loginBtn.disabled = false;\r\n@@ -194,43 +194,43 @@\n             password: password,\r\n             requested_role_id: requestedRoleId\r\n         })\r\n     })\r\n-    .then(function(res) {\r\n-        return res.json().then(function(data) {\r\n-            return { status: res.status, data: data };\r\n-        });\r\n-    })\r\n-    .then(function(result) {\r\n-        isSubmittingRequest = false;\r\n-        submitBtn.innerHTML = originalText;\r\n-        submitBtn.disabled = false;\r\n+        .then(function (res) {\r\n+            return res.json().then(function (data) {\r\n+                return { status: res.status, data: data };\r\n+            });\r\n+        })\r\n+        .then(function (result) {\r\n+            isSubmittingRequest = false;\r\n+            submitBtn.innerHTML = originalText;\r\n+            submitBtn.disabled = false;\r\n \r\n-        if (result.data.error) {\r\n-            showRequestError(result.data.error);\r\n-            return;\r\n-        }\r\n+            if (result.data.error) {\r\n+                showRequestError(result.data.error);\r\n+                return;\r\n+            }\r\n \r\n-        Swal.fire({\r\n-            icon: 'success',\r\n-            title: 'Request Submitted!',\r\n-            text: 'Your account request is now pending approval. Please wait for an administrator to activate your account.',\r\n-            confirmButtonText: 'Great, thanks!',\r\n-            confirmButtonColor: '#800000',\r\n-            background: '#fff',\r\n-            heightAuto: false\r\n-        });\r\n+            Swal.fire({\r\n+                icon: 'success',\r\n+                title: 'Request Submitted!',\r\n+                text: 'Your account request is now pending approval. Please wait for an administrator to activate your account.',\r\n+                confirmButtonText: 'Great, thanks!',\r\n+                confirmButtonColor: '#800000',\r\n+                background: '#fff',\r\n+                heightAuto: false\r\n+            });\r\n \r\n-        document.getElementById('requestAccountForm').reset();\r\n+            document.getElementById('requestAccountForm').reset();\r\n \r\n-    })\r\n-    .catch(function(err) {\r\n-        console.error('Request failed:', err);\r\n-        isSubmittingRequest = false;\r\n-        submitBtn.innerHTML = originalText;\r\n-        submitBtn.disabled = false;\r\n-        showRequestError('Network error. Please try again.');\r\n-    });\r\n+        })\r\n+        .catch(function (err) {\r\n+            console.error('Request failed:', err);\r\n+            isSubmittingRequest = false;\r\n+            submitBtn.innerHTML = originalText;\r\n+            submitBtn.disabled = false;\r\n+            showRequestError('Network error. Please try again.');\r\n+        });\r\n }\r\n \r\n \r\n \r\n"
                }
            ],
            "date": 1771489379042,
            "name": "Commit-0",
            "content": "// Authentication JavaScript\r\nimport { usersDB, rolesDB } from './middle.js';\r\n// DOM Ready\r\ndocument.addEventListener('DOMContentLoaded', function () {\r\n    // Login form submission\r\n    const loginForm = document.getElementById('loginForm');\r\n    if (loginForm) {\r\n        loginForm.addEventListener('submit', function (e) {\r\n            e.preventDefault();\r\n            handleLogin();\r\n        });\r\n    }\r\n\r\n    // Request account form submission\r\n    const requestAccountForm = document.getElementById('requestAccountForm');\r\n    if (requestAccountForm) {\r\n        requestAccountForm.addEventListener('submit', function (e) {\r\n            e.preventDefault();\r\n            handleAccountRequest();\r\n        });\r\n    }\r\n});\r\n\r\n// Handle login\r\nfunction handleLogin() {\r\n    const username = document.getElementById('username').value;\r\n    const password = document.getElementById('password').value;\r\n    const loginError = document.getElementById('loginError');\r\n\r\n    // Basic validation\r\n    if (!username || !password) {\r\n        showLoginError('Please enter both username and password');\r\n        return;\r\n    }\r\n\r\n    const trimmedUsername = username.trim();\r\n    const trimmedPassword = password.trim();\r\n\r\n    // Show loading state\r\n    const loginForm = document.getElementById('loginForm');\r\n    if (!loginForm) return;\r\n    const loginBtn = loginForm.querySelector('button[type=\"submit\"]');\r\n    const originalText = loginBtn.innerHTML;\r\n    loginBtn.innerHTML = '<span class=\"loading-spinner\"></span> Logging in...';\r\n    loginBtn.disabled = true;\r\n\r\n    // Simulate API call with delay\r\n    setTimeout(() => {\r\n        // 1. Check dynamic users from localStorage\r\n        let users = [];\r\n        try {\r\n            const stored = localStorage.getItem('users');\r\n            if (stored) users = JSON.parse(stored);\r\n        } catch (e) { }\r\n\r\n        const foundUser = users.find(u =>\r\n            u.username.toLowerCase() === trimmedUsername.toLowerCase() &&\r\n            u.password === trimmedPassword &&\r\n            !u.isDeleted &&\r\n            u.status === 'Active'\r\n        );\r\n\r\n        if (foundUser || (trimmedUsername === 'admin' && trimmedPassword === 'admin123')) {\r\n            const role = foundUser ? foundUser.role.toLowerCase().replace(' ', '') : 'admin';\r\n            const displayName = foundUser ? foundUser.name : 'Admin';\r\n\r\n            loginBtn.innerHTML = originalText;\r\n            loginBtn.disabled = false;\r\n\r\n            // Save auth flag\r\n            localStorage.setItem('loggedInRole', role === 'seniorstaff' ? 'admin' : role);\r\n            localStorage.setItem('loggedInUser', displayName);\r\n\r\n            if (window.Swal) {\r\n                Swal.fire({\r\n                    icon: 'success',\r\n                    title: 'Login Successful',\r\n                    text: `Welcome back, ${displayName}!`,\r\n                    timer: 1500,\r\n                    timerProgressBar: true,\r\n                    showConfirmButton: false,\r\n                    heightAuto: false\r\n                }).then(() => {\r\n                    if (role === 'admin' || role === 'seniorstaff' || role === 'owner') {\r\n                        window.location.href = 'admin-dashboard.html';\r\n                    } else {\r\n                        window.location.href = 'staff-menu.html';\r\n                    }\r\n                });\r\n            } else {\r\n                if (role === 'admin' || role === 'seniorstaff' || role === 'owner') {\r\n                    window.location.href = 'admin-dashboard.html';\r\n                } else {\r\n                    window.location.href = 'staff-menu.html';\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        // 2. Legacy hardcoded check for safety (optional but good for dev)\r\n        if ((trimmedUsername === 'staff' && trimmedPassword === 'staff123') ||\r\n            (trimmedUsername === 'cashier' && trimmedPassword === 'cashier123')) {\r\n\r\n            const role = trimmedUsername;\r\n            loginBtn.innerHTML = originalText;\r\n            loginBtn.disabled = false;\r\n            localStorage.setItem('loggedInRole', role);\r\n            window.location.href = 'staff-menu.html';\r\n            return;\r\n        }\r\n\r\n        // If credentials don't match\r\n        showLoginError('Invalid username or password');\r\n        loginBtn.innerHTML = originalText;\r\n        loginBtn.disabled = false;\r\n    }, 1500);\r\n}\r\n\r\nfunction showLoginError(message) {\r\n    if (window.Swal) {\r\n        Swal.fire({\r\n            icon: 'error',\r\n            title: 'Login Failed',\r\n            text: message,\r\n            confirmButtonText: 'Try Again',\r\n            confirmButtonColor: '#800000',\r\n            background: '#fff',\r\n            heightAuto: false,\r\n            customClass: {\r\n                popup: 'swal2-rounded'\r\n            }\r\n        });\r\n    } else {\r\n        const loginError = document.getElementById('loginError');\r\n        if (loginError) {\r\n            loginError.textContent = message;\r\n            loginError.classList.remove('d-none');\r\n            setTimeout(() => {\r\n                loginError.classList.add('d-none');\r\n            }, 5000);\r\n        }\r\n    }\r\n}\r\n\r\n// Handle account request\r\nfunction handleAccountRequest() {\r\n    const fullName = document.getElementById('fullName').value;\r\n    const username = document.getElementById('requestUsername').value;\r\n    const password = document.getElementById('requestPassword').value;\r\n    const confirmPassword = document.getElementById('confirmPassword').value;\r\n    const requestedRole = document.getElementById('requestedRole').value;\r\n\r\n    const requestError = document.getElementById('requestError');\r\n    const requestSuccess = document.getElementById('requestSuccess');\r\n\r\n    // Validation\r\n    if (!fullName || !username || !password || !confirmPassword) {\r\n        showRequestError('Please fill in all required fields');\r\n        return;\r\n    }\r\n\r\n    if (password !== confirmPassword) {\r\n        showRequestError('Passwords do not match');\r\n        return;\r\n    }\r\n\r\n    if (password.length < 6) {\r\n        showRequestError('Password must be at least 6 characters');\r\n        return;\r\n    }\r\n\r\n    // Check username uniqueness (simulated)\r\n    const existingUsers = ['admin', 'staff', 'cashier', 'john', 'jane'];\r\n    if (existingUsers.includes(username.toLowerCase())) {\r\n        showRequestError('Username already exists. Please choose a different username.');\r\n        return;\r\n    }\r\n\r\n    // Show loading state\r\n    const requestAccountForm = document.getElementById('requestAccountForm');\r\n    if (!requestAccountForm) return;\r\n    const submitBtn = requestAccountForm.querySelector('button[type=\"submit\"]');\r\n    const originalText = submitBtn.innerHTML;\r\n    submitBtn.innerHTML = '<span class=\"loading-spinner\"></span> Submitting...';\r\n    submitBtn.disabled = true;\r\n\r\n    // Simulate API call\r\n    setTimeout(() => {\r\n        // Save request to local storage (simulated)\r\n        const request = {\r\n            id: Date.now(),\r\n            fullName,\r\n            username,\r\n            password, // In real app, this would be hashed\r\n            requestedRole,\r\n            status: 'Pending',\r\n            date: new Date().toLocaleDateString()\r\n        };\r\n\r\n        // Get existing requests or initialize array\r\n        let requests = JSON.parse(localStorage.getItem('accountRequests')) || [];\r\n        requests.push(request);\r\n        localStorage.setItem('accountRequests', JSON.stringify(requests));\r\n\r\n        // Fancy SweetAlert success card\r\n        if (window.Swal) {\r\n            Swal.fire({\r\n                icon: 'success',\r\n                title: 'Request Submitted!',\r\n                text: 'Your account request is now pending approval. Please wait for an administrator to activate your account.',\r\n                confirmButtonText: 'Great, thanks!',\r\n                confirmButtonColor: '#800000',\r\n                background: '#fff',\r\n                heightAuto: false,\r\n                customClass: {\r\n                    popup: 'swal2-rounded'\r\n                }\r\n            });\r\n        } else {\r\n            alert('Your request has been submitted and is pending approval.');\r\n        }\r\n\r\n        // Reset form\r\n        requestAccountForm.reset();\r\n        submitBtn.innerHTML = originalText;\r\n        submitBtn.disabled = false;\r\n    }, 1000);\r\n}\r\n\r\nfunction showRequestError(message) {\r\n    if (window.Swal) {\r\n        Swal.fire({\r\n            icon: 'warning',\r\n            title: 'Oops!',\r\n            text: message,\r\n            confirmButtonText: 'Got it',\r\n            confirmButtonColor: '#800000',\r\n            background: '#fff',\r\n            heightAuto: false,\r\n            customClass: {\r\n                popup: 'swal2-rounded'\r\n            }\r\n        });\r\n    } else {\r\n        const requestError = document.getElementById('requestError');\r\n        if (requestError) {\r\n            requestError.textContent = message;\r\n            requestError.classList.remove('d-none');\r\n            setTimeout(() => {\r\n                requestError.classList.add('d-none');\r\n            }, 5000);\r\n        }\r\n    }\r\n}"
        }
    ]
}