{
    "sourceFile": "codes/admin-system-settings.html",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1772359264565,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1772372631920,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -389,15 +389,8 @@\n                                                 <div class=\"card border-0 bg-light h-100\">\r\n                                                     <div class=\"card-body\">\r\n                                                         <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-exclamation-triangle me-2 text-danger\"></i>Stock Alerts</h6>\r\n                                                         <div class=\"mb-3\">\r\n-                                                            <label class=\"form-label small text-muted\">Low stock alert threshold</label>\r\n-                                                            <div class=\"input-group\">\r\n-                                                                <input type=\"number\" class=\"form-control\" id=\"setting_low_stock_threshold\" value=\"10\" min=\"1\">\r\n-                                                                <span class=\"input-group-text\">units</span>\r\n-                                                            </div>\r\n-                                                        </div>\r\n-                                                        <div>\r\n                                                             <label class=\"form-label small text-muted\">Expiry warning (days before)</label>\r\n                                                             <div class=\"input-group\">\r\n                                                                 <input type=\"number\" class=\"form-control\" id=\"setting_expiry_warning_days\" value=\"7\" min=\"1\" max=\"90\">\r\n                                                                 <span class=\"input-group-text\">days</span>\r\n@@ -520,9 +513,9 @@\n \r\n             // Save button listeners with descriptive labels\r\n             document.getElementById('saveSystemConfigBtn')?.addEventListener('click', () => saveSettingsGroup(['currency_symbol', 'tax_rate', 'allow_order_modification', 'require_manager_void', 'auto_logout_minutes'], 'General Configuration'));\r\n             document.getElementById('savePosSettingsBtn')?.addEventListener('click', () => saveSettingsGroup(['enable_discount', 'enable_coupon', 'auto_print_receipt', 'hold_order_expiry_hours'], 'POS / Cashier Settings'));\r\n-            document.getElementById('saveInventorySettingsBtn')?.addEventListener('click', () => saveSettingsGroup(['low_stock_threshold', 'expiry_warning_days', 'enable_email_notifications'], 'Inventory & Alerts'));\r\n+            document.getElementById('saveInventorySettingsBtn')?.addEventListener('click', () => saveSettingsGroup(['expiry_warning_days', 'enable_email_notifications'], 'Inventory & Alerts'));\r\n             document.getElementById('saveRefundSettingsBtn')?.addEventListener('click', () => saveSettingsGroup(['allow_partial_refund', 'refund_time_limit_hours', 'require_reason_for_void'], 'Refund & Void Settings'));\r\n             document.getElementById('saveAllSettingsBtn')?.addEventListener('click', saveAllSettings);\r\n             document.getElementById('saveRestProfileBtn')?.addEventListener('click', saveRestaurantProfile);\r\n         });\r\n@@ -627,9 +620,9 @@\n         async function saveAllSettings() {\r\n             const allKeys = [\r\n                 'currency_symbol', 'tax_rate', 'allow_order_modification', 'require_manager_void', 'auto_logout_minutes',\r\n                 'enable_discount', 'enable_coupon', 'auto_print_receipt', 'hold_order_expiry_hours',\r\n-                'low_stock_threshold', 'expiry_warning_days', 'enable_email_notifications',\r\n+                'expiry_warning_days', 'enable_email_notifications',\r\n                 'allow_partial_refund', 'refund_time_limit_hours', 'require_reason_for_void'\r\n             ];\r\n             await saveSettingsGroup(allKeys, 'All System Settings');\r\n         }\r\n"
                }
            ],
            "date": 1772359264565,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>System Settings - Admin Dashboard</title>\r\n\r\n    <!-- Bootstrap 5 CSS -->\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n    <!-- Font Awesome -->\r\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\r\n    <!-- Animate.css -->\r\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css\">\r\n\r\n    <!-- Custom CSS -->\r\n    <link rel=\"stylesheet\" href=\"style.css\">\r\n    <link rel=\"stylesheet\" href=\"admin.css\">\r\n    <style>\r\n        /* Settings Tab Styles */\r\n        #settingsTabs .nav-link {\r\n            color: #333;\r\n            border-radius: 8px;\r\n            padding: 12px 16px;\r\n            font-weight: 500;\r\n            transition: all 0.2s ease;\r\n        }\r\n        #settingsTabs .nav-link:hover {\r\n            background-color: #f0f0f0;\r\n            color: #800000;\r\n        }\r\n        #settingsTabs .nav-link.active {\r\n            background-color: #800000;\r\n            color: #fff;\r\n        }\r\n        #settingsTabs .nav-link i {\r\n            width: 20px;\r\n        }\r\n        .tab-content {\r\n            min-height: 400px;\r\n        }\r\n        @media (max-width: 767.98px) {\r\n            #settingsTabs {\r\n                flex-direction: row !important;\r\n                flex-wrap: nowrap;\r\n                overflow-x: auto;\r\n                padding-bottom: 0 !important;\r\n            }\r\n            #settingsTabs .nav-link {\r\n                white-space: nowrap;\r\n                margin-bottom: 0 !important;\r\n                margin-right: 8px;\r\n                padding: 8px 12px;\r\n                font-size: 0.85rem;\r\n            }\r\n            #settingsTabs .nav-link i {\r\n                display: none;\r\n            }\r\n        }\r\n    </style>\r\n    <script>\r\n        // Immediate Sidebar State Initialization\r\n        (function () {\r\n            const html = document.documentElement;\r\n            html.classList.add('initializing');\r\n\r\n            const sidebarState = localStorage.getItem('sidebarActive');\r\n            if (sidebarState === 'true' && window.innerWidth >= 992) {\r\n                html.classList.add('sidebar-active');\r\n            }\r\n\r\n            // Auth Guard (Admin/Owner version)\r\n            try {\r\n                const role = localStorage.getItem('loggedInRole');\r\n                if (role !== 'admin' && role !== 'owner') {\r\n                    window.location.href = 'index.html';\r\n                }\r\n            } catch (e) {\r\n                window.location.href = 'index.html';\r\n            }\r\n        })();\r\n    </script>\r\n</head>\r\n\r\n<body>\r\n    <!-- Navigation Bar -->\r\n    <nav class=\"navbar navbar-expand-lg navbar-dark bg-black fixed-top shadow\">\r\n        <div class=\"container-fluid\">\r\n            <button class=\"sidebar-toggle mt-1 me-2\" id=\"sidebarToggle\">\r\n                <i class=\"fas fa-bars\"></i>\r\n            </button>\r\n\r\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#headerNav\">\r\n                <span class=\"fas fa-ellipsis-v\"></span>\r\n            </button>\r\n            <div class=\"collapse navbar-collapse\" id=\"headerNav\">\r\n                <ul class=\"navbar-nav ms-auto\">\r\n                    <li class=\"nav-item dropdown\">\r\n                        <a class=\"nav-link dropdown-toggle\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n                            <i class=\"fas fa-user-shield me-1\"></i>Administrator\r\n                        </a>\r\n                        <ul class=\"dropdown-menu dropdown-menu-end shadow border-0 animate__animated animate__fadeIn\">\r\n                            <li><a class=\"dropdown-item active\" href=\"admin-system-settings.html\"><i\r\n                                        class=\"fas fa-cog me-2 text-danger\"></i>Settings</a></li>\r\n                            <li><a class=\"dropdown-item\" href=\"admin-activity-log.html\"><i\r\n                                        class=\"fas fa-history me-2 text-danger\"></i>Activity Log</a></li>\r\n                            <li>\r\n                                <hr class=\"dropdown-divider\">\r\n                            </li>\r\n                            <li><a class=\"dropdown-item text-danger\" href=\"#\" id=\"logoutBtn\"><i\r\n                                        class=\"fas fa-sign-out-alt me-2\"></i>Logout</a></li>\r\n                        </ul>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    </nav>\r\n\r\n    <div class=\"dashboard-layout\">\r\n        <!-- Sidebar Navigation -->\r\n        <aside class=\"sidebar\" id=\"sidebar\">\r\n            <div class=\"sidebar-branding\">\r\n                <button class=\"sidebar-toggle in-sidebar\" id=\"sidebarToggleInternal\">\r\n                    <i class=\"fas fa-bars\"></i>\r\n                </button>\r\n                <a href=\"admin-dashboard.html\" class=\"sidebar-brand-group\">\r\n                    <img src=\"resources/ethans logo.jpg\" alt=\"Logo\">\r\n                    <span class=\"pos-label\">POS</span>\r\n                </a>\r\n            </div>\r\n            <div class=\"sidebar-nav\">\r\n                <div class=\"sidebar-section-title\">Navigation</div>\r\n                <a href=\"admin-dashboard.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-tachometer-alt\"></i>Dashboard\r\n                </a>\r\n                <a href=\"admin-menu-control.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-utensils\"></i>Menu Control\r\n                </a>\r\n                <a href=\"admin-recipe-control.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-book\"></i>Recipe Control\r\n                </a>\r\n                <a href=\"admin-ingredients-masterlist.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-boxes\"></i>Ingredients\r\n                </a>\r\n                <a href=\"admin-menu_customization.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-palette\"></i>Menu Customization\r\n                </a>\r\n                <a href=\"admin-user-management.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-users\"></i>Users\r\n                </a>\r\n                <a href=\"admin-requests.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-inbox\"></i>Requests\r\n                </a>\r\n\r\n                <div class=\"sidebar-divider\"></div>\r\n                <div class=\"sidebar-section-title\">Reports & Data</div>\r\n                <a href=\"admin-reports.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-chart-bar\"></i>Owner Reports\r\n                </a>\r\n                <a href=\"admin-backup.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-database\"></i>Backup & Restore\r\n                </a>\r\n\r\n                <div class=\"sidebar-divider\"></div>\r\n                <div class=\"sidebar-section-title\">System</div>\r\n                <a href=\"admin-system-settings.html\" class=\"sidebar-link active\">\r\n                    <i class=\"fas fa-cog\"></i>System Settings\r\n                </a>\r\n                <a href=\"admin-activity-log.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-history\"></i>Full Activity Log\r\n                </a>\r\n                <a href=\"admin-temp-account.html\" class=\"sidebar-link\">\r\n                    <i class=\"fas fa-user-clock\"></i>Temp Staff Account\r\n                </a>\r\n            </div>\r\n        </aside>\r\n\r\n        <!-- Main Content Area -->\r\n        <main class=\"main-content\">\r\n            <!-- System Settings Content -->\r\n            <div id=\"system-settings-content\" class=\"page-content\">\r\n                <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\r\n                    <h1 class=\"h2\"><i class=\"fas fa-cog me-2 text-danger\"></i>System Settings</h1>\r\n                    <button type=\"button\" class=\"btn btn-danger\" id=\"saveAllSettingsBtn\">\r\n                        <i class=\"fas fa-save me-1\"></i> Save All Settings\r\n                    </button>\r\n                </div>\r\n\r\n                <!-- Tabbed Interface -->\r\n                <div class=\"card shadow\">\r\n                    <div class=\"card-body p-0\">\r\n                        <div class=\"row g-0\">\r\n                            <!-- Vertical Tab Navigation -->\r\n                            <div class=\"col-md-3 col-lg-2 border-end bg-light\">\r\n                                <div class=\"nav flex-column nav-pills p-3\" id=\"settingsTabs\" role=\"tablist\">\r\n                                    <button class=\"nav-link active text-start mb-2\" id=\"tab-profile\" data-bs-toggle=\"pill\" data-bs-target=\"#panel-profile\" type=\"button\">\r\n                                        <i class=\"fas fa-store me-2\"></i>Restaurant Profile\r\n                                    </button>\r\n                                    <button class=\"nav-link text-start mb-2\" id=\"tab-general\" data-bs-toggle=\"pill\" data-bs-target=\"#panel-general\" type=\"button\">\r\n                                        <i class=\"fas fa-cogs me-2\"></i>General Config\r\n                                    </button>\r\n                                    <button class=\"nav-link text-start mb-2\" id=\"tab-pos\" data-bs-toggle=\"pill\" data-bs-target=\"#panel-pos\" type=\"button\">\r\n                                        <i class=\"fas fa-cash-register me-2\"></i>POS / Cashier\r\n                                    </button>\r\n                                    <button class=\"nav-link text-start mb-2\" id=\"tab-inventory\" data-bs-toggle=\"pill\" data-bs-target=\"#panel-inventory\" type=\"button\">\r\n                                        <i class=\"fas fa-boxes me-2\"></i>Inventory & Alerts\r\n                                    </button>\r\n                                    <button class=\"nav-link text-start\" id=\"tab-refund\" data-bs-toggle=\"pill\" data-bs-target=\"#panel-refund\" type=\"button\">\r\n                                        <i class=\"fas fa-undo-alt me-2\"></i>Refund & Void\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <!-- Tab Content Panels -->\r\n                            <div class=\"col-md-9 col-lg-10\">\r\n                                <div class=\"tab-content p-4\" id=\"settingsTabContent\">\r\n                                    \r\n                                    <!-- Restaurant Profile Panel -->\r\n                                    <div class=\"tab-pane fade show active\" id=\"panel-profile\" role=\"tabpanel\">\r\n                                        <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n                                            <h5 class=\"mb-0\"><i class=\"fas fa-store me-2 text-danger\"></i>Restaurant Profile</h5>\r\n                                            <button type=\"button\" class=\"btn btn-danger btn-sm\" id=\"saveRestProfileBtn\">\r\n                                                <i class=\"fas fa-save me-1\"></i> Save Profile\r\n                                            </button>\r\n                                        </div>\r\n                                        <div class=\"row\">\r\n                                            <div class=\"col-lg-8\">\r\n                                                <div class=\"row g-3\">\r\n                                                    <div class=\"col-md-6\">\r\n                                                        <label class=\"form-label fw-semibold\">Restaurant Name</label>\r\n                                                        <input type=\"text\" class=\"form-control\" id=\"restName\" value=\"Ethan's Caffe & Restaurant\">\r\n                                                    </div>\r\n                                                    <div class=\"col-md-6\">\r\n                                                        <label class=\"form-label fw-semibold\">Contact Number</label>\r\n                                                        <input type=\"text\" class=\"form-control\" id=\"restContact\" value=\"+63 123 456 7890\">\r\n                                                    </div>\r\n                                                    <div class=\"col-12\">\r\n                                                        <label class=\"form-label fw-semibold\">Address</label>\r\n                                                        <textarea class=\"form-control\" id=\"restAddress\" rows=\"2\">123 Street Block, City Name</textarea>\r\n                                                    </div>\r\n                                                    <div class=\"col-md-6\">\r\n                                                        <label class=\"form-label fw-semibold\">TIN Number</label>\r\n                                                        <input type=\"text\" class=\"form-control\" id=\"restTin\" value=\"000-111-222-333\">\r\n                                                    </div>\r\n                                                    <div class=\"col-md-6\">\r\n                                                        <label class=\"form-label fw-semibold\">Store Logo</label>\r\n                                                        <input type=\"file\" class=\"form-control\" id=\"restLogo\">\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div class=\"col-lg-4 text-center mt-4 mt-lg-0\">\r\n                                                <div class=\"border rounded p-4 bg-light\">\r\n                                                    <img src=\"resources/ethans logo.jpg\" alt=\"Logo\" class=\"rounded mb-3\" style=\"max-height: 120px;\">\r\n                                                    <p class=\"text-muted small mb-0\">Current Store Logo</p>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <!-- General Configuration Panel -->\r\n                                    <div class=\"tab-pane fade\" id=\"panel-general\" role=\"tabpanel\">\r\n                                        <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n                                            <h5 class=\"mb-0\"><i class=\"fas fa-cogs me-2 text-danger\"></i>General Configuration</h5>\r\n                                            <button type=\"button\" class=\"btn btn-danger btn-sm\" id=\"saveSystemConfigBtn\">\r\n                                                <i class=\"fas fa-save me-1\"></i> Save Config\r\n                                            </button>\r\n                                        </div>\r\n                                        <div class=\"row g-4\">\r\n                                            <!-- Currency & Tax -->\r\n                                            <div class=\"col-lg-6\">\r\n                                                <div class=\"card border-0 bg-light h-100\">\r\n                                                    <div class=\"card-body\">\r\n                                                        <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-coins me-2 text-warning\"></i>Currency & Tax</h6>\r\n                                                        <div class=\"row g-3\">\r\n                                                            <div class=\"col-6\">\r\n                                                                <label class=\"form-label small text-muted\">Currency Symbol</label>\r\n                                                                <input type=\"text\" class=\"form-control\" id=\"setting_currency_symbol\" value=\"P\">\r\n                                                            </div>\r\n                                                            <div class=\"col-6\">\r\n                                                                <label class=\"form-label small text-muted\">Tax Rate (%)</label>\r\n                                                                <input type=\"number\" class=\"form-control\" id=\"setting_tax_rate\" step=\"0.01\" value=\"12\">\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <!-- Security -->\r\n                                            <div class=\"col-lg-6\">\r\n                                                <div class=\"card border-0 bg-light h-100\">\r\n                                                    <div class=\"card-body\">\r\n                                                        <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-shield-alt me-2 text-primary\"></i>Security</h6>\r\n                                                        <label class=\"form-label small text-muted\">Auto logout after (minutes)</label>\r\n                                                        <input type=\"number\" class=\"form-control\" id=\"setting_auto_logout_minutes\" value=\"30\" min=\"5\" max=\"120\">\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <!-- Transaction Settings -->\r\n                                            <div class=\"col-12\">\r\n                                                <div class=\"card border-0 bg-light\">\r\n                                                    <div class=\"card-body\">\r\n                                                        <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-exchange-alt me-2 text-info\"></i>Transaction Settings</h6>\r\n                                                        <div class=\"row\">\r\n                                                            <div class=\"col-md-6\">\r\n                                                                <div class=\"form-check form-switch mb-3\">\r\n                                                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"setting_allow_order_modification\" checked>\r\n                                                                    <label class=\"form-check-label\" for=\"setting_allow_order_modification\">\r\n                                                                        Allow staff to modify orders after printing\r\n                                                                    </label>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                            <div class=\"col-md-6\">\r\n                                                                <div class=\"form-check form-switch mb-3\">\r\n                                                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"setting_require_manager_void\" checked>\r\n                                                                    <label class=\"form-check-label\" for=\"setting_require_manager_void\">\r\n                                                                        Require manager approval for voiding items\r\n                                                                    </label>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <!-- POS / Cashier Panel -->\r\n                                    <div class=\"tab-pane fade\" id=\"panel-pos\" role=\"tabpanel\">\r\n                                        <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n                                            <h5 class=\"mb-0\"><i class=\"fas fa-cash-register me-2 text-danger\"></i>POS / Cashier Settings</h5>\r\n                                            <button type=\"button\" class=\"btn btn-danger btn-sm\" id=\"savePosSettingsBtn\">\r\n                                                <i class=\"fas fa-save me-1\"></i> Save POS Settings\r\n                                            </button>\r\n                                        </div>\r\n                                        <div class=\"row g-4\">\r\n                                            <!-- Checkout Options -->\r\n                                            <div class=\"col-lg-6\">\r\n                                                <div class=\"card border-0 bg-light h-100\">\r\n                                                    <div class=\"card-body\">\r\n                                                        <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-shopping-cart me-2 text-success\"></i>Checkout Options</h6>\r\n                                                        <div class=\"form-check form-switch mb-3\">\r\n                                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"setting_enable_discount\">\r\n                                                            <label class=\"form-check-label\" for=\"setting_enable_discount\">\r\n                                                                Enable Discount Button\r\n                                                            </label>\r\n                                                        </div>\r\n                                                        <div class=\"form-check form-switch mb-3\">\r\n                                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"setting_enable_coupon\">\r\n                                                            <label class=\"form-check-label\" for=\"setting_enable_coupon\">\r\n                                                                Enable Coupon Button\r\n                                                            </label>\r\n                                                        </div>\r\n                                                        <div class=\"form-check form-switch\">\r\n                                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"setting_auto_print_receipt\">\r\n                                                            <label class=\"form-check-label\" for=\"setting_auto_print_receipt\">\r\n                                                                Auto-print receipt on checkout\r\n                                                            </label>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <!-- Hold Order Settings -->\r\n                                            <div class=\"col-lg-6\">\r\n                                                <div class=\"card border-0 bg-light h-100\">\r\n                                                    <div class=\"card-body\">\r\n                                                        <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-pause-circle me-2 text-warning\"></i>Hold Order Settings</h6>\r\n                                                        <label class=\"form-label small text-muted\">Hold order expiry (hours)</label>\r\n                                                        <div class=\"input-group\">\r\n                                                            <input type=\"number\" class=\"form-control\" id=\"setting_hold_order_expiry_hours\" value=\"5\" min=\"1\" max=\"48\">\r\n                                                            <span class=\"input-group-text\">hours</span>\r\n                                                        </div>\r\n                                                        <small class=\"text-muted mt-2 d-block\">Orders held longer than this will expire automatically.</small>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <!-- Inventory & Alerts Panel -->\r\n                                    <div class=\"tab-pane fade\" id=\"panel-inventory\" role=\"tabpanel\">\r\n                                        <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n                                            <h5 class=\"mb-0\"><i class=\"fas fa-boxes me-2 text-danger\"></i>Inventory & Alerts</h5>\r\n                                            <button type=\"button\" class=\"btn btn-danger btn-sm\" id=\"saveInventorySettingsBtn\">\r\n                                                <i class=\"fas fa-save me-1\"></i> Save Inventory Settings\r\n                                            </button>\r\n                                        </div>\r\n                                        <div class=\"row g-4\">\r\n                                            <!-- Stock Alerts -->\r\n                                            <div class=\"col-lg-6\">\r\n                                                <div class=\"card border-0 bg-light h-100\">\r\n                                                    <div class=\"card-body\">\r\n                                                        <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-exclamation-triangle me-2 text-danger\"></i>Stock Alerts</h6>\r\n                                                        <div class=\"mb-3\">\r\n                                                            <label class=\"form-label small text-muted\">Low stock alert threshold</label>\r\n                                                            <div class=\"input-group\">\r\n                                                                <input type=\"number\" class=\"form-control\" id=\"setting_low_stock_threshold\" value=\"10\" min=\"1\">\r\n                                                                <span class=\"input-group-text\">units</span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <label class=\"form-label small text-muted\">Expiry warning (days before)</label>\r\n                                                            <div class=\"input-group\">\r\n                                                                <input type=\"number\" class=\"form-control\" id=\"setting_expiry_warning_days\" value=\"7\" min=\"1\" max=\"90\">\r\n                                                                <span class=\"input-group-text\">days</span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <!-- Notifications -->\r\n                                            <div class=\"col-lg-6\">\r\n                                                <div class=\"card border-0 bg-light h-100\">\r\n                                                    <div class=\"card-body\">\r\n                                                        <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-bell me-2 text-info\"></i>Notifications</h6>\r\n                                                        <div class=\"form-check form-switch mb-3\">\r\n                                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"setting_enable_email_notifications\">\r\n                                                            <label class=\"form-check-label\" for=\"setting_enable_email_notifications\">\r\n                                                                Enable email notifications\r\n                                                            </label>\r\n                                                        </div>\r\n                                                        <small class=\"text-muted d-block\">Receive alerts via email for low stock and expiring items.</small>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <!-- Refund & Void Panel -->\r\n                                    <div class=\"tab-pane fade\" id=\"panel-refund\" role=\"tabpanel\">\r\n                                        <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n                                            <h5 class=\"mb-0\"><i class=\"fas fa-undo-alt me-2 text-danger\"></i>Refund & Void Settings</h5>\r\n                                            <button type=\"button\" class=\"btn btn-danger btn-sm\" id=\"saveRefundSettingsBtn\">\r\n                                                <i class=\"fas fa-save me-1\"></i> Save Refund Settings\r\n                                            </button>\r\n                                        </div>\r\n                                        <div class=\"row g-4\">\r\n                                            <!-- Refund Options -->\r\n                                            <div class=\"col-lg-6\">\r\n                                                <div class=\"card border-0 bg-light h-100\">\r\n                                                    <div class=\"card-body\">\r\n                                                        <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-hand-holding-usd me-2 text-success\"></i>Refund Options</h6>\r\n                                                        <div class=\"form-check form-switch mb-3\">\r\n                                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"setting_allow_partial_refund\">\r\n                                                            <label class=\"form-check-label\" for=\"setting_allow_partial_refund\">\r\n                                                                Allow partial refund (item-level)\r\n                                                            </label>\r\n                                                        </div>\r\n                                                        <label class=\"form-label small text-muted\">Refund time limit (hours after sale)</label>\r\n                                                        <div class=\"input-group\">\r\n                                                            <input type=\"number\" class=\"form-control\" id=\"setting_refund_time_limit_hours\" value=\"24\" min=\"1\" max=\"168\">\r\n                                                            <span class=\"input-group-text\">hours</span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <!-- Void Options -->\r\n                                            <div class=\"col-lg-6\">\r\n                                                <div class=\"card border-0 bg-light h-100\">\r\n                                                    <div class=\"card-body\">\r\n                                                        <h6 class=\"card-title fw-bold mb-3\"><i class=\"fas fa-ban me-2 text-danger\"></i>Void Options</h6>\r\n                                                        <div class=\"form-check form-switch mb-3\">\r\n                                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"setting_require_reason_for_void\">\r\n                                                            <label class=\"form-check-label\" for=\"setting_require_reason_for_void\">\r\n                                                                Require reason for void\r\n                                                            </label>\r\n                                                        </div>\r\n                                                        <small class=\"text-muted d-block\">Staff must provide a reason when voiding transactions.</small>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Info Alert -->\r\n                <div class=\"alert alert-info mt-4 d-flex align-items-center\">\r\n                    <i class=\"fas fa-info-circle me-3 fa-lg\"></i>\r\n                    <div>\r\n                        <strong>Note:</strong> Changes to settings take effect immediately for all users. Toggle settings use true/false values, and all settings are stored in the database.\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </main>\r\n    </div>\r\n\r\n    <!-- Bootstrap 5 JS -->\r\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js\"></script>\r\n    <script src=\"https://code.jquery.com/jquery-3.6.4.min.js\"></script>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/sweetalert2@11\"></script>\r\n\r\n    <!-- Custom JS -->\r\n    <script src=\"main.js\"></script>\r\n    <script src=\"admin.js\"></script>\r\n\r\n    <script>\r\n        // System Settings Page Logic\r\n        // Note: systemSettingsDB is already defined in admin.js\r\n        let settingsPageData = {};\r\n\r\n        // Loading modal helpers (defined here since admin.js doesn't have them)\r\n        function showSettingsLoading(message = 'Loading...') {\r\n            Swal.fire({\r\n                title: message,\r\n                allowOutsideClick: false,\r\n                showConfirmButton: false,\r\n                didOpen: () => { Swal.showLoading(); }\r\n            });\r\n        }\r\n\r\n        function hideSettingsLoading() {\r\n            Swal.close();\r\n        }\r\n\r\n        document.addEventListener('DOMContentLoaded', function() {\r\n            loadAllSettings();\r\n\r\n            // Save button listeners with descriptive labels\r\n            document.getElementById('saveSystemConfigBtn')?.addEventListener('click', () => saveSettingsGroup(['currency_symbol', 'tax_rate', 'allow_order_modification', 'require_manager_void', 'auto_logout_minutes'], 'General Configuration'));\r\n            document.getElementById('savePosSettingsBtn')?.addEventListener('click', () => saveSettingsGroup(['enable_discount', 'enable_coupon', 'auto_print_receipt', 'hold_order_expiry_hours'], 'POS / Cashier Settings'));\r\n            document.getElementById('saveInventorySettingsBtn')?.addEventListener('click', () => saveSettingsGroup(['low_stock_threshold', 'expiry_warning_days', 'enable_email_notifications'], 'Inventory & Alerts'));\r\n            document.getElementById('saveRefundSettingsBtn')?.addEventListener('click', () => saveSettingsGroup(['allow_partial_refund', 'refund_time_limit_hours', 'require_reason_for_void'], 'Refund & Void Settings'));\r\n            document.getElementById('saveAllSettingsBtn')?.addEventListener('click', saveAllSettings);\r\n            document.getElementById('saveRestProfileBtn')?.addEventListener('click', saveRestaurantProfile);\r\n        });\r\n\r\n        async function loadAllSettings() {\r\n            showSettingsLoading('Loading settings...');\r\n            try {\r\n                const settings = await systemSettingsDB.show();\r\n                settings.forEach(s => {\r\n                    settingsPageData[s.key] = s.value;\r\n                    applySettingToUI(s.key, s.value);\r\n                    \r\n                    // Also apply restaurant profile fields\r\n                    if (s.key === 'restaurant_name' && document.getElementById('restName')) {\r\n                        document.getElementById('restName').value = s.value;\r\n                    }\r\n                    if (s.key === 'restaurant_address' && document.getElementById('restAddress')) {\r\n                        document.getElementById('restAddress').value = s.value;\r\n                    }\r\n                    if (s.key === 'restaurant_contact' && document.getElementById('restContact')) {\r\n                        document.getElementById('restContact').value = s.value;\r\n                    }\r\n                    if (s.key === 'restaurant_tin' && document.getElementById('restTin')) {\r\n                        document.getElementById('restTin').value = s.value;\r\n                    }\r\n                });\r\n                hideSettingsLoading();\r\n            } catch (err) {\r\n                hideSettingsLoading();\r\n                console.error('Failed to load settings:', err);\r\n                Swal.fire('Error', 'Failed to load system settings. Make sure the database table exists.', 'error');\r\n            }\r\n        }\r\n\r\n        function applySettingToUI(key, value) {\r\n            const element = document.getElementById('setting_' + key);\r\n            if (!element) return;\r\n\r\n            if (element.type === 'checkbox') {\r\n                element.checked = value === 'true';\r\n            } else {\r\n                element.value = value;\r\n            }\r\n        }\r\n\r\n        function getSettingFromUI(key) {\r\n            const element = document.getElementById('setting_' + key);\r\n            if (!element) return null;\r\n\r\n            if (element.type === 'checkbox') {\r\n                return element.checked ? 'true' : 'false';\r\n            } else {\r\n                return element.value;\r\n            }\r\n        }\r\n\r\n        async function saveSettingsGroup(keys, groupLabel = 'System Settings') {\r\n            showSettingsLoading('Saving settings...');\r\n\r\n            // Build a readable summary of changes\r\n            let changesDescription = [];\r\n\r\n            try {\r\n                for (const key of keys) {\r\n                    const value = getSettingFromUI(key);\r\n                    if (value !== null) {\r\n                        // Check if value actually changed\r\n                        const oldValue = settingsPageData[key];\r\n                        if (oldValue !== value) {\r\n                            const readableKey = key.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\r\n                            const readableValue = (value === 'true' || value === 'false') \r\n                                ? (value === 'true' ? 'Enabled' : 'Disabled')\r\n                                : value;\r\n                            changesDescription.push(`${readableKey}: ${readableValue}`);\r\n                        }\r\n                        // Use edit with key as identifier for system_settings\r\n                        await systemSettingsDB.edit({ key: key, value: value, updated_at: new Date().toISOString() });\r\n                        settingsPageData[key] = value;\r\n                    }\r\n                }\r\n                hideSettingsLoading();\r\n                Swal.fire({\r\n                    icon: 'success',\r\n                    title: 'Settings Saved',\r\n                    text: 'Your settings have been updated successfully.',\r\n                    timer: 2000,\r\n                    showConfirmButton: false\r\n                });\r\n                if (typeof logAdminActivity === 'function') {\r\n                    const reference = changesDescription.length > 0 \r\n                        ? changesDescription.slice(0, 3).join(', ') + (changesDescription.length > 3 ? ` (+${changesDescription.length - 3} more)` : '')\r\n                        : 'No changes detected';\r\n                    logAdminActivity(`Updated ${groupLabel}`, reference, 'Success');\r\n                }\r\n            } catch (err) {\r\n                hideSettingsLoading();\r\n                console.error('Failed to save settings:', err);\r\n                Swal.fire('Error', 'Failed to save settings. Please try again.', 'error');\r\n            }\r\n        }\r\n\r\n        async function saveAllSettings() {\r\n            const allKeys = [\r\n                'currency_symbol', 'tax_rate', 'allow_order_modification', 'require_manager_void', 'auto_logout_minutes',\r\n                'enable_discount', 'enable_coupon', 'auto_print_receipt', 'hold_order_expiry_hours',\r\n                'low_stock_threshold', 'expiry_warning_days', 'enable_email_notifications',\r\n                'allow_partial_refund', 'refund_time_limit_hours', 'require_reason_for_void'\r\n            ];\r\n            await saveSettingsGroup(allKeys, 'All System Settings');\r\n        }\r\n\r\n        async function saveRestaurantProfile() {\r\n            // Restaurant profile - save these as system settings too\r\n            const profileKeys = ['restaurant_name', 'restaurant_address', 'restaurant_contact', 'restaurant_tin'];\r\n            const profileValues = {\r\n                restaurant_name: document.getElementById('restName')?.value || '',\r\n                restaurant_address: document.getElementById('restAddress')?.value || '',\r\n                restaurant_contact: document.getElementById('restContact')?.value || '',\r\n                restaurant_tin: document.getElementById('restTin')?.value || ''\r\n            };\r\n\r\n            showSettingsLoading('Saving profile...');\r\n            try {\r\n                for (const key of profileKeys) {\r\n                    await systemSettingsDB.edit({ key: key, value: profileValues[key], updated_at: new Date().toISOString() });\r\n                }\r\n                hideSettingsLoading();\r\n                Swal.fire({\r\n                    icon: 'success',\r\n                    title: 'Profile Saved',\r\n                    text: 'Restaurant profile updated successfully.',\r\n                    timer: 2000,\r\n                    showConfirmButton: false\r\n                });\r\n                if (typeof logAdminActivity === 'function') {\r\n                    const restName = profileValues.restaurant_name || 'Unknown';\r\n                    logAdminActivity('Updated Restaurant Profile', `Name: ${restName}`, 'Success');\r\n                }\r\n            } catch (err) {\r\n                hideSettingsLoading();\r\n                console.error('Failed to save profile:', err);\r\n                Swal.fire('Error', 'Failed to save profile.', 'error');\r\n            }\r\n        }\r\n    </script>\r\n</body>\r\n\r\n</html>"
        }
    ]
}