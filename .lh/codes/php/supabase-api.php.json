{
    "sourceFile": "codes/php/supabase-api.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1771856401123,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1771856401123,
            "name": "Commit-0",
            "content": "<?php\r\n/**\r\n * Supabase REST API Helper\r\n * Provides functions to interact with Supabase without direct PostgreSQL\r\n */\r\n\r\nclass SupabaseAPI {\r\n    private $projectUrl = 'https://kpuyiaadnirvnvzjugqz.supabase.co';\r\n    private $anonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwdXlpYWFkbmlydm52emp1Z3F6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MjU1NzAsImV4cCI6MjA4NzQwMTU3MH0.BdeFCxm3m4s_EgIJ8GVbBMzGIM8sWIy6FZwprA87aUc';\r\n\r\n    /**\r\n     * Make a REST API request to Supabase\r\n     */\r\n    private function request($method, $table, $query = null, $data = null) {\r\n        $url = $this->projectUrl . '/rest/v1/' . $table;\r\n        \r\n        if ($query) {\r\n            $url .= '?' . http_build_query($query);\r\n        }\r\n\r\n        $ch = curl_init($url);\r\n        $headers = [\r\n            'Authorization: Bearer ' . $this->anonKey,\r\n            'Content-Type: application/json',\r\n            'apikey: ' . $this->anonKey,\r\n            'Prefer: return=representation'\r\n        ];\r\n\r\n        curl_setopt_array($ch, [\r\n            CURLOPT_RETURNTRANSFER => true,\r\n            CURLOPT_SSL_VERIFYPEER => false,\r\n            CURLOPT_SSL_VERIFYHOST => false,\r\n            CURLOPT_TIMEOUT => 10,\r\n            CURLOPT_CUSTOMREQUEST => $method,\r\n            CURLOPT_HTTPHEADER => $headers\r\n        ]);\r\n\r\n        if ($data !== null) {\r\n            curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));\r\n        }\r\n\r\n        $response = curl_exec($ch);\r\n        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\r\n        $error = curl_error($ch);\r\n        curl_close($ch);\r\n\r\n        if ($error) {\r\n            error_log(\"Supabase API Error: \" . $error);\r\n            return ['error' => $error];\r\n        }\r\n\r\n        if ($response === false || $response === '') {\r\n            return $httpCode === 200 || $httpCode === 201 ? [] : ['error' => \"HTTP $httpCode\"];\r\n        }\r\n\r\n        $decoded = json_decode($response, true);\r\n        return $decoded ?? ['error' => 'Invalid response'];\r\n    }\r\n\r\n    /**\r\n     * SELECT query\r\n     */\r\n    public function select($table, $filters = []) {\r\n        $query = [];\r\n        foreach ($filters as $key => $value) {\r\n            $query[$key] = $value;\r\n        }\r\n        $query['limit'] = 1000;\r\n        return $this->request('GET', $table, $query);\r\n    }\r\n\r\n    /**\r\n     * INSERT query\r\n     */\r\n    public function insert($table, $data) {\r\n        return $this->request('POST', $table, null, $data);\r\n    }\r\n\r\n    /**\r\n     * UPDATE query\r\n     */\r\n    public function update($table, $data, $filters = []) {\r\n        $query = [];\r\n        foreach ($filters as $key => $value) {\r\n            $query[$key] = $value;\r\n        }\r\n        return $this->request('PATCH', $table, $query, $data);\r\n    }\r\n\r\n    /**\r\n     * DELETE query\r\n     */\r\n    public function delete($table, $filters = []) {\r\n        $query = [];\r\n        foreach ($filters as $key => $value) {\r\n            $query[$key] = $value;\r\n        }\r\n        return $this->request('DELETE', $table, $query);\r\n    }\r\n\r\n    /**\r\n     * Get user with role information\r\n     */\r\n    public function getUserWithRole($username) {\r\n        $result = $this->select('users', ['username' => 'eq.' . $username]);\r\n        if (is_array($result) && count($result) > 0) {\r\n            $user = $result[0];\r\n            // Get role info if role_id exists\r\n            if (isset($user['role_id'])) {\r\n                $roles = $this->select('roles', ['id' => 'eq.' . $user['role_id']]);\r\n                if (is_array($roles) && count($roles) > 0) {\r\n                    $user['role_name'] = $roles[0]['name'] ?? 'unknown';\r\n                }\r\n            }\r\n            return $user;\r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\n$supabase = new SupabaseAPI();\r\n?>\r\n"
        }
    ]
}