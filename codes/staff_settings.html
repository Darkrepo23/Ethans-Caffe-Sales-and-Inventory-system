<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Ethan's Cafe Restaurant</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Common CSS -->
    <link rel="stylesheet" href="common.css">
    
    <style>
        .settings-tabs {
            margin-bottom: 30px;
        }
        
        .settings-tab {
            padding: 15px 30px;
            background: var(--white);
            border: 2px solid #dee2e6;
            border-radius: 10px 10px 0 0;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 5px;
        }
        
        .settings-tab:hover {
            background: #f8f9fa;
            color: var(--maroon);
        }
        
        .settings-tab.active {
            background: var(--maroon);
            color: var(--white);
            border-color: var(--maroon);
        }
        
        .settings-content {
            background: var(--white);
            border-radius: 0 10px 10px 10px;
            padding: 30px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            border: 2px solid #dee2e6;
            border-top: none;
        }
        
        .account-info {
            background: linear-gradient(135deg, rgba(128,0,0,0.05) 0%, rgba(74,144,226,0.05) 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #dee2e6;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 600;
            color: var(--maroon);
        }
        
        .info-value {
            color: var(--gray);
        }
        
        .password-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .activity-log {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .log-item {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            transition: all 0.3s ease;
        }
        
        .log-item:hover {
            background-color: #f8f9fa;
        }
        
        .log-item:last-child {
            border-bottom: none;
        }
        
        .log-time {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .log-action {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .log-reference {
            font-size: 0.9rem;
            color: var(--light-blue);
        }
        
        .log-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--green);
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="staff_dashboard.html">
                <i class="fas fa-utensils"></i>
                ETHAN'S CAFE RESTAURANT
            </a>
            
            <button class="navbar-toggler" type="button" onclick="toggleSidebar()">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="staff_dashboard.html">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_menu.html">
                            <i class="fas fa-utensils"></i> Record Sale
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_receipt.html">
                            <i class="fas fa-receipt"></i> Receipt
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_ingredients.html">
                            <i class="fas fa-carrot"></i> Ingredients
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_reports.html">
                            <i class="fas fa-chart-bar"></i> Reports
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle"></i> 
                            <span id="userName">Loading...</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="staff_settings.html">
                                <i class="fas fa-cog me-2"></i>Settings
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid" style="display: flex; flex-direction: column; align-items: center;">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-2 col-md-3  d-lg-none sidebar" id="sidebar">
                <a href="staff_dashboard.html" class="sidebar-item">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="staff_menu.html" class="sidebar-item">
                    <i class="fas fa-utensils"></i> Record Sale
                </a>
                <a href="staff_receipt.html" class="sidebar-item">
                    <i class="fas fa-receipt"></i> Receipt
                </a>
                <a href="staff_ingredients.html" class="sidebar-item">
                    <i class="fas fa-carrot"></i> Ingredients
                </a>
                <a href="staff_reports.html" class="sidebar-item">
                    <i class="fas fa-chart-bar"></i> Reports
                </a>
                <a href="staff_settings.html" class="sidebar-item active">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-10 col-md-9 main-content">
                <!-- Page Header -->
                <div class="page-header mb-4">
                    <h2>
                        <i class="fas fa-cog me-2"></i>Settings
                    </h2>
                    <p class="page-description">Personal access control and activity log</p>
                </div>
                
                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <div class="d-flex">
                        <div class="settings-tab active" onclick="showTab('account')">
                            <i class="fas fa-user-circle me-2"></i>Account
                        </div>
                        <div class="settings-tab" onclick="showTab('activity')">
                            <i class="fas fa-history me-2"></i>Activity Log
                        </div>
                    </div>
                </div>
                
                <!-- Account Tab -->
                <div class="settings-content" id="accountTab">
                    <div class="account-info">
                        <h5 class="mb-3">
                            <i class="fas fa-user me-2"></i>
                            Account Information
                        </h5>
                        <div class="info-item">
                            <span class="info-label">Staff Name:</span>
                            <span class="info-value" id="staffNameDisplay">John Smith</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Username:</span>
                            <span class="info-value" id="usernameDisplay">johnsmith</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Role:</span>
                            <span class="info-value" id="roleDisplay">Staff</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Account Status:</span>
                            <span class="info-value text-success">Active</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Last Login:</span>
                            <span class="info-value" id="lastLoginDisplay">Today, 09:30 AM</span>
                        </div>
                    </div>
                    
                    <!-- Change Password Form -->
                    <div>
                        <h5 class="mb-3">
                            <i class="fas fa-key me-2"></i>
                            Change Password
                        </h5>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Staff cannot reset passwords themselves. Contact owner/admin for password reset requests.
                        </div>
                        
                        <form class="password-form" id="passwordForm">
                            <div class="mb-3">
                                <label class="form-label">Current Password</label>
                                <div class="input-group">
                                    <input type="password" 
                                           class="form-control" 
                                           id="currentPassword"
                                           required
                                           disabled>
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('currentPassword')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">New Password</label>
                                <div class="input-group">
                                    <input type="password" 
                                           class="form-control" 
                                           id="newPassword"
                                           required
                                           disabled>
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="form-text">
                                    Password must be at least 8 characters long
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label">Confirm New Password</label>
                                <div class="input-group">
                                    <input type="password" 
                                           class="form-control" 
                                           id="confirmPassword"
                                           required
                                           disabled>
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmPassword')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-maroon" disabled>
                                    <i class="fas fa-save me-2"></i>Change Password
                                </button>
                                <button type="button" class="btn btn-outline-maroon" onclick="requestPasswordReset()">
                                    <i class="fas fa-question-circle me-2"></i>Request Password Reset
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Logout Button -->
                    <div class="mt-5 pt-4 border-top">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Session Management</h6>
                                <p class="text-muted small mb-0">Auto-logout after 30 minutes of inactivity</p>
                            </div>
                            <button class="btn btn-danger" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Log Tab -->
                <div class="settings-content" id="activityTab" style="display: none;">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Transparency & Accountability:</strong> This log shows ONLY actions done by you (logged-in staff).
                    </div>
                    
                    <!-- Activity Log Filters -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Filter by Date</label>
                            <input type="date" class="form-control" id="logDateFilter" value="2024-01-29">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Filter by Action</label>
                            <select class="form-select" id="logActionFilter">
                                <option value="all">All Actions</option>
                                <option value="sale">Recorded Sale</option>
                                <option value="receipt">Printed Receipt</option>
                                <option value="ingredient">Updated Ingredient</option>
                                <option value="login">Login/Logout</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Activity Log -->
                    <div class="activity-log">
                        <div class="log-item">
                            <div class="log-time">Today, 14:30</div>
                            <div class="log-action">Recorded Sale</div>
                            <div class="log-reference">Order #00123 - 2x Margherita Pizza</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                        
                        <div class="log-item">
                            <div class="log-time">Today, 14:25</div>
                            <div class="log-action">Printed Receipt</div>
                            <div class="log-reference">Receipt #00123</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                        
                        <div class="log-item">
                            <div class="log-time">Today, 13:45</div>
                            <div class="log-action">Updated Ingredient Quantity</div>
                            <div class="log-reference">Chicken Breast +5 kg (Delivery)</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                        
                        <div class="log-item">
                            <div class="log-time">Today, 13:30</div>
                            <div class="log-action">Recorded Sale</div>
                            <div class="log-reference">Order #00122 - 1x Spaghetti Carbonara</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                        
                        <div class="log-item">
                            <div class="log-time">Today, 12:15</div>
                            <div class="log-action">Updated Ingredient Quantity</div>
                            <div class="log-reference">Basil Leaves -50 g (Wastage)</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                        
                        <div class="log-item">
                            <div class="log-time">Today, 11:30</div>
                            <div class="log-action">Printed Report</div>
                            <div class="log-reference">Daily Sales Report</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                        
                        <div class="log-item">
                            <div class="log-time">Today, 09:30</div>
                            <div class="log-action">Logged In</div>
                            <div class="log-reference">System Login</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                        
                        <div class="log-item">
                            <div class="log-time">Yesterday, 18:00</div>
                            <div class="log-action">Logged Out</div>
                            <div class="log-reference">System Logout</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                        
                        <div class="log-item">
                            <div class="log-time">Yesterday, 17:45</div>
                            <div class="log-action">Recorded Sale</div>
                            <div class="log-reference">Order #00118 - 3x Classic Burger</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                        
                        <div class="log-item">
                            <div class="log-time">Yesterday, 16:30</div>
                            <div class="log-action">Updated Ingredient Quantity</div>
                            <div class="log-reference">Mozzarella Cheese +3 kg (Delivery)</div>
                            <div class="log-status status-success">Success</div>
                        </div>
                    </div>
                    
                    <!-- Activity Log Information -->
                    <div class="mt-4 pt-3 border-top">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>What Staff CANNOT See or Do:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Other staff activity</li>
                                <li>Owner/admin actions</li>
                                <li>System configuration logs</li>
                                <li>Edit or delete logs</li>
                                <li>Filter logs by other users</li>
                            </ul>
                        </div>
                        <p class="text-muted small mb-0">
                            <i class="fas fa-lock me-1"></i>
                            Read-only access • Own activity only • No deletion
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check login
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user || !user.loggedIn) {
                window.location.href = 'index.html';
                return;
            }
            
            // Update user name
            document.getElementById('userName').textContent = user.name || user.username;
            
            // Update account information
            updateAccountInfo(user);
            
            // Set today's date for log filter
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('logDateFilter').value = today;
            
            // Setup event listeners
            setupEventListeners();
        });
        
        // Update account information
        function updateAccountInfo(user) {
            document.getElementById('staffNameDisplay').textContent = user.name || 'Not Set';
            document.getElementById('usernameDisplay').textContent = user.username || 'Not Set';
            document.getElementById('roleDisplay').textContent = user.role ? user.role.charAt(0).toUpperCase() + user.role.slice(1) : 'Not Set';
            
            // Set last login time
            const now = new Date();
            const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('lastLoginDisplay').textContent = `Today, ${timeStr}`;
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Password form submission
            document.getElementById('passwordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // In a real system, this would make an API call
                // For now, just show a message
                showToast('Password change request submitted to owner/admin', 'info');
            });
            
            // Log filter changes
            document.getElementById('logDateFilter').addEventListener('change', filterLogs);
            document.getElementById('logActionFilter').addEventListener('change', filterLogs);
        }
        
        // Show tab
        function showTab(tabName) {
            // Update tabs
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Show tab content
            document.getElementById('accountTab').style.display = 'none';
            document.getElementById('activityTab').style.display = 'none';
            document.getElementById(`${tabName}Tab`).style.display = 'block';
        }
        
        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = event.target.closest('button');
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // Request password reset
        function requestPasswordReset() {
            const modalHTML = `
                <div class="modal fade" id="passwordResetModal" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header bg-light-blue text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-key me-2"></i>
                                    Password Reset Request
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Staff cannot reset passwords themselves. This will send a request to the owner/admin.
                                </div>
                                <form id="resetRequestForm">
                                    <div class="mb-3">
                                        <label class="form-label">Reason for Reset</label>
                                        <textarea class="form-control" rows="3" placeholder="Explain why you need a password reset"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Contact Method</label>
                                        <select class="form-select">
                                            <option>Email notification to owner</option>
                                            <option>System notification only</option>
                                        </select>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-maroon" onclick="submitResetRequest()">Submit Request</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            if (!document.getElementById('passwordResetModal')) {
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            }
            
            const modal = new bootstrap.Modal(document.getElementById('passwordResetModal'));
            modal.show();
        }
        
        // Submit reset request
        function submitResetRequest() {
            const modal = bootstrap.Modal.getInstance(document.getElementById('passwordResetModal'));
            modal.hide();
            
            showToast('Password reset request submitted to owner/admin', 'success');
        }
        
        // Filter activity logs
        function filterLogs() {
            const dateFilter = document.getElementById('logDateFilter').value;
            const actionFilter = document.getElementById('logActionFilter').value;
            
            // In a real system, this would make an API call
            // For now, just show a message
            showToast(`Filtering logs for ${dateFilter} - ${actionFilter}`, 'info');
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container') || createToastContainer();
            const toastId = 'toast-' + Date.now();
            
            const icon = type === 'success' ? 'fa-check-circle' :
                         type === 'warning' ? 'fa-exclamation-triangle' :
                         type === 'error' ? 'fa-times-circle' : 'fa-info-circle';
            
            const color = type === 'success' ? 'green' :
                          type === 'warning' ? 'warning' :
                          type === 'error' ? 'danger' : 'light-blue';
            
            const toastHTML = `
                <div class="toast" id="${toastId}" role="alert">
                    <div class="toast-header">
                        <i class="fas ${icon} text-${color} me-2"></i>
                        <strong class="me-auto">System Message</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">${message}</div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
            
            // Remove toast after it hides
            toastElement.addEventListener('hidden.bs.toast', function() {
                this.remove();
            });
        }
        
        // Create toast container if not exists
        function createToastContainer() {
            const container = document.createElement('div');
            container.className = 'toast-container';
            document.body.appendChild(container);
            return container;
        }
        
        // Toggle sidebar on mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }
        
        // Logout function
        function logout() {
            // Add logout activity
            const user = JSON.parse(localStorage.getItem('user'));
            if (user) {
                // In a real system, this would log the logout activity
                console.log(`User ${user.username} logged out`);
            }
            
            // Clear user data
            localStorage.removeItem('user');
            
            // Redirect to login page
            window.location.href = 'index.html?logout=true';
        }
    </script>
</body>
</html>