<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt - Ethan's Cafe Restaurant</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Common CSS -->
    <link rel="stylesheet" href="common.css">

    <style>
        .receipt-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 30px;
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 3px solid var(--maroon);
        }

        .receipt-header {
            text-align: center;
            padding-bottom: 20px;
            margin-bottom: 30px;
            border-bottom: 3px dashed var(--maroon);
        }

        .receipt-restaurant {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--maroon);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .receipt-tagline {
            color: var(--gray);
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .receipt-details {
            margin-bottom: 30px;
        }

        .receipt-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #dee2e6;
        }

        .receipt-items {
            margin-bottom: 30px;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .receipt-item-name {
            font-weight: 600;
        }

        .receipt-item-qty {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .receipt-total {
            background: linear-gradient(135deg, rgba(128, 0, 0, 0.05) 0%, rgba(74, 144, 226, 0.05) 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            text-align: center;
        }

        .receipt-footer {
            text-align: center;
            padding-top: 20px;
            border-top: 3px dashed var(--maroon);
            color: var(--gray);
            font-size: 0.9rem;
        }

        .receipt-actions {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        @media print {
            .no-print {
                display: none !important;
            }

            .receipt-container {
                box-shadow: none;
                border: 2px solid #000;
                max-width: 100%;
                padding: 20px;
            }

            body {
                background: white !important;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark no-print">
        <div class="container-fluid">
            <a class="navbar-brand" href="staff_dashboard.html">
                <i class="fas fa-utensils"></i>
                ETHAN'S CAFE RESTAURANT
            </a>

            <button class="navbar-toggler" type="button" onclick="toggleSidebar()">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="staff_dashboard.html">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_menu.html">
                            <i class="fas fa-utensils"></i> Record Sale
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="staff_receipt.html">
                            <i class="fas fa-receipt"></i> Receipt
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_ingredients.html">
                            <i class="fas fa-carrot"></i> Ingredients
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_reports.html">
                            <i class="fas fa-chart-bar"></i> Reports
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle"></i>
                            <span id="userName">Loading...</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="staff_settings.html">
                                    <i class="fas fa-cog me-2"></i>Settings
                                </a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="logout()">
                                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                                </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-2 col-md-3 sidebar no-print" id="sidebar">
                <a href="staff_dashboard.html" class="sidebar-item">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="staff_menu.html" class="sidebar-item">
                    <i class="fas fa-utensils"></i> Record Sale
                </a>
                <a href="staff_receipt.html" class="sidebar-item active">
                    <i class="fas fa-receipt"></i> Receipt
                </a>
                <a href="staff_ingredients.html" class="sidebar-item">
                    <i class="fas fa-carrot"></i> Ingredients
                </a>
                <a href="staff_reports.html" class="sidebar-item">
                    <i class="fas fa-chart-bar"></i> Reports
                </a>
                <a href="staff_settings.html" class="sidebar-item">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </div>

            <!-- Main Content -->
            <div class="col-lg-10 col-md-9 main-content">
                <!-- Page Header -->
                <div class="page-header mb-4">
                    <h2>
                        <i class="fas fa-receipt me-2"></i>Receipt
                    </h2>
                    <p class="page-description">Proof of order (not payment)</p>
                </div>

                <!-- Alert Messages -->
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Note:</strong> This receipt is for order confirmation only. Payment is handled outside the
                    system.
                </div>

                <div class="row">
                    <div class="col-lg-8">
                        <!-- Receipt Preview -->
                        <div class="receipt-container" id="receiptPrint">
                            <div class="receipt-header">
                                <div class="receipt-restaurant">ETHAN'S CAFE</div>
                                <div class="receipt-tagline">Quality Food & Excellent Service</div>
                                <div>123 Restaurant Street, Food City 12345</div>
                                <div>Contact: (123) 456-7890 | www.ethanscafe.com</div>
                            </div>

                            <div class="receipt-details">
                                <div class="receipt-detail-row">
                                    <span>Order Number:</span>
                                    <span id="receiptOrderNumber" class="fw-bold">#00123</span>
                                </div>
                                <div class="receipt-detail-row">
                                    <span>Date & Time:</span>
                                    <span id="receiptDateTime">2024-01-29 14:30:45</span>
                                </div>
                                <div class="receipt-detail-row">
                                    <span>Staff Name:</span>
                                    <span id="receiptStaffName">John Smith</span>
                                </div>
                                <div class="receipt-detail-row">
                                    <span>Order Type:</span>
                                    <span>Dine-in</span>
                                </div>
                            </div>

                            <div class="receipt-items">
                                <div class="receipt-item">
                                    <div class="receipt-item-name">Margherita Pizza</div>
                                    <div>
                                        <span class="receipt-item-qty">x2</span>
                                        <span class="ms-3">---</span>
                                    </div>
                                </div>
                                <div class="receipt-item">
                                    <div class="receipt-item-name">Spaghetti Carbonara</div>
                                    <div>
                                        <span class="receipt-item-qty">x1</span>
                                        <span class="ms-3">---</span>
                                    </div>
                                </div>
                                <div class="receipt-item">
                                    <div class="receipt-item-name">Caesar Salad</div>
                                    <div>
                                        <span class="receipt-item-qty">x1</span>
                                        <span class="ms-3">---</span>
                                    </div>
                                </div>
                                <div class="receipt-item">
                                    <div class="receipt-item-name">Fresh Lemonade</div>
                                    <div>
                                        <span class="receipt-item-qty">x2</span>
                                        <span class="ms-3">---</span>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <h4>Total:</h4>
                                <h3 id="TotalPrice">00.0</h3>
                            </div>

                            <!-- Confirm Order Button -->
                            <button id="confirmOrderBtn" class="btn btn-success mb-3"
                                style="width: 100%; height: 3rem;">Confirm Order</button>

                            <!-- Receipt Total Section -->
                            <div class="receipt-total d-none" id="receiptTotal">
                                <h4 class="mb-0">ORDER CONFIRMED</h4>
                                <p class="text-muted mb-0 mt-2" id="totalItems">Total Items: 0</p>
                            </div>


                            <div class="receipt-footer">
                                <p class="mb-2">Thank you for dining with us!</p>
                                <p class="mb-0 small">* This receipt is for order confirmation only</p>
                                <p class="mb-0 small">* Payment handled outside the system</p>
                                <p class="mb-0 small">* Please present this receipt for any inquiries</p>
                            </div>
                        </div>

                        <!-- Receipt Actions -->
                        <div class="receipt-actions no-print">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <button class="btn btn-maroon w-100 py-3" onclick="printReceipt()">
                                        <i class="fas fa-print me-2"></i>Print Receipt
                                    </button>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <button class="btn btn-light-blue w-100 py-3" onclick="startNewSale()">
                                        <i class="fas fa-plus me-2"></i>Add more
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <!-- Recent Receipts -->
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-history me-2"></i>
                                    Recent Receipts
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="list-group">
                                    <a href="#"
                                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="fw-bold">#00122</div>
                                            <small class="text-muted">Today, 13:45</small>
                                        </div>
                                        <span class="badge bg-maroon">4 items</span>
                                    </a>
                                    <a href="#"
                                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="fw-bold">#00121</div>
                                            <small class="text-muted">Today, 12:30</small>
                                        </div>
                                        <span class="badge bg-maroon">2 items</span>
                                    </a>
                                    <a href="#"
                                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="fw-bold">#00120</div>
                                            <small class="text-muted">Today, 11:15</small>
                                        </div>
                                        <span class="badge bg-maroon">3 items</span>
                                    </a>
                                    <a href="#"
                                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="fw-bold">#00119</div>
                                            <small class="text-muted">Today, 10:00</small>
                                        </div>
                                        <span class="badge bg-maroon">5 items</span>
                                    </a>
                                    <a href="#"
                                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="fw-bold">#00118</div>
                                            <small class="text-muted">Yesterday, 18:30</small>
                                        </div>
                                        <span class="badge bg-maroon">6 items</span>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Receipt Information -->
                        <div class="card mt-4">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Receipt Information
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Important:</strong> Receipt contains:
                                </div>
                                <ul class="mb-0">
                                    <li>Order number</li>
                                    <li>Date & time</li>
                                    <li>Menu item(s) & quantity</li>
                                    <li>Staff name</li>
                                    <li>Thank-you message</li>
                                </ul>
                                <hr>
                                <p class="small text-muted mb-0">
                                    <i class="fas fa-hand-point-right me-1"></i>
                                    No payment processing in the system
                                </p>
                                <p class="small text-muted mb-0">
                                    <i class="fas fa-hand-point-right me-1"></i>
                                    No cart or checkout system
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Check login
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user || !user.loggedIn) {
                window.location.href = 'index.html';
                return;
            }

            // Update user name
            document.getElementById('userName').textContent = user.name || user.username;
            document.getElementById('receiptStaffName').textContent = user.name || user.username;

            // Update receipt date and order number from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('item') && urlParams.has('qty')) {
                updateReceiptWithItem(urlParams.get('item'), urlParams.get('qty'));
            }

            // Update receipt date
            updateReceiptDate();
        });

        // Update receipt date
        function updateReceiptDate() {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const timeStr = now.toTimeString().split(' ')[0];
            document.getElementById('receiptDateTime').textContent = `${dateStr} ${timeStr}`;

            // Generate random order number
            const orderNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            document.getElementById('receiptOrderNumber').textContent = `#${orderNum}`;
        }

        // Update receipt with item from menu page
        function updateReceiptWithItem() {
            const sales = JSON.parse(localStorage.getItem("sales")) || [];
            const itemsContainer = document.querySelector('.receipt-items');

            if (sales.length === 0) {
                itemsContainer.innerHTML = `<div class="text-muted small">No items yet</div>`;
                document.getElementById('TotalPrice').textContent = '₱0.00';
                const confirmBtn = document.getElementById('confirmOrderBtn');
                confirmBtn.classList.add('d-none')
                return;
            }

            // Build receipt HTML
            itemsContainer.innerHTML = sales.map(item => `
        <div class="receipt-item" data-id="${item.id}">
            <div class="receipt-item-name">${item.name}</div>
            <div>
                <span class="receipt-item-qty">x${item.quantity}</span>
                <span class="ms-3">₱${item.total.toLocaleString()}</span>
                <i class="fas fa-times text-danger ms-2" style="cursor:pointer;" onclick="removeReceiptItem(${item.id})"></i>
            </div>
        </div>
    `).join("");

            // Update total price
            const totalPrice = sales.reduce((sum, item) => sum + item.total, 0);
            document.getElementById('TotalPrice').textContent = `₱${totalPrice.toLocaleString()}`;
        }

        // Remove item from receipt and localStorage
        function removeReceiptItem(itemId) {
            let sales = JSON.parse(localStorage.getItem("sales")) || [];
            sales = sales.filter(item => item.id !== itemId);
            localStorage.setItem("sales", JSON.stringify(sales));
            updateReceiptWithItem();
            showToast('Item removed from receipt', 'warning');
        }


        updateReceiptWithItem()


        // Print receipt
        function printReceipt() {
            const receiptElement = document.getElementById('receiptPrint');
            const originalContent = document.body.innerHTML;

            // Set body to receipt only
            document.body.innerHTML = receiptElement.outerHTML;

            // Add print styles
            const style = document.createElement('style');
            style.innerHTML = `
                @media print {
                    body {
                        margin: 0;
                        padding: 20px;
                    }
                    .receipt-container {
                        box-shadow: none;
                        border: 2px solid #000;
                        max-width: 100%;
                    }
                }
            `;
            document.head.appendChild(style);

            // Print
            window.print();

            // Restore original content
            document.body.innerHTML = originalContent;

            // Show success message
            showToast('Receipt sent to printer', 'success');
        }

        // Handle Confirm Order button click
        // Function to check order status on page load
        function checkOrderStatus() {
            const orderConfirmed = localStorage.getItem("orderConfirmed") === "true";

            const confirmBtn = document.getElementById('confirmOrderBtn');
            const receiptTotal = document.getElementById('receiptTotal');

            if (orderConfirmed) {
                // Hide the confirm button
                confirmBtn.classList.add('d-none');

                // Show receipt total
                receiptTotal.classList.remove('d-none');

                // Update total items
                const sales = JSON.parse(localStorage.getItem("sales")) || [];
                const totalItems = sales.reduce((sum, item) => sum + item.quantity, 0);
                document.getElementById('totalItems').textContent = `Total Items: ${totalItems}`;
            }
        }

        // Call on page load
        checkOrderStatus();

        // Handle Confirm Order button click
        document.getElementById('confirmOrderBtn').addEventListener('click', () => {
            const sales = JSON.parse(localStorage.getItem("sales")) || [];
            if (sales.length === 0) {
                showToast('No items in the receipt!', 'warning');
                return;
            }

            // Calculate total items
            const totalItems = sales.reduce((sum, item) => sum + item.quantity, 0);

            // Show receipt total section
            const receiptTotal = document.getElementById('receiptTotal');
            receiptTotal.classList.remove('d-none');
            document.getElementById('totalItems').textContent = `Total Items: ${totalItems}`;

            // Hide the confirm button
            document.getElementById('confirmOrderBtn').classList.add('d-none');

            // Store order confirmed flag in localStorage
            localStorage.setItem("orderConfirmed", "true");

            // Hide all delete/remove icons
            const removeIcons = document.querySelectorAll('.receipt-item .fa-times');
            removeIcons.forEach(icon => {
                icon.style.display = 'none';
            });

            showToast('Order confirmed successfully!', 'success');
        });

        localStorage.setItem("orderConfirmed", "false");



        // Start new sale
        function startNewSale() {
            window.location.href = 'staff_menu.html';
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container') || createToastContainer();
            const toastId = 'toast-' + Date.now();

            const icon = type === 'success' ? 'fa-check-circle' :
                type === 'warning' ? 'fa-exclamation-triangle' :
                    type === 'error' ? 'fa-times-circle' : 'fa-info-circle';

            const color = type === 'success' ? 'green' :
                type === 'warning' ? 'warning' :
                    type === 'error' ? 'danger' : 'light-blue';

            const toastHTML = `
                <div class="toast" id="${toastId}" role="alert">
                    <div class="toast-header">
                        <i class="fas ${icon} text-${color} me-2"></i>
                        <strong class="me-auto">System Message</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">${message}</div>
                </div>
            `;

            toastContainer.insertAdjacentHTML('beforeend', toastHTML);

            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();

            // Remove toast after it hides
            toastElement.addEventListener('hidden.bs.toast', function () {
                this.remove();
            });
        }

        // Create toast container if not exists
        function createToastContainer() {
            const container = document.createElement('div');
            container.className = 'toast-container';
            document.body.appendChild(container);
            return container;
        }

        // Toggle sidebar on mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }

        // Logout function
        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'index.html?logout=true';
        }
    </script>
</body>

</html>