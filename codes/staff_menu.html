<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record Sale - Ethan's Cafe Restaurant</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Common CSS -->
    <link rel="stylesheet" href="common.css">

    <style>
        .menu-category-filter {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .category-btn {
            padding: 10px 20px;
            margin: 5px;
            border: 2px solid var(--maroon);
            border-radius: 25px;
            background: var(--white);
            color: var(--maroon);
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .category-btn:hover,
        .category-btn.active {
            background: var(--maroon);
            color: var(--white);
            transform: translateY(-3px);
        }

        .selected-item-display {
            background: linear-gradient(135deg, rgba(128, 0, 0, 0.05) 0%, rgba(74, 144, 226, 0.05) 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px dashed var(--light-blue);
        }

        .receipt-preview {
            background: white;
            border: 3px solid var(--maroon);
            border-radius: 12px;
            padding: 25px;
            font-family: 'Courier New', monospace;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            max-height: 400px;
            overflow-y: auto;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px dashed var(--maroon);
        }

        .receipt-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--maroon);
            margin-bottom: 5px;
        }

        .receipt-items {
            margin-bottom: 20px;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #dee2e6;
        }

        .receipt-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dashed var(--maroon);
            color: var(--gray);
            font-size: 0.9rem;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .qty-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--maroon);
            background: white;
            color: var(--maroon);
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .qty-btn:hover {
            background: var(--maroon);
            color: white;
            transform: scale(1.1);
        }

        .qty-input {
            width: 80px;
            text-align: center;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--maroon);
            border: 3px solid var(--maroon);
            border-radius: 10px;
            padding: 10px;
        }

        .menu-item-img {
            height: 180px;
            object-fit: cover;
            width: 100%;
            border-radius: 8px 8px 0 0;
            transition: transform 0.5s ease;
        }

        .menu-item-card {
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .menu-item-card:hover {
            transform: translateY(-10px);
            border-color: var(--light-blue);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .menu-item-card.selected {
            border-color: var(--green);
            box-shadow: 0 15px 30px rgba(40, 167, 69, 0.3);
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="staff_dashboard.html">
                <i class="fas fa-utensils"></i>
                ETHAN'S CAFE RESTAURANT
            </a>

            <button class="navbar-toggler" type="button" onclick="toggleSidebar()">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="staff_dashboard.html">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="staff_menu.html">
                            <i class="fas fa-utensils"></i> Record Sale
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_receipt.html">
                            <i class="fas fa-receipt"></i> Receipt
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_ingredients.html">
                            <i class="fas fa-carrot"></i> Ingredients
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="staff_reports.html">
                            <i class="fas fa-chart-bar"></i> Reports
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle"></i>
                            <span id="userName">Loading...</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="staff_settings.html">
                                    <i class="fas fa-cog me-2"></i>Settings
                                </a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="logout()">
                                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                                </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-2 col-md-3 sidebar" id="sidebar">
                <a href="staff_dashboard.html" class="sidebar-item">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="staff_menu.html" class="sidebar-item active">
                    <i class="fas fa-utensils"></i> Record Sale
                </a>
                <a href="staff_receipt.html" class="sidebar-item">
                    <i class="fas fa-receipt"></i> Receipt
                </a>
                <a href="staff_ingredients.html" class="sidebar-item">
                    <i class="fas fa-carrot"></i> Ingredients
                </a>
                <a href="staff_reports.html" class="sidebar-item">
                    <i class="fas fa-chart-bar"></i> Reports
                </a>
                <a href="staff_settings.html" class="sidebar-item">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </div>

            <!-- Main Content -->
            <div class="col-lg-10 col-md-9 main-content">
                <!-- Page Header -->
                <div class="page-header mb-4">
                    <h2>
                        <i class="fas fa-utensils me-2"></i>Record Sale
                    </h2>
                    <p class="page-description">Select menu items and enter quantity to record a sale</p>
                </div>

                <!-- Alert Messages -->
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>System Actions (Automatic):</strong> When you record a sale, the system will automatically:
                    <ul class="mb-0 mt-2">
                        <li>Save the sales entry</li>
                        <li>Deduct ingredients based on recipe</li>
                        <li>Update inventory levels</li>
                        <li>Generate receipt preview</li>
                    </ul>
                </div>

                <div class="row">
                    <!-- Menu Items Section -->
                    <div class="col-lg-8 mb-4">
                        <!-- Category Filter -->
                        <div class="menu-category-filter">
                            <h5 class="mb-3">
                                <i class="fas fa-filter me-2"></i>
                                Filter by Category
                            </h5>
                            <div class="category-buttons">
                                <button class="category-btn active" data-category="all">All Items</button>
                                <button class="category-btn" data-category="pizza">
                                    <i class="fas fa-pizza-slice me-1"></i>Pizza
                                </button>
                                <button class="category-btn" data-category="pasta">
                                    <i class="fas fa-pasta me-1"></i>Pasta
                                </button>
                                <button class="category-btn" data-category="burger">
                                    <i class="fas fa-hamburger me-1"></i>Burgers
                                </button>
                                <button class="category-btn" data-category="salad">
                                    <i class="fas fa-leaf me-1"></i>Salads
                                </button>
                                <button class="category-btn" data-category="dessert">
                                    <i class="fas fa-ice-cream me-1"></i>Desserts
                                </button>
                                <button class="category-btn" data-category="drink">
                                    <i class="fas fa-glass-whiskey me-1"></i>Drinks
                                </button>
                            </div>
                        </div>

                        <!-- Menu Items Grid -->
                        <div class="row" id="menuItemsGrid">
                            <!-- Menu items will be loaded dynamically -->
                        </div>
                    </div>

                    <!-- Sale Summary Section -->
                    <div class="col-lg-4 mb-4">
                        <div class="card h-100" style="position: sticky; top: 100px;">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-shopping-cart me-2"></i>
                                    Sale Summary
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- Selected Item Display -->
                                <div id="selectedItemDisplay" class="selected-item-display text-center">
                                    <i class="fas fa-utensils fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">No Item Selected</h5>
                                    <p class="text-muted small">Select a menu item to record sale</p>
                                </div>

                                <!-- Quantity Controls -->
                                <div class="quantity-controls" id="quantityControls" style="display: none;">
                                    <button class="qty-btn" onclick="adjustQuantity(-1)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" id="quantityInput" class="qty-input" value="1" min="1"
                                        max="99">
                                    <button class="qty-btn" onclick="adjustQuantity(1)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>

                                <!-- Action Buttons -->
                                <div class="d-grid gap-2 mt-4">
                                    <button class="btn btn-maroon btn-lg" onclick="recordSale()" id="recordSaleBtn"
                                        disabled>
                                        <i class="fas fa-save me-2"></i>Add to receipt
                                    </button>
                                    <button class="btn btn-outline-maroon" onclick="clearSelection()">
                                        <i class="fas fa-times me-2"></i>Clear Selection
                                    </button>
                                </div>

                                <!-- Receipt Preview -->
                                <div class="mt-4">
                                    <h6 class="mb-3">
                                        <i class="fas fa-receipt me-2"></i>
                                        Receipt Preview
                                    </h6>
                                    <div class="receipt-preview">
                                        <div class="receipt-header" style="overflow: hidden;">
                                            <div class="receipt-title">ETHAN'S CAFE</div>
                                            <div>Order #<span id="orderNumber">00123</span></div>
                                            <div><span id="receiptDate">2024-01-29 14:30</span></div>
                                            <div>Staff: <span id="staffName">John Smith</span></div>
                                        </div>
                                        <div class="receipt-items" id="receiptItems" style="overflow: auto;">
                                            <!-- Items will appear here -->
                                        </div>
                                        <div class="flex justify-content-between margin-auto">
                                            <small>Total:</small>
                                            <small id="TotalPrice">₱723.89</small>
                                        </div>
                                        <div class="receipt-footer">
                                            Thank you for your order!<br>
                                            <small>Payment handled outside system</small>
                                        </div>
                                    </div>
                                    <button class="btn btn-light-blue w-100 mt-3" onclick="printReceipt()">
                                        <i class="fas fa-print me-2"></i>Go to Receipt
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        const menuItems = [
            {
                id: 1,
                name: "Margherita Pizza",
                category: "pizza",
                price: 299.34,
                description: "Classic cheese pizza with fresh tomato sauce and mozzarella",
                image: "https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
                ingredients: ["Flour", "Tomato Sauce", "Mozzarella", "Basil", "Olive Oil"]
            },
            {
                id: 2,
                name: "Spaghetti Carbonara",
                category: "pasta",
                price: 249.00,
                description: "Creamy pasta with smoked bacon, eggs, and parmesan",
                image: "https://images.unsplash.com/photo-1551183053-bf91a1d81141?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                ingredients: ["Spaghetti", "Bacon", "Eggs", "Parmesan", "Black Pepper"]
            },
            {
                id: 3,
                name: "Classic Burger",
                category: "burger",
                price: 199.89,
                description: "Juicy beef patty with lettuce, tomato, and special sauce",
                image: "https://images.unsplash.com/photo-1563379926898-05f4575a45d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                ingredients: ["Beef Patty", "Burger Bun", "Lettuce", "Tomato", "Cheese", "Special Sauce"]
            },
            {
                id: 4,
                name: "Caesar Salad",
                category: "salad",
                price: 149.45,
                description: "Fresh romaine lettuce with Caesar dressing and croutons",
                image: "https://images.unsplash.com/photo-1476224203421-9ac39bcb3327?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                ingredients: ["Romaine Lettuce", "Croutons", "Parmesan", "Caesar Dressing", "Lemon"]
            },
            {
                id: 5,
                name: "Chocolate Lava Cake",
                category: "dessert",
                price: 189.74,
                description: "Warm chocolate cake with molten center, served with vanilla ice cream",
                image: "https://images.unsplash.com/photo-1572802419224-296b0aeee0d9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                ingredients: ["Chocolate", "Flour", "Butter", "Sugar", "Eggs", "Vanilla Ice Cream"]
            },
            {
                id: 6,
                name: "Pepperoni Pizza",
                category: "pizza",
                price: 329.03,
                description: "Spicy pepperoni with extra cheese on tomato sauce base",
                image: "https://images.unsplash.com/photo-1628840042765-356cda07504e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                ingredients: ["Flour", "Tomato Sauce", "Mozzarella", "Pepperoni", "Oregano"]
            },
            {
                id: 7,
                name: "Lasagna",
                category: "pasta",
                price: 289.50,
                description: "Layers of pasta with rich meat sauce and melted cheese",
                image: "https://images.unsplash.com/photo-1574894709920-11b28e7367e3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                ingredients: ["Pasta Sheets", "Ground Beef", "Tomato Sauce", "Ricotta", "Mozzarella"]
            },
            {
                id: 8,
                name: "Fresh Lemonade",
                category: "drink",
                price: 99.0,
                description: "Homemade lemonade with fresh lemons and mint",
                image: "https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                ingredients: ["Lemons", "Sugar", "Water", "Mint", "Ice"]
            }
        ];

        // Current state
        let selectedItem = null;
        let currentCategory = 'all';
        let quantity = 1;

        document.addEventListener('DOMContentLoaded', function () {
            // Check login
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user || !user.loggedIn) {
                window.location.href = 'index.html';
                return;
            }

            // Update user name
            document.getElementById('userName').textContent = user.name || user.username;
            document.getElementById('staffName').textContent = user.name || user.username;

            // Setup category filter buttons
            setupCategoryFilters();

            // Load menu items
            loadMenuItems();

            // Update receipt date
            updateReceiptDate();
        });

        updateTotalPrice(); // <-- update totals after removal

        // Setup category filter buttons
        function setupCategoryFilters() {
            const buttons = document.querySelectorAll('.category-btn');
            buttons.forEach(btn => {
                btn.addEventListener('click', function () {
                    // Remove active class from all buttons
                    buttons.forEach(b => b.classList.remove('active'));

                    // Add active class to clicked button
                    this.classList.add('active');

                    // Update current category and reload items
                    currentCategory = this.dataset.category;
                    loadMenuItems();
                });
            });
        }

        // Load menu items based on current category
        function loadMenuItems() {
            const container = document.getElementById('menuItemsGrid');
            container.innerHTML = '';

            const filteredItems = currentCategory === 'all'
                ? menuItems
                : menuItems.filter(item => item.category === currentCategory);

            if (filteredItems.length === 0) {
                container.innerHTML = `
            <div class="col-12 text-center py-5">
                <i class="fas fa-utensils fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No menu items found</h5>
                <p class="text-muted">Try selecting a different category</p>
            </div>
        `;
                return;
            }

            filteredItems.forEach(item => {
                const isSelected = selectedItem && selectedItem.id === item.id;

                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4 mb-4';

                col.innerHTML = `
            <div class="card menu-item-card h-100 ${isSelected ? 'selected' : ''}" 
                 onclick="selectMenuItem(${item.id})">
                
                <img src="${item.image}" class="menu-item-img" alt="${item.name}">
                
                <div class="card-body">
                    <h5 class="card-title text-maroon">${item.name}</h5>
                    <p class="card-text text-muted small">${item.description}</p>

                    <h6 class="mt-2 text-maroon">₱${item.price.toFixed(2)}</h6>

                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <span class="badge bg-light-blue">
                            <i class="fas fa-${getCategoryIcon(item.category)} me-1"></i>
                            ${item.category}
                        </span>
                        <small class="text-muted">
                            <i class="fas fa-carrot me-1"></i>
                            ${item.ingredients.length} ingredients
                        </small>
                    </div>
                </div>
            </div>
        `;

                container.appendChild(col);
            });
        }


        // Get category icon
        function getCategoryIcon(category) {
            const icons = {
                pizza: 'pizza-slice',
                pasta: 'pasta',
                burger: 'hamburger',
                salad: 'leaf',
                dessert: 'ice-cream',
                drink: 'glass-whiskey'
            };
            return icons[category] || 'utensils';
        }

        // Select a menu item
        function selectMenuItem(itemId) {
            selectedItem = menuItems.find(item => item.id === itemId);
            quantity = 1;

            // Update UI
            document.querySelectorAll('.menu-item-card').forEach(card => {
                card.classList.remove('selected');
            });

            const selectedCard = document.querySelector(`[onclick="selectMenuItem(${itemId})"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }

            // Update selected item display
            updateSelectedItemDisplay();

            // Show quantity controls
            document.getElementById('quantityControls').style.display = 'flex';

            // Enable record sale button
            document.getElementById('recordSaleBtn').disabled = false;

            // Update receipt preview
        }

        updateReceiptPreview();

        function updateSelectedItemDisplay() {
            const container = document.getElementById('selectedItemDisplay');

            container.innerHTML = `
    <div class="text-center">
        <div class="mb-3">
            <!-- Show selected item image instead of "SELECTED" badge -->
            <img src="${selectedItem.image}" 
                 alt="${selectedItem.name}" 
                 class="selected-item-img mb-2" 
                 style="width: 160px; height: 180px;  object-fit: cover; border: 2px solid #800000;">
            
            <h5 class="text-maroon mb-2">${selectedItem.name}</h5>
            <p class="text-muted small mb-1">${selectedItem.description}</p>

            <!-- PRICE ADDED HERE -->
            <h6 class="text-dark fw-bold mb-0">₱${selectedItem.price.toFixed(2)}</h6>
        </div>

        <div class="d-flex justify-content-center align-items-center">
            <small class="text-muted me-3">
                <i class="fas fa-carrot me-1"></i>
                ${selectedItem.ingredients.length} ingredients
            </small>
            <span class="badge bg-light-blue text-black">
                <i class="fas fa-${getCategoryIcon(selectedItem.category)} me-1"></i>
                ${selectedItem.category}
            </span>
        </div>
    </div>
    `;
        }


        // Adjust quantity
        function adjustQuantity(change) {
            quantity += change;

            // Ensure quantity stays within bounds
            if (quantity < 1) quantity = 1;
            if (quantity > 99) quantity = 99;

            // Update input value
            document.getElementById('quantityInput').value = quantity;

            // Update receipt preview
            updateReceiptPreview();
            updateTotalPrice(); // <-- update totals after removal
        }

        // Update receipt preview
        function updateReceiptPreview() {
            const sales = JSON.parse(localStorage.getItem("sales")) || [];
            const receiptItems = document.getElementById('receiptItems');

            if (sales.length === 0) {
                receiptItems.innerHTML = `<div class="text-muted small">No items yet</div>`;
                return;
            }

            // Build receipt UI with delete button
            receiptItems.innerHTML = sales.map(item => `
        <div class="receipt-item d-flex justify-content-between align-items-center mb-2" data-id="${item.id}">
            <div>
                <div>${item.name}</div>
                <small class="text-muted">x${item.quantity}</small>
            </div>
            <div class="d-flex align-items-center">
                <div class="me-2">₱${item.total.toLocaleString()}</div>
                <button class="btn btn-sm btn-outline-danger remove-item-btn" title="Remove">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    `).join("");

            // Add click event for delete buttons
            const removeButtons = receiptItems.querySelectorAll('.remove-item-btn');
            removeButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const itemDiv = e.target.closest('.receipt-item');
                    const itemId = parseInt(itemDiv.getAttribute('data-id'));

                    // Remove from localStorage
                    let updatedSales = sales.filter(item => item.id !== itemId);
                    localStorage.setItem('sales', JSON.stringify(updatedSales));

                    // Update receipt preview
                    updateReceiptPreview();

                    // Optional: show toast
                    updateTotalPrice(); // <-- update totals after removal
                    showToast('Item removed from receipt', 'warning');
                });
            });
        }

        function updateTotalPrice() {
            const sales = JSON.parse(localStorage.getItem("sales")) || [];
            const totalElement = document.getElementById('TotalPrice');

            if (!totalElement) return;

            if (sales.length === 0) {
                totalElement.textContent = "₱0.00 (0 items)";
                return;
            }

            // Calculate total quantity and price
            const totalQuantity = sales.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = sales.reduce((sum, item) => sum + item.total, 0);

            // Display formatted
            totalElement.textContent = `₱${totalPrice.toLocaleString()} (${totalQuantity} items)`;
        }



        // Update receipt date
        function updateReceiptDate() {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const timeStr = now.toTimeString().split(' ')[0].substring(0, 5);
            document.getElementById('receiptDate').textContent = `${dateStr} ${timeStr}`;

            // Generate random order number
            const orderNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            document.getElementById('orderNumber').textContent = orderNum;
        }

        async function recordSale() {
            if (!selectedItem) {
                showToast('Please select a menu item first', 'warning');
                return;
            }

            const quantity = parseInt(document.getElementById('quantityInput').value) || 1;
            const price = selectedItem.price;
            const total = price * quantity;

            // Load existing sales
            let sales = JSON.parse(localStorage.getItem("sales")) || [];

            // Check if item already exists
            const existingItem = sales.find(item => item.id === selectedItem.id);

            if (existingItem) {
                // Increase quantity only
                existingItem.quantity += quantity;
                existingItem.total = existingItem.price * existingItem.quantity;
            } else {
                // Create new sale item
                const saleData = {
                    id: selectedItem.id,
                    name: selectedItem.name,
                    price: price,
                    quantity: quantity,
                    total: total,
                    date: new Date().toLocaleString()
                };

                sales.push(saleData);
            }

            // Save updated list
            localStorage.setItem("sales", JSON.stringify(sales));

            // Loading state
            const btn = document.getElementById('recordSaleBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
            btn.disabled = true;

            await new Promise(resolve => setTimeout(resolve, 1200));

            updateTotalPrice(); // <-- update totals after removal

            // SUCCESS TOAST
            showToast('Item added to receipt successfully!', 'success');

            // Reset button
            btn.innerHTML = originalText;
            btn.disabled = false;

            // Update receipt preview
            updateReceiptPreview();

            console.log("Updated Sales:", sales);
        }

        const sales = JSON.parse(localStorage.getItem("sales")) || [];
        console.log(sales);




        // Show success modal
        // function showSuccessModal() {
        //     const modalHTML = `
        //         <div class="modal fade" id="successModal" tabindex="-1">
        //             <div class="modal-dialog modal-dialog-centered">
        //                 <div class="modal-content">
        //                     <div class="modal-header bg-success text-white">
        //                         <h5 class="modal-title">
        //                             <i class="fas fa-check-circle me-2"></i>
        //                             Sale Recorded Successfully
        //                         </h5>
        //                         <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        //                     </div>
        //                     <div class="modal-body text-center py-4">
        //                         <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
        //                         <h4 class="mb-3">Sale Recorded!</h4>
        //                         <p class="mb-1">${quantity}x ${selectedItem.name}</p>
        //                         <p class="text-muted small mb-4">Order #${document.getElementById('orderNumber').textContent}</p>

        //                         <div class="alert alert-info text-start">
        //                             <i class="fas fa-info-circle me-2"></i>
        //                             <strong>System has automatically:</strong>
        //                             <ul class="mb-0 mt-2">
        //                                 <li>Saved the sales entry</li>
        //                                 <li>Deducted ingredients based on recipe</li>
        //                                 <li>Updated inventory levels</li>
        //                                 <li>Generated receipt preview</li>
        //                             </ul>
        //                         </div>
        //                     </div>
        //                     <div class="modal-footer">
        //                         <button type="button" class="btn btn-light-blue" onclick="printReceipt()" data-bs-dismiss="modal">
        //                             <i class="fas fa-print me-2"></i>Print Receipt
        //                         </button>
        //                         <button type="button" class="btn btn-maroon" onclick="clearSelection()" data-bs-dismiss="modal">
        //                             <i class="fas fa-plus me-2"></i>Start New Sale
        //                         </button>
        //                     </div>
        //                 </div>
        //             </div>
        //         </div>
        //     `;

        //     if (!document.getElementById('successModal')) {
        //         document.body.insertAdjacentHTML('beforeend', modalHTML);
        //     }

        //     const modal = new bootstrap.Modal(document.getElementById('successModal'));
        //     modal.show();
        // }

        // Clear selection
        function clearSelection() {
            selectedItem = null;
            quantity = 1;

            // Reset UI
            document.querySelectorAll('.menu-item-card').forEach(card => {
                card.classList.remove('selected');
            });

            document.getElementById('selectedItemDisplay').innerHTML = `
                <i class="fas fa-utensils fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No Item Selected</h5>
                <p class="text-muted small">Select a menu item to record sale</p>
            `;

            document.getElementById('quantityControls').style.display = 'none';
            document.getElementById('recordSaleBtn').disabled = true;
            // document.getElementById('receiptItems').innerHTML = '';
            document.getElementById('quantityInput').value = '1';

            // Update receipt date and order number
            updateReceiptDate();

            showToast('Selection cleared', 'info');
        }

        // Print receipt
        function printReceipt() {

            showToast('Opening receipt preview...', 'info');

            // In a real system, this would open print dialog or new window
            setTimeout(() => {
                window.open('staff_receipt.html?item=' + selectedItem.id + '&qty=' + quantity, '_blank');
            }, 500);
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container') || createToastContainer();
            const toastId = 'toast-' + Date.now();

            const icon = type === 'success' ? 'fa-check-circle' :
                type === 'warning' ? 'fa-exclamation-triangle' :
                    type === 'error' ? 'fa-times-circle' : 'fa-info-circle';

            const color = type === 'success' ? 'green' :
                type === 'warning' ? 'warning' :
                    type === 'error' ? 'danger' : 'light-blue';

            const toastHTML = `
                <div class="toast" id="${toastId}" role="alert">
                    <div class="toast-header">
                        <i class="fas ${icon} text-${color} me-2"></i>
                        <strong class="me-auto">System Message</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">${message}</div>
                </div>
            `;

            toastContainer.insertAdjacentHTML('beforeend', toastHTML);

            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();

            // Remove toast after it hides
            toastElement.addEventListener('hidden.bs.toast', function () {
                this.remove();
            });
        }

        // Create toast container if not exists
        function createToastContainer() {
            const container = document.createElement('div');
            container.className = 'toast-container';
            document.body.appendChild(container);
            return container;
        }

        // Toggle sidebar on mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }

        // Logout function
        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'index.html?logout=true';
        }

        // Handle quantity input changes
        document.getElementById('quantityInput').addEventListener('change', function () {
            let value = parseInt(this.value);
            if (isNaN(value) || value < 1) value = 1;
            if (value > 99) value = 99;
            this.value = value;
            quantity = value;

            if (selectedItem) {
                updateReceiptPreview();
            }
        });
    </script>
</body>

</html>